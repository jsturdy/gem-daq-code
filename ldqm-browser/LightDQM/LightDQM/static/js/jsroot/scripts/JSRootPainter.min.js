(function(a){if(typeof define==="function"&&define.amd){define(["JSRootCore","d3"],a)}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.js")}if(typeof d3!="object"){throw new Error("d3 is not defined","JSRootPainter.js")}if(typeof JSROOT.Painter=="object"){throw new Error("JSROOT.Painter already defined","JSRootPainter.js")}a(JSROOT,d3)}}(function(a,b){if(typeof define==="function"&&define.amd){a.loadScript("$$$style/JSRootPainter.css")}a.DrawFuncs={lst:[],cache:{}};a.addDrawFunc=function(c,d,e){if((arguments.length==1)&&(typeof arguments[0]=="object")){a.DrawFuncs.lst.push(arguments[0]);return arguments[0]}var f={name:c,func:d,opt:e};a.DrawFuncs.lst.push(f);return f};a.Painter={};a.Painter.createMenu=function(c,d){document.body.style.cursor="wait";a.AssertPrerequisites("jq2d",function(){document.body.style.cursor="auto";a.Painter.createMenu(c,d)})};a.Painter.closeMenu=function(d){if(!d){d="root_ctx_menu"}var c=document.getElementById(d);if(c){c.parentNode.removeChild(c)}};a.Painter.readStyleFromURL=function(g){var i=a.GetUrlOption("optimize",g);if(i==""){a.gStyle.OptimizeDraw=2}else{if(i!=null){a.gStyle.OptimizeDraw=parseInt(i);if(isNaN(a.gStyle.OptimizeDraw)){a.gStyle.OptimizeDraw=2}}}var c=a.GetUrlOption("interactive",g);if((c=="")||(c=="1")){c="11111"}else{if(c=="0"){c="00000"}}if((c!=null)&&(c.length==5)){a.gStyle.Tooltip=(c.charAt(0)!="0");a.gStyle.ContextMenu=(c.charAt(1)!="0");a.gStyle.Zooming=(c.charAt(2)!="0");a.gStyle.MoveResize=(c.charAt(3)!="0");a.gStyle.DragAndDrop=(c.charAt(4)!="0")}var f=a.GetUrlOption("col",g);if(f!=null){f=parseInt(f);if(!isNaN(f)&&(f>0)&&(f<4)){a.gStyle.DefaultCol=f}}var h=a.GetUrlOption("mathjax",g);if((h!=null)&&(h!="0")){a.gStyle.MathJax=1}if(a.GetUrlOption("nomenu",g)!=null){a.gStyle.ContextMenu=false}if(a.GetUrlOption("noprogress",g)!=null){a.gStyle.ProgressBox=false}a.gStyle.OptStat=a.GetUrlOption("optstat",g,a.gStyle.OptStat);a.gStyle.OptFit=a.GetUrlOption("optfit",g,a.gStyle.OptFit);a.gStyle.StatFormat=a.GetUrlOption("statfmt",g,a.gStyle.StatFormat);a.gStyle.FitFormat=a.GetUrlOption("fitfmt",g,a.gStyle.FitFormat);var e=a.GetUrlOption("interpolate",g);if(e!=null){a.gStyle.Interpolate=e}var d=a.GetUrlOption("palette",g);if(d!=null){d=parseInt(d);if(!isNaN(d)&&(d>0)&&(d<113)){a.gStyle.Palette=d}}};a.Painter.Coord={kCARTESIAN:1,kPOLAR:2,kCYLINDRICAL:3,kSPHERICAL:4,kRAPIDITY:5};a.Painter.root_colors=function(){var d=["white","black","red","green","blue","yellow","magenta","cyan","rgb(89, 211,84)","rgb(89,84,216)","white"];d[110]="white";var g=[{col:11,str:"c1b7ad4d4d4d6666668080809a9a9ab3b3b3cdcdcde6e6e6f3f3f3cdc8accdc8acc3c0a9bbb6a4b3a697b8a49cae9a8d9c8f83886657b1cfc885c3a48aa9a1839f8daebdc87b8f9a768a926983976e7b857d9ad280809caca6c0d4cf88dfbb88bd9f83c89a7dc08378cf5f61ac8f94a6787b946971d45a549300ff7b00ff6300ff4b00ff3300ff1b00ff0300ff0014ff002cff0044ff005cff0074ff008cff00a4ff00bcff00d4ff00ecff00fffd00ffe500ffcd00ffb500ff9d00ff8500ff6d00ff5500ff3d00ff2600ff0e0aff0022ff003aff0052ff006aff0082ff009aff00b1ff00c9ff00e1ff00f9ff00ffef00ffd700ffbf00ffa700ff8f00ff7700ff6000ff4800ff3000ff1800ff0000"},{col:201,str:"5c5c5c7b7b7bb8b8b8d7d7d78a0f0fb81414ec4848f176760f8a0f14b81448ec4876f1760f0f8a1414b84848ec7676f18a8a0fb8b814ecec48f1f1768a0f8ab814b8ec48ecf176f10f8a8a14b8b848ecec76f1f1"},{col:390,str:"ffffcdffff9acdcd9affff66cdcd669a9a66ffff33cdcd339a9a33666633ffff00cdcd009a9a00666600333300"},{col:406,str:"cdffcd9aff9a9acd9a66ff6666cd66669a6633ff3333cd33339a3333663300ff0000cd00009a00006600003300"},{col:422,str:"cdffff9affff9acdcd66ffff66cdcd669a9a33ffff33cdcd339a9a33666600ffff00cdcd009a9a006666003333"},{col:590,str:"cdcdff9a9aff9a9acd6666ff6666cd66669a3333ff3333cd33339a3333660000ff0000cd00009a000066000033"},{col:606,str:"ffcdffff9affcd9acdff66ffcd66cd9a669aff33ffcd33cd9a339a663366ff00ffcd00cd9a009a660066330033"},{col:622,str:"ffcdcdff9a9acd9a9aff6666cd66669a6666ff3333cd33339a3333663333ff0000cd00009a0000660000330000"},{col:791,str:"ffcd9acd9a669a66339a6600cd9a33ffcd66ff9a00ffcd33cd9a00ffcd00ff9a33cd66006633009a3300cd6633ff9a66ff6600ff6633cd3300ff33009aff3366cd00336600339a0066cd339aff6666ff0066ff3333cd0033ff00cdff9a9acd66669a33669a009acd33cdff669aff00cdff339acd00cdff009affcd66cd9a339a66009a6633cd9a66ffcd00ff6633ffcd00cd9a00ffcd33ff9a00cd66006633009a3333cd6666ff9a00ff9a33ff6600cd3300ff339acdff669acd33669a00339a3366cd669aff0066ff3366ff0033cd0033ff339aff0066cd00336600669a339acd66cdff009aff33cdff009acd00cdffcd9aff9a66cd66339a66009a9a33cdcd66ff9a00ffcd33ff9a00cdcd00ff9a33ff6600cd33006633009a6633cd9a66ff6600ff6633ff3300cd3300ffff339acd00666600339a0033cd3366ff669aff0066ff3366cd0033ff0033ff9acdcd669a9a33669a0066cd339aff66cdff009acd009aff33cdff009a"},{col:920,str:"cdcdcd9a9a9a666666333333"}];for(var f=0;f<g.length;++f){var e=g[f];for(var h=0;h<e.str.length;h+=6){var c=parseInt(e.col)+parseInt(h/6);d[c]="rgb("+parseInt("0x"+e.str.slice(h,h+2))+","+parseInt("0x"+e.str.slice(h+2,h+4))+","+parseInt("0x"+e.str.slice(h+4,h+6))+")"}}return d}();a.Painter.adoptRootColors=function(f){if(!f||!f.arr){return}for(var g=0;g<f.arr.length;++g){var e=f.arr[g];if((e==null)||(e._typename!="TColor")){continue}var d=e.fNumber;if((d<0)||(d>4096)){continue}var c="rgb("+(e.fRed*255).toFixed(0)+","+(e.fGreen*255).toFixed(0)+","+(e.fBlue*255).toFixed(0)+")";if(c=="rgb(255,255,255)"){c="white"}if(a.Painter.root_colors[d]!=c){a.Painter.root_colors[d]=c}}};a.Painter.root_line_styles=new Array("","","3, 3","1, 2","3, 4, 1, 4","5, 3, 1, 3","5, 3, 1, 3, 1, 3, 1, 3","5, 5","5, 3, 1, 3, 1, 3","20, 5","20, 10, 1, 10","1, 2");a.Painter.root_markers=new Array("fcircle","fcircle","oplus","oasterisk","ocircle","omult","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fsquare","ftriangle-down","ftriangle-up","ocircle","osquare","otriangle-up","odiamond","ocross","fstar","ostar","dcross","otriangle-down","fdiamond","fcross");a.Painter.createAttMarker=function(f,c){if(c==null){c=f.fMarkerStyle}var d=(c<a.Painter.root_markers.length)?a.Painter.root_markers[c]:"fcircle";var i=0,e=true;if(typeof(d)!="undefined"){if(d.charAt(0)=="0"){e=false}switch(d.substr(1)){case"circle":i=0;break;case"cross":i=1;break;case"diamond":i=2;break;case"square":i=3;break;case"triangle-up":i=4;break;case"triangle-down":i=5;break;case"star":i=6;break;case"asterisk":i=7;break;case"plus":i=8;break;case"mult":i=9;break}}var k=f.fMarkerSize;var g=64;if(c==1){g=1}var h=a.Painter.root_colors[f.fMarkerColor];var j={stroke:h,fill:h,marker:""};if(!e){j.fill="none"}switch(i){case 6:j.marker="M"+(-4*k)+","+(-1*k)+" L"+4*k+","+(-1*k)+" L"+(-2.4*k)+","+4*k+" L0,"+(-4*k)+" L"+2.8*k+","+4*k+" z";break;case 7:j.marker="M "+(-4*k)+","+(-4*k)+" L"+4*k+","+4*k+" M 0,"+(-4*k)+" L 0,"+4*k+" M "+4*k+","+(-4*k)+" L "+(-4*k)+","+4*k+" M "+(-4*k)+",0 L "+4*k+",0";break;case 8:j.marker="M 0,"+(-4*k)+" L 0,"+4*k+" M "+(-4*k)+",0 L "+4*k+",0";break;case 9:j.marker="M "+(-4*k)+","+(-4*k)+" L"+4*k+","+4*k+" M "+4*k+","+(-4*k)+" L "+(-4*k)+","+4*k;break;default:j.marker=b.svg.symbol().type(b.svg.symbolTypes[i]).size(k*g)}j.SetMarker=function(l){l.style("fill",this.fill).style("stroke",this.stroke).style("pointer-events","visibleFill").attr("d",this.marker)};j.func=j.SetMarker.bind(j);return j};a.Painter.createAttLine=function(h,f){var e=0,c=0,g=0;if(h=="black"){e=1;c=1}else{if(h=="none"){c=0}else{if(typeof h=="object"){if("fLineColor" in h){e=h.fLineColor}if("fLineWidth" in h){c=h.fLineWidth}if("fLineStyle" in h){g=h.fLineStyle}}}}if(f!=null){c=f}var d={color:a.Painter.root_colors[e],width:c,dash:a.Painter.root_line_styles[g]};if((c==0)||(e==0)){d.color="none"}d.SetLine=function(i){i.style("stroke",this.color);if(this.color!="none"){i.style("stroke-width",this.width);i.style("stroke-dasharray",this.dash)}};d.func=d.SetLine.bind(d);return d};a.Painter.clearCuts=function(c){var f=c.indexOf("[");var e=c.indexOf("]");if((f>=0)&&(e>=0)&&(f<e)){for(var d=f;d<=e;++d){c[d]=" "}}return c};a.Painter.root_fonts=new Array("Arial","Times New Roman","bold Times New Roman","bold italic Times New Roman","Arial","oblique Arial","bold Arial","bold oblique Arial","Courier New","oblique Courier New","bold Courier New","bold oblique Courier New","Symbol","Times New Roman","Wingdings","Symbol");a.Painter.getFontDetails=function(f,d){var e=a.Painter.root_fonts[Math.floor(f/10)];var c={name:"Arial",size:11,weight:null,style:null};if(d!=null){c.size=Math.round(d)}if(e==null){e=""}if(e.indexOf("bold")!=-1){c.weight="bold";e=e.substring(5,e.length)}if(e.charAt(0)=="i"){c.style="italic";e=e.substring(7,e.length)}else{if(e.charAt(0)=="o"){c.style="oblique";e=e.substring(8,e.length)}}if(name=="Symbol"){c.weight=null;c.style=null}c.name=e;c.SetFont=function(g){g.attr("font-family",this.name).attr("font-size",this.size).attr("xml:space","preserve");if(this.weight!=null){g.attr("font-weight",this.weight)}if(this.style!=null){g.attr("font-style",this.style)}};c.asStyle=function(g){return((g!=null)?g:this.size)+"px "+this.name};c.stringWidth=function(i,h){var j=i.append("svg:text").attr("xml:space","preserve").style("opacity",0).text(h);this.SetFont(j);var g=j.node().getBBox().width;j.remove();return g};c.func=c.SetFont.bind(c);return c};a.Painter.chooseTimeFormat=function(c,d){if(d<1){d=1}var e=c/d;if(e<0.5){return"%S"}if(e<30){return"%Mm%S"}e/=60;if(e<30){return"%Hh%M"}e/=60;if(e<12){return"%d-%Hh"}e/=24;if(e<15.218425){return"%d/%m"}e/=30.43685;if(e<6){return"%d/%m/%y"}e/=12;if(e<2){return"%m/%y"}return"%Y"};a.Painter.getTimeFormat=function(c){var e=c.fTimeFormat;var d=e.indexOf("%F");if(d>=0){return e.substr(0,d)}return e};a.Painter.getTimeOffset=function(d){var f=d.fTimeFormat.indexOf("%F");if(f<0){return a.gStyle.TimeOffset}var c=d.fTimeFormat.substr(f+2);if(c=="1995-01-01 00:00:00s0"){return 788918400000}if((c=="0")||(c=="")){return 0}var e=new Date(0);var g=c.indexOf("-");e.setFullYear(c.substr(0,g));c=c.substr(g+1);g=c.indexOf("-");e.setMonth(parseInt(c.substr(0,g))-1);c=c.substr(g+1);g=c.indexOf(" ");e.setDate(c.substr(0,g));c=c.substr(g+1);g=c.indexOf(":");e.setHours(c.substr(0,g));c=c.substr(g+1);g=c.indexOf(":");e.setMinutes(c.substr(0,g));c=c.substr(g+1);g=c.indexOf("s");e.setSeconds(c.substr(0,g));if(g>0){c=c.substr(g+1);e.setMilliseconds(c)}return e.getTime()};a.Painter.formatExp=function(l){var k=l;if(parseFloat(k)==1){return"1"}if(parseFloat(k)==10){return"10"}var k=k.replace("e+","x10@");var k=k.replace("e-","x10@-");var f=k.substring(0,k.indexOf("@"));var g=k.substr(k.indexOf("@"));f=f.replace("@","");g=g.replace("@","");var m,n=g.length;for(var d=0;d<n;++d){var m,i=g.charAt(d);if(i=="+"){m="\u207A"}else{if(i=="-"){m="\u207B"}else{var h=parseInt(i);if(h==1){m=String.fromCharCode(185)}else{if(h>1&&h<4){m=String.fromCharCode(176+h)}else{m=String.fromCharCode(8304+h)}}}}g=g.replace(i,m)}f=f.replace("1x","");return f+g};a.Painter.translateExp=function(m){var h=m.match(/\^{[0-9]*}/gi);if(h!=null){var d="";for(var g=0;g<h.length;++g){d=h[g].replace(" ","");d=d.replace("^{","");d=d.replace("}","");var o=d.length;for(var f=0;f<o;++f){var l=d.charAt(f);var n,k=parseInt(l);if(k==1){n=String.fromCharCode(185)}else{if(k>1&&k<4){n=String.fromCharCode(176+k)}else{n=String.fromCharCode(8304+k)}}d=d.replace(l,n)}m=m.replace(h[g],d)}}return m};a.Painter.symbols_map={"#alpha":"\u03B1","#beta":"\u03B2","#chi":"\u03C7","#delta":"\u03B4","#varepsilon":"\u03B5","#phi":"\u03C6","#gamma":"\u03B3","#eta":"\u03B7","#iota":"\u03B9","#varphi":"\u03C6","#kappa":"\u03BA","#lambda":"\u03BB","#mu":"\u03BC","#nu":"\u03BD","#omicron":"\u03BF","#pi":"\u03C0","#theta":"\u03B8","#rho":"\u03C1","#sigma":"\u03C3","#tau":"\u03C4","#upsilon":"\u03C5","#varomega":"\u03D6","#omega":"\u03C9","#xi":"\u03BE","#psi":"\u03C8","#zeta":"\u03B6","#Alpha":"\u0391","#Beta":"\u0392","#Chi":"\u03A7","#Delta":"\u0394","#Epsilon":"\u0395","#Phi":"\u03A6","#Gamma":"\u0393","#Eta":"\u0397","#Iota":"\u0399","#vartheta":"\u03D1","#Kappa":"\u039A","#Lambda":"\u039B","#Mu":"\u039C","#Nu":"\u039D","#Omicron":"\u039F","#Pi":"\u03A0","#Theta":"\u0398","#Rho":"\u03A1","#Sigma":"\u03A3","#Tau":"\u03A4","#Upsilon":"\u03A5","#varsigma":"\u03C2","#Omega":"\u03A9","#Xi":"\u039E","#Psi":"\u03A8","#Zeta":"\u0396","#varUpsilon":"\u03D2","#epsilon":"\u03B5","#sqrt":"\u221A","#leq":"\u2264","#/":"\u2044","#infty":"\u221E","#voidb":"\u0192","#club":"\u2663","#diamond":"\u2666","#heart":"\u2665","#spade":"\u2660","#leftrightarrow":"\u2194","#leftarrow":"\u2190","#uparrow":"\u2191","#rightarrow":"\u2192","#downarrow":"\u2193","#circ":"\u02C6","#pm":"\xB1","#doublequote":"\u2033","#geq":"\u2265","#times":"\xD7","#propto":"\u221D","#partial":"\u2202","#bullet":"\u2022","#divide":"\xF7","#neq":"\u2260","#equiv":"\u2261","#approx":"\u2248","#3dots":"\u2026","#cbar":"\u007C","#topbar":"\xAF","#downleftarrow":"\u21B5","#aleph":"\u2135","#Jgothic":"\u2111","#Rgothic":"\u211C","#voidn":"\u2118","#otimes":"\u2297","#oplus":"\u2295","#oslash":"\u2205","#cap":"\u2229","#cup":"\u222A","#supseteq":"\u2287","#supset":"\u2283","#notsubset":"\u2284","#subseteq":"\u2286","#subset":"\u2282","#int":"\u222B","#in":"\u2208","#notin":"\u2209","#angle":"\u2220","#nabla":"\u2207","#oright":"\xAE","#ocopyright":"\xA9","#trademark":"\u2122","#prod":"\u220F","#surd":"\u221A","#upoint":"\u22C5","#corner":"\xAC","#wedge":"\u2227","#vee":"\u2228","#Leftrightarrow":"\u21D4","#Leftarrow":"\u21D0","#Uparrow":"\u21D1","#Rightarrow":"\u21D2","#Downarrow":"\u21D3","#LT":"\x3C","#void1":"\xAE","#copyright":"\xA9","#void3":"\u2122","#sum":"\u2211","#arctop":"","#lbar":"","#arcbottom":"","#void8":"","#bottombar":"\u230A","#arcbar":"","#ltbar":"","#AA":"\u212B","#aa":"\u00E5","#void06":"","#GT":"\x3E","#forall":"\u2200","#exists":"\u2203","#bar":"","#vec":"","#dot":"\u22C5","#hat":"\xB7","#ddot":"","#acute":"acute","#grave":"","#check":"\u2713","#tilde":"\u02DC","#slash":"\u2044","#hbar":"\u0127","#box":"","#Box":"","#parallel":"","#perp":"\u22A5","#odot":"","#left":"","#right":""};a.Painter.translateLaTeX=function(d){var h=d;h=this.translateExp(h);while(h.indexOf("^{o}")!=-1){h=h.replace("^{o}","\xBA")}var f=h.match(/\#sqrt{(.*?)}/gi);if(f!=null){for(var e=0;e<f.length;++e){var g=f[e].replace(" ","");g=g.replace("#sqrt{","#sqrt");g=g.replace("}","");h=h.replace(f[e],g)}}f=h.match(/\_{(.*?)}/gi);if(f!=null){for(var e=0;e<f.length;++e){var g=f[e].replace(" ","");g=g.replace("_{","");g=g.replace("}","");h=h.replace(f[e],g)}}f=h.match(/\^{(.*?)}/gi);if(f!=null){for(e=0;e<f.length;++e){var g=f[e].replace(" ","");g=g.replace("^{","");g=g.replace("}","");h=h.replace(f[e],g)}}while(h.indexOf("#/")!=-1){h=h.replace("#/",a.Painter.symbols_map["#/"])}for(var c in a.Painter.symbols_map){while(h.indexOf(c)!=-1){h=h.replace(c,a.Painter.symbols_map[c])}}if((h.indexOf("#splitline{")==0)&&(h.charAt(h.length-1)=="}")){var j=h.indexOf("}{");if((j>0)&&(j==h.lastIndexOf("}{"))){h=h.replace("}{","\n");h=h.slice(11,h.length-1)}}return h};a.Painter.isAnyLatex=function(c){return(c.indexOf("#")>=0)||(c.indexOf("\\")>=0)||(c.indexOf("{")>=0)};a.Painter.translateMath=function(f,e,d){if(e!=2){f=f.replace(/#LT/g,"\\langle");f=f.replace(/#GT/g,"\\rangle");f=f.replace(/#club/g,"\\clubsuit");f=f.replace(/#spade/g,"\\spadesuit");f=f.replace(/#heart/g,"\\heartsuit");f=f.replace(/#diamond/g,"\\diamondsuit");f=f.replace(/#voidn/g,"\\wp");f=f.replace(/#voidb/g,"f");f=f.replace(/#copyright/g,"(c)");f=f.replace(/#ocopyright/g,"(c)");f=f.replace(/#trademark/g,"TM");f=f.replace(/#void3/g,"TM");f=f.replace(/#oright/g,"R");f=f.replace(/#void1/g,"R");f=f.replace(/#3dots/g,"\\ldots");f=f.replace(/#lbar/g,"\\mid");f=f.replace(/#void8/g,"\\mid");f=f.replace(/#divide/g,"\\div");f=f.replace(/#Jgothic/g,"\\Im");f=f.replace(/#Rgothic/g,"\\Re");f=f.replace(/#doublequote/g,'"');f=f.replace(/#plus/g,"+");f=f.replace(/#diamond/g,"\\diamondsuit");f=f.replace(/#voidn/g,"\\wp");f=f.replace(/#voidb/g,"f");f=f.replace(/#copyright/g,"(c)");f=f.replace(/#ocopyright/g,"(c)");f=f.replace(/#trademark/g,"TM");f=f.replace(/#void3/g,"TM");f=f.replace(/#oright/g,"R");f=f.replace(/#void1/g,"R");f=f.replace(/#3dots/g,"\\ldots");f=f.replace(/#lbar/g,"\\mid");f=f.replace(/#void8/g,"\\mid");f=f.replace(/#divide/g,"\\div");f=f.replace(/#Jgothic/g,"\\Im");f=f.replace(/#Rgothic/g,"\\Re");f=f.replace(/#doublequote/g,'"');f=f.replace(/#plus/g,"+");f=f.replace(/#minus/g,"-");f=f.replace(/#\//g,"/");f=f.replace(/#upoint/g,".");f=f.replace(/#aa/g,"\\mathring{a}");f=f.replace(/#AA/g,"\\mathring{A}");f=f.replace(/#omicron/g,"o");f=f.replace(/#Alpha/g,"A");f=f.replace(/#Beta/g,"B");f=f.replace(/#Epsilon/g,"E");f=f.replace(/#Zeta/g,"Z");f=f.replace(/#Eta/g,"H");f=f.replace(/#Iota/g,"I");f=f.replace(/#Kappa/g,"K");f=f.replace(/#Mu/g,"M");f=f.replace(/#Nu/g,"N");f=f.replace(/#Omicron/g,"O");f=f.replace(/#Rho/g,"P");f=f.replace(/#Tau/g,"T");f=f.replace(/#Chi/g,"X");f=f.replace(/#varomega/g,"\\varpi");f=f.replace(/#corner/g,"?");f=f.replace(/#ltbar/g,"?");f=f.replace(/#bottombar/g,"?");f=f.replace(/#notsubset/g,"?");f=f.replace(/#arcbottom/g,"?");f=f.replace(/#cbar/g,"?");f=f.replace(/#arctop/g,"?");f=f.replace(/#topbar/g,"?");f=f.replace(/#arcbar/g,"?");f=f.replace(/#downleftarrow/g,"?");f=f.replace(/#splitline/g,"\\genfrac{}{}{0pt}{}");f=f.replace(/#it/g,"\\textit");f=f.replace(/#bf/g,"\\textbf");f=f.replace(/#frac/g,"\\frac");f=f.replace(/#left{/g,"\\lbrace");f=f.replace(/#right}/g,"\\rbrace");f=f.replace(/#left\[/g,"\\lbrack");f=f.replace(/#right\]/g,"\\rbrack");f=f.replace(/#\[\]{/g,"\\lbrack");f=f.replace(/ } /g,"\\rbrack");f=f.replace(/#\[/g,"\\lbrack");f=f.replace(/#\]/g,"\\rbrack");f=f.replace(/#{/g,"\\lbrace");f=f.replace(/#}/g,"\\rbrace");f=f.replace(/ /g,"\\;");for(var c in a.Painter.symbols_map){var g="\\"+c.substr(1);f=f.replace(new RegExp(c,"g"),g)}}else{f=f.replace(/\\\^/g,"\\hat")}if(typeof d!="string"){return"\\("+f+"\\)"}d=d.replace(/rgb/g,"[RGB]").replace(/\(/g,"{").replace(/\)/g,"}");return"\\(\\color "+d+f+"\\)"};a.TBasePainter=function(){this.divid=null};a.TBasePainter.prototype.Cleanup=function(){};a.TBasePainter.prototype.DrawingReady=function(){this["_ready_called_"]=true;if("_ready_callback_" in this){a.CallBack(this["_ready_callback_"],this);delete this["_ready_callback_"];this["_ready_callback_"]=null}return this};a.TBasePainter.prototype.WhenReady=function(c){if("_ready_called_" in this){return a.CallBack(c,this)}this["_ready_callback_"]=c};a.TBasePainter.prototype.GetObject=function(){return null};a.TBasePainter.prototype.UpdateObject=function(c){return false};a.TBasePainter.prototype.RedrawPad=function(c){};a.TBasePainter.prototype.RedrawObject=function(d){if(this.UpdateObject(d)){var c=document.body.style.cursor;document.body.style.cursor="wait";this.RedrawPad();document.body.style.cursor=c}};a.TBasePainter.prototype.CheckResize=function(c){return false};a.TBasePainter.prototype.select_main=function(){if(this.divid==null){return b.select(null)}if((typeof this.divid=="string")&&(this.divid.charAt(0)!="#")){return b.select("#"+this.divid)}return b.select(this.divid)};a.TBasePainter.prototype.SetDivId=function(e){if(arguments.length>0){this["divid"]=e}var c=this.select_main();var d=c.node()?c.node().firstChild:null;if(d){d.painter=this}};a.TBasePainter.prototype.SetItemName=function(c,d){if(c==null){delete this["_hitemname"]}else{this["_hitemname"]=c}if(d!=null){this["_hdrawopt"]=d}};a.TBasePainter.prototype.GetItemName=function(){return("_hitemname" in this)?this["_hitemname"]:null};a.TBasePainter.prototype.GetItemDrawOpt=function(){return("_hdrawopt" in this)?this["_hdrawopt"]:""};a.TBasePainter.prototype.CanZoomIn=function(d,e,c){return false};a.TBasePainter.prototype.GetStyleValue=function(c,d){var e=c.style(d);if(!e){return 0}e=parseFloat(e.replace("px",""));return isNaN(e)?0:e};a.TObjectPainter=function(c){a.TBasePainter.call(this);this.draw_g=null;this.pad_name="";this.main=null;this.obj_typename=(c!=null)&&("_typename" in c)?c._typename:""};a.TObjectPainter.prototype=Object.create(a.TBasePainter.prototype);a.TObjectPainter.prototype.pad_painter=function(c){var d=c?this.svg_pad():this.svg_canvas();return d.empty()?null:d.property("pad_painter")};a.TObjectPainter.prototype.CheckResize=function(c){var d=this.pad_painter();if(d){d.CheckCanvasResize(c);return true}return false};a.TObjectPainter.prototype.RemoveDrawG=function(){if(this.draw_g!=null){this.draw_g.remove();this.draw_g=null}};a.TObjectPainter.prototype.RecreateDrawG=function(d,e,g){if(this.draw_g){this.draw_g.selectAll("*").remove()}if(g==null){g=true}if(d){if(e==null){e=".text_layer"}if(!this.draw_g){this.draw_g=this.svg_pad().select(e).append("svg:g")}}else{var i=this.svg_frame();var c=i.attr("width");var f=i.attr("height");if(!this.draw_g){if(e==null){e=".main_layer"}if(g){this.draw_g=i.select(e).append("g")}else{this.draw_g=i.select(e).append("svg")}}if(!g){this.draw_g.attr("x",0).attr("y",0).attr("width",c).attr("height",f).attr("viewBox","0 0 "+c+" "+f).attr("overflow","hidden")}}};a.TObjectPainter.prototype.svg_canvas=function(){return this.select_main().select(".root_canvas")};a.TObjectPainter.prototype.svg_pad=function(){var d=this.svg_canvas();if((this.pad_name!="")&&!d.empty()){d=d.select("[pad="+this.pad_name+"]")}return d};a.TObjectPainter.prototype.root_pad=function(){var c=this.pad_painter(true);return c?c.pad:null};a.TObjectPainter.prototype.ConvertToNDC=function(d,e,c){var f=this.root_pad();if(c==null){c=false}if(c||(f==null)){return e}if(d=="y"){if(f.fLogy){e=(e>0)?a.log10(e):f.fUymin}return(e-f.fY1)/(f.fY2-f.fY1)}if(f.fLogx){e=(e>0)?a.log10(e):f.fUxmin}return(e-f.fX1)/(f.fX2-f.fX1)};a.TObjectPainter.prototype.AxisToSvg=function(e,f,d){var c=this.main_painter();if((c!=null)&&!d){return e=="y"?c.gry(f):c.grx(f)}if(!d){f=this.ConvertToNDC(e,f)}if(e=="y"){return(1-f)*this.pad_height()}return f*this.pad_width()};a.TObjectPainter.prototype.PadToSvg=function(d,e,c){return this.AxisToSvg(d,e,c)};a.TObjectPainter.prototype.svg_frame=function(){return this.svg_pad().select(".root_frame")};a.TObjectPainter.prototype.pad_width=function(){var c=this.svg_pad().property("draw_width");return isNaN(c)?0:c};a.TObjectPainter.prototype.pad_height=function(){var c=this.svg_pad().property("draw_height");return isNaN(c)?0:c};a.TObjectPainter.prototype.frame_x=function(c){var d=parseInt(this.svg_frame().attr("x"));return isNaN(d)?0:d};a.TObjectPainter.prototype.frame_y=function(c){var d=parseInt(this.svg_frame().attr("y"));return isNaN(d)?0:d};a.TObjectPainter.prototype.frame_width=function(){var c=parseInt(this.svg_frame().attr("width"));return isNaN(c)?0:c};a.TObjectPainter.prototype.frame_height=function(){var c=parseInt(this.svg_frame().attr("height"));return isNaN(c)?0:c};a.TObjectPainter.prototype.main_painter=function(){if(!this.main){var c=this.svg_pad();if(!c.empty()){this.main=c.property("mainpainter")}}return this.main};a.TObjectPainter.prototype.is_main_painter=function(){return this==this.main_painter()};a.TObjectPainter.prototype.SetDivId=function(g,f){this["divid"]=g;if(f==null){f=0}this["create_canvas"]=false;var e=this.svg_canvas();if(e.empty()&&(f>0)){a.Painter.drawCanvas(g,null);e=this.svg_canvas();this["create_canvas"]=true}if(e.empty()){if((f<0)||(this.obj_typename=="TCanvas")){return}a.console("Special case for "+this.obj_typename+" assign painter to first DOM element");var c=b.select("#"+g);if(c.node()&&c.node().firstChild){c.node().firstChild.painter=this}return}this.pad_name=e.property("current_pad");if(f<0){return}if((f>0)&&this.svg_frame().empty()){a.Painter.drawFrame(g,null);if(this.svg_frame().empty()){return alert("Fail to draw dummy TFrame")}this["create_canvas"]=true}var d=this.svg_pad();if(d.empty()){return}if(d.property("pad_painter")!=this){d.property("pad_painter").painters.push(this)}if((f>0)&&(d.property("mainpainter")==null)){d.property("mainpainter",this)}};a.TObjectPainter.prototype.SetForeignObjectPosition=function(d,c,f){var e=d;if(a.browser.isWebKit){this.svg_canvas().property("redraw_by_resize",true);while(e&&e.attr("class")!="root_canvas"){if((e.attr("class")=="root_frame")||(e.attr("class")=="root_pad")){c+=parseInt(e.attr("x"));f+=parseInt(e.attr("y"))}e=b.select(e.node().parentNode)}}d.attr("x",c).attr("y",f)};a.TObjectPainter.prototype.createAttFill=function(c,j,e){if((j==null)&&c){j=c.fFillStyle}if((e==null)&&c){e=c.fFillColor}var k={color:"none"};k.SetFill=function(l){l.style("fill",this.color);if("antialias" in this){l.style("antialias",this.antialias)}};k.func=k.SetFill.bind(k);if(typeof c=="string"){k.color=c;return k}if((j<1001)||((j>=4000)&&(j<=4100))){return k}k.color=a.Painter.root_colors[e];if(typeof k.color!="string"){k.color="none"}var i=this.svg_canvas();if((j<3000)||(j>3025)||i.empty()){return k}var d="pat_"+j+"_"+e;var f=i.select("defs");if(f.empty()){f=i.insert("svg:defs",":first-child")}k.color="url(#"+d+")";k.antialias=false;if(!f.select("#"+d).empty()){return k}var g=a.Painter.root_colors[e];var h=f.append("svg:pattern").attr("id",d).attr("patternUnits","userSpaceOnUse");switch(j){case 3001:h.attr("width",2).attr("height",2);h.append("svg:rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1);h.append("svg:rect").attr("x",1).attr("y",1).attr("width",1).attr("height",1);break;case 3002:h.attr("width",4).attr("height",2);h.append("svg:rect").attr("x",1).attr("y",0).attr("width",1).attr("height",1);h.append("svg:rect").attr("x",3).attr("y",1).attr("width",1).attr("height",1);break;case 3003:h.attr("width",4).attr("height",4);h.append("svg:rect").attr("x",2).attr("y",1).attr("width",1).attr("height",1);h.append("svg:rect").attr("x",0).attr("y",3).attr("width",1).attr("height",1);break;case 3005:h.attr("width",8).attr("height",8);h.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",8).attr("y2",8);break;case 3006:h.attr("width",4).attr("height",4);h.append("svg:line").attr("x1",1).attr("y1",0).attr("x2",1).attr("y2",3);break;case 3007:h.attr("width",4).attr("height",4);h.append("svg:line").attr("x1",0).attr("y1",1).attr("x2",3).attr("y2",1);break;case 3010:h.attr("width",10).attr("height",10);h.append("svg:line").attr("x1",0).attr("y1",2).attr("x2",10).attr("y2",2);h.append("svg:line").attr("x1",0).attr("y1",7).attr("x2",10).attr("y2",7);h.append("svg:line").attr("x1",2).attr("y1",0).attr("x2",2).attr("y2",2);h.append("svg:line").attr("x1",7).attr("y1",2).attr("x2",7).attr("y2",7);h.append("svg:line").attr("x1",2).attr("y1",7).attr("x2",2).attr("y2",10);break;case 3021:case 3022:h.attr("width",10).attr("height",10);h.append("svg:line").attr("x1",0).attr("y1",5).attr("x2",5).attr("y2",5);h.append("svg:line").attr("x1",5).attr("y1",5).attr("x2",5).attr("y2",0);h.append("svg:line").attr("x1",5).attr("y1",10).attr("x2",10).attr("y2",10);h.append("svg:line").attr("x1",10).attr("y1",10).attr("x2",10).attr("y2",5);break;default:h.attr("width",8).attr("height",8);h.append("svg:line").attr("x1",8).attr("y1",0).attr("x2",0).attr("y2",8);break}h.selectAll("line").style("stroke",g).style("stroke-width",1);h.selectAll("rect").style("fill",g);return k};a.TObjectPainter.prototype.ForEachPainter=function(f){var c=this.select_main();var d=(c.node()&&c.node().firstChild)?c.node().firstChild.painter:null;if(d!=null){return f(d)}var g=this.pad_painter(true);if(g==null){return}f(g);if("painters" in g){for(var e=0;e<g.painters.length;++e){f(g.painters[e])}}};a.TObjectPainter.prototype.Cleanup=function(){this.select_main().html("")};a.TObjectPainter.prototype.RedrawPad=function(){var c=this.pad_painter(true);if(c){c.Redraw()}};a.TObjectPainter.prototype.AddDrag=function(m){if(!a.gStyle.MoveResize){return}var d=this;var c=function(){return Number(d.draw_g.attr("width"))};var o=function(){return Number(d.draw_g.attr("height"))};var p=0,n=0,i=1,e=1,h=null;function k(q){if("buttons" in q){return q.buttons===2}else{if("which" in q){return q.which===3}else{if("button" in q){return q.button===2}}}return false}var f=this.draw_g.append("rect").style("opacity","0").style("cursor","se-resize").attr("x",c()-20).attr("y",o()-20).attr("width",20).attr("height",20);var g=null;var l=b.behavior.drag().origin(Object).on("dragstart",function(){if(k(b.event.sourceEvent)){return}a.Painter.closeMenu();b.event.sourceEvent.preventDefault();b.event.sourceEvent.stopPropagation();p=0;n=0;i=d.pad_width()-c();e=d.pad_height()-o();h=new Date();g=b.select(d.draw_g.node().parentNode).append("rect").classed("zoom",true).attr("x",d.draw_g.attr("x")).attr("y",d.draw_g.attr("y")).attr("width",c()).attr("height",o()).style("cursor","move")}).on("drag",function(){if(g==null){return}b.event.sourceEvent.preventDefault();var q=Number(g.attr("x")),t=Number(g.attr("y"));var s=b.event.dx,r=b.event.dy;if((p<0)&&(s>0)){p+=s;s=0;if(p>0){s=p;p=0}}if((p>0)&&(s<0)){p+=s;s=0;if(p<0){s=p;p=0}}if((n<0)&&(r>0)){n+=r;r=0;if(n>0){r=n;n=0}}if((n>0)&&(r<0)){n+=r;r=0;if(n<0){r=n;n=0}}if(q+s<0){p+=(q+s);q=0}else{if(q+s>i){p+=(q+s-i);q=i}else{q+=s}}if(t+r<0){n+=(t+r);t=0}else{if(t+r>e){n+=(t+r-e);t=e}else{t+=r}}g.attr("x",q).attr("y",t);b.event.sourceEvent.stopPropagation()}).on("dragend",function(){if(g==null){return}b.event.sourceEvent.preventDefault();g.style("cursor","auto");var q=Number(g.attr("x")),u=Number(g.attr("y"));var s=q-Number(d.draw_g.attr("x")),r=u-Number(d.draw_g.attr("y"));g.remove();g=null;d.draw_g.attr("x",q).attr("y",u).attr("transform","translate("+q+","+u+")");f.attr("x",c()-20).attr("y",o()-20);if("move" in m){m.move(q,u,s,r)}else{if("obj" in m){m.obj.fX1NDC+=s/d.pad_width();m.obj.fX2NDC+=s/d.pad_width();m.obj.fY1NDC-=r/d.pad_height();m.obj.fY2NDC-=r/d.pad_height()}}if((s==0)&&(r==0)&&m.ctxmenu&&((new Date()).getTime()-h.getTime()>600)){var t=f.node().getBoundingClientRect();d.ShowContextMenu("main",{clientX:t.left+20,clientY:t.top+20})}});var j=b.behavior.drag().origin(Object).on("dragstart",function(){if(k(b.event.sourceEvent)){return}b.event.sourceEvent.stopPropagation();b.event.sourceEvent.preventDefault();p=0;n=0;i=d.pad_width()-Number(d.draw_g.attr("x"));e=d.pad_height()-Number(d.draw_g.attr("y"));g=b.select(d.draw_g.node().parentNode).append("rect").classed("zoom",true).attr("x",d.draw_g.attr("x")).attr("y",d.draw_g.attr("y")).attr("width",c()).attr("height",o()).style("cursor","se-resize")}).on("drag",function(){if(g==null){return}b.event.sourceEvent.preventDefault();var r=Number(g.attr("width")),t=Number(g.attr("height"));var s=b.event.dx,q=b.event.dy;if((p<0)&&(s>0)){p+=s;s=0;if(p>0){s=p;p=0}}if((p>0)&&(s<0)){p+=s;s=0;if(p<0){s=p;p=0}}if((n<0)&&(q>0)){n+=q;q=0;if(n>0){q=n;n=0}}if((n>0)&&(q<0)){n+=q;q=0;if(n<0){q=n;n=0}}if(r+s>i){p+=(r+s-i);r=i}else{if(r+s<0){p+=(r+s);r=0}else{r+=s}}if(t+q>e){n+=(t+q-e);t=e}else{if(t+q<0){n+=(t+q);t=0}else{t+=q}}g.attr("width",r).attr("height",t);b.event.sourceEvent.stopPropagation()}).on("dragend",function(){if(g==null){return}b.event.sourceEvent.preventDefault();g.style("cursor","auto");var q=Number(g.attr("width"));var r=Number(g.attr("height"));d.draw_g.attr("width",q).attr("height",r);g.remove();g=null;f.attr("x",q-20).attr("y",r-20);if("resize" in m){m.resize(q,r)}else{if("obj" in m){m.obj.fX2NDC=m.obj.fX1NDC+q/d.pad_width();m.obj.fY1NDC=m.obj.fY2NDC-r/d.pad_height()}if("redraw" in m){m.redraw()}}});this.draw_g.style("cursor","move").call(l);f.call(j)};a.TObjectPainter.prototype.startTouchMenu=function(d,f){var c=b.touches(d);if(c.length!=1){return}if(!f||(f=="")){f="main"}var e="touch_"+f;b.event.preventDefault();b.event.stopPropagation();this[e]={tgt:d,dt:new Date(),pos:c[0]};b.select(d).on("touchcancel",this.endTouchMenu.bind(this,f)).on("touchend",this.endTouchMenu.bind(this,f),true)};a.TObjectPainter.prototype.endTouchMenu=function(d){var c="touch_"+d;if(!(c in this)){return}b.event.preventDefault();b.event.stopPropagation();var f=new Date().getTime()-this[c].dt.getTime();b.select(this[c].tgt).on("touchcancel",null).on("touchend",null,true);if(f>500){var e=b.select(this[c].tgt).node().getBoundingClientRect();this.ShowContextMenu(d,{clientX:e.left+this[c].pos[0],clientY:e.top+this[c].pos[1]})}delete this[c]};a.TObjectPainter.prototype.FindPainterFor=function(d,g){var c=this.pad_painter(true);var f=c==null?null:c.painters;if(f==null){return null}for(var h=0;h<f.length;++h){var e=f[h].GetObject();if(e==null){continue}if(d&&(e===d)){return f[h]}if(g&&("fName" in e)&&(e.fName==g)){return f[h]}}return null};a.TObjectPainter.prototype.Redraw=function(){};a.TObjectPainter.prototype.StartTextDrawing=function(e,c,f){if(!f){f=this.draw_g}var d=a.Painter.getFontDetails(e,c);f.call(d.func);f.property("text_font",d);f.property("mathjax_use",false);f.property("text_factor",0);f.property("max_text_width",0)};a.TObjectPainter.prototype.TextScaleFactor=function(d,c){if(!c){c=this.draw_g}if(d&&(d>c.property("text_factor"))){c.property("text_factor",d)}};a.TObjectPainter.prototype.GetBoundarySizes=function(e){var d=e.getBoundingClientRect();if(parseInt(d.width)>0){d=e.getBBox()}var c={width:parseInt(d.width),height:parseInt(d.height)};if("left" in d){c.x=parseInt(d.left);c.y=parseInt(d.right)}else{if("x" in d){c.x=parseInt(d.x);c.y=parseInt(d.y)}}return c};a.TObjectPainter.prototype.FinishTextDrawing=function(i,g){if(!i){i=this.draw_g}var e=this;var k=null;if(i.property("mathjax_use")){i.property("mathjax_use",false);var h=false;k=i.selectAll(".math_svg");k.each(function(){var l=b.select(this);if(l.node().parentNode!==i.node()){return}var f=l.property("_element");if(b.select(f).select("svg").empty()){h=true}});if(h){a.AssertPrerequisites("mathjax",function(){if(typeof MathJax=="object"){MathJax.Hub.Queue(["FinishTextDrawing",e,i,g])}});return null}}if(k==null){k=i.selectAll(".math_svg")}var c=this;k.each(function(){var m=b.select(this);if(m.node().parentNode!==i.node()){return}var l=m.property("_element");m.property("_element",null);var n=b.select(l).select("svg");if(n.empty()){a.console("MathJax SVG ouptut error");return}n.remove();document.body.removeChild(l);m.append(function(){return n.node()});if(m.property("_scale")){var f=c.GetBoundarySizes(m.node());c.TextScaleFactor(1.05*f.width/parseInt(m.attr("width")),i);c.TextScaleFactor(1*f.height/parseInt(m.attr("height")),i)}});var j=i.property("text_factor");var d=i.property("text_font");if((j>0)&&((j<0.9)||(j>1))){d.size=Math.floor(d.size/j);i.call(d.func)}k.each(function(){var q=b.select(this);if(q.node().parentNode!==i.node()){return}var p=c.GetBoundarySizes(q.node());var r=q.property("_align");var n=q.property("_rotate");var m=parseInt(q.attr("width")),o=parseInt(q.attr("height"));var l=parseInt(q.attr("x")),f=parseInt(q.attr("y"));if(q.property("_scale")){if(r[0]=="middle"){l+=(m-p.width)/2}else{if(r[0]=="end"){l+=(m-p.width)}}if(r[1]=="middle"){f+=(o-p.height)/2}else{if(r[1]=="top"&&!n){f+=(o-p.height)}else{if(r[1]=="bottom"&&n){f+=(o-p.height)}}}}else{if(r[0]=="middle"){l-=p.width/2}else{if(r[0]=="end"){l-=p.width}}if(r[1]=="middle"){f-=p.height/2}else{if(r[1]=="bottom"&&!n){f-=p.height}else{if(r[1]=="top"&&n){f-=p.height}}}}if((f<0)&&(c.frame_x()<-f)){f=-c.frame_x()+1}q.attr("x",l).attr("y",f).attr("visibility",null);if((q.attr("width")==0)||(q.attr("width")<p.width+15)){q.attr("width",p.width+15)}if((q.attr("height")==0)||(q.attr("height")<p.height+10)){q.attr("height",p.height+10)}});i.selectAll(".hidden_text").attr("opacity","1").classed("hidden_text",false);a.CallBack(g);return i.property("max_text_width")};a.TObjectPainter.prototype.DrawText=function(p,l,j,m,u,g,v,n,z){if(!z){z=this.draw_g}var r;if(typeof p=="string"){r=p.split(";");if(r.length==1){r.push("middle")}}else{r=["start","middle"];if((p/10)>=3){r[0]="end"}else{if((p/10)>=2){r[0]="middle"}}if((p%10)==0){r[1]="bottom"}else{if((p%10)==1){r[1]="bottom"}else{if((p%10)==3){r[1]="top"}}}}var A=(m>0)&&(u>0);if(n==null){n=1}if(n<2){if(!a.Painter.isAnyLatex(g)){n=0}}var t=((a.gStyle.MathJax<1)&&(n!=2))||(n<1);if(!t&&(u<0)&&!a.browser.isFirefox){t=true}if(t){if(n>0){g=a.Painter.translateLaTeX(g)}var d=l.toFixed(1),c=j.toFixed(1),i=null,f=false;if(m>0){if(r[0]=="middle"){d=(l+m*0.5).toFixed(1)}else{if(r[0]=="end"){d=(l+m).toFixed(1)}}}if(u>0){if(r[1]=="bottom"){c=(j+u).toFixed(1)}else{if(r[1]=="top"){i=".8em"}else{c=(j+u/2).toFixed(1);if(a.browser.isIE){i=".4em"}else{f=true}}}}else{if(u==0){if(r[1]=="top"){i=".8em"}else{if(r[1]=="middle"){if(a.browser.isIE){i=".4em"}else{f=true}}}}}var o=z.append("text").attr("text-anchor",r[0]).attr("x",d).attr("y",c).attr("fill",v?v:null).text(g);if(i!=null){o.attr("dy",i)}if(f){o.attr("dominant-baseline","middle")}if(!A&&(u<0)){o.attr("transform","rotate("+(-u)+", 0, 0)")}var k=this.GetBoundarySizes(o.node());if(A){o.classed("hidden_text",true).attr("opacity","0")}if(k.width>z.property("max_text_width")){z.property("max_text_width",k.width)}if((m>0)&&A){this.TextScaleFactor(1.05*k.width/m,z)}if((u>0)&&A){this.TextScaleFactor(1*k.height/u,z)}return k.width}m=Math.round(m);u=Math.round(u);l=Math.round(l);j=Math.round(j);var s=false;if(!A){if((u==-270)||(u==-90)){s=true}m=this.pad_width();u=this.pad_height()}var q=z.append("svg").attr("x",l).attr("y",j).attr("width",m).attr("height",u).attr("class","math_svg").attr("visibility","hidden").property("_scale",A).property("_rotate",s).property("_align",r);if(s){q.attr("transform","rotate(270, 0, 0)")}var e=document.createElement("div");b.select(e).style("visibility","hidden").style("overflow","hidden").style("position","absolute").html(a.Painter.translateMath(g,n,v));document.body.appendChild(e);z.property("mathjax_use",true);q.property("_element",e);a.AssertPrerequisites("mathjax",function(){if(typeof MathJax=="object"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,e])}});return 0};a.TFramePainter=function(c){a.TObjectPainter.call(this,c);this.tframe=c};a.TFramePainter.prototype=Object.create(a.TObjectPainter.prototype);a.TFramePainter.prototype.GetObject=function(){return this.tframe};a.TFramePainter.prototype.Shrink=function(e,c){var d=this.svg_frame().property("NDC");if(d){d.fX1NDC+=e;d.fX2NDC-=c}};a.TFramePainter.prototype.DrawFrameSvg=function(){var t=this.pad_width(),s=this.pad_height();var n=t,z=s;var y=this.svg_frame().empty()?null:this.svg_frame().property("NDC");if(y==null){var C=this.root_pad();if(C==null){y=a.clone(a.gStyle.FrameNDC)}else{y={fX1NDC:C.fLeftMargin,fX2NDC:1-C.fRightMargin,fY1NDC:C.fTopMargin,fY2NDC:1-C.fBottomMargin}}}var E=this.root_pad();var m=t*y.fX1NDC;var o=t*(1-y.fX2NDC);var f=s*y.fY1NDC;var c=s*(1-y.fY2NDC);var r=this.createAttFill("white"),D=a.Painter.createAttLine("black"),g=0,j=0;if(this.tframe){g=this.tframe.fBorderMode;j=this.tframe.fBorderSize;D=a.Painter.createAttLine(this.tframe);if(E){var A=t/Math.abs(E.fX2-E.fX1);var l=s/Math.abs(E.fY2-E.fY1);var x=(this.tframe.fX1-E.fX1)*A;var e=(this.tframe.fY1-E.fY1)*l;var v=(this.tframe.fX2-E.fX1)*A;var d=(this.tframe.fY2-E.fY1)*l;var p,k,B,u;if(x<v){p=x;k=v}else{p=v;k=x}if(e<d){B=e;u=d}else{B=d;u=e}m=p;c=B;n=k-p;z=u-B;f=s-u;o=t-k}else{m=this.tframe.fX1*t;f=this.tframe.fY1*s;c=(1-this.tframe.fY2)*s;o=(1-this.tframe.fX2+shrink_right)*t;n-=(m+o);z-=(f+c)}r=this.createAttFill(this.tframe)}else{if(E){r=this.createAttFill(null,E.fFrameFillStyle,E.fFrameFillColor)}n-=(m+o);z-=(f+c)}if(r.color=="none"){r.color="white"}var q=this.svg_pad().select(".root_frame");var i=null;if(q.empty()){q=this.svg_pad().select(".frame_layer").append("svg:g").attr("class","root_frame");i=q.append("svg:rect");q.append("svg:g").attr("class","grid_layer");q.append("svg:g").attr("class","main_layer");q.append("svg:g").attr("class","axis_layer");q.append("svg:g").attr("class","upper_layer")}else{i=q.select("rect")}q.property("NDC",{fX1NDC:m/t,fX2NDC:(m+n)/t,fY1NDC:f/s,fY2NDC:(f+z)/s});q.property("frame_painter",this);m=Math.round(m);f=Math.round(f);n=Math.round(n);z=Math.round(z);q.attr("x",m).attr("y",f).attr("width",n).attr("height",z).attr("transform","translate("+m+","+f+")");i.attr("x",0).attr("y",0).attr("width",n).attr("height",z).call(r.func).call(D.func)};a.TFramePainter.prototype.Redraw=function(){this.DrawFrameSvg()};a.Painter.drawFrame=function(e,d){var c=new a.TFramePainter(d);c.SetDivId(e);c.DrawFrameSvg();return c.DrawingReady()};a.TGraphPainter=function(c){a.TObjectPainter.call(this,c);this.graph=c;this.ownhisto=false;this.bins=null};a.TGraphPainter.prototype=Object.create(a.TObjectPainter.prototype);a.TGraphPainter.prototype.GetObject=function(){return this.graph};a.TGraphPainter.prototype.Redraw=function(){this.DrawBins()};a.TGraphPainter.prototype.DecodeOptions=function(c){this.draw_all=true;a.extend(this,{optionLine:0,optionAxis:0,optionCurve:0,optionRect:0,optionMark:0,optionBar:0,optionR:0,optionE:0,optionEF:0,optionFill:0,optionZ:0,optionBrackets:0,opt:"LP",out_of_range:false,has_errors:false,draw_errors:false,is_bent:false});this.is_bent=this.graph._typename=="TGraphBentErrors";this.has_errors=(this.graph._typename=="TGraphErrors"||this.graph._typename=="TGraphAsymmErrors"||this.is_bent||this.graph._typename.match(/^RooHist/));this.draw_errors=this.has_errors;if((c!=null)&&(c!="")){this.opt=c.toUpperCase();this.opt.replace("SAME","")}if(this.opt.indexOf("L")!=-1){this.optionLine=1}if(this.opt.indexOf("F")!=-1){this.optionFill=1}if(this.opt.indexOf("A")!=-1){this.optionAxis=1}if(this.opt.indexOf("C")!=-1){this.optionCurve=1;if(this.optionFill==0){this.optionLine=1}}if(this.opt.indexOf("*")!=-1){this.optionMark=2}if(this.opt.indexOf("P")!=-1){this.optionMark=1}if(this.opt.indexOf("B")!=-1){this.optionBar=1;this.draw_errors=false}if(this.opt.indexOf("R")!=-1){this.optionR=1}if(this.opt.indexOf("[]")!=-1){this.optionBrackets=1;this.draw_errors=false}if(this.opt.indexOf("0")!=-1){this.optionMark=1;this.draw_errors=true;this.out_of_range=true}if(this.opt.indexOf("1")!=-1){if(this.optionBar==1){this.optionBar=2}}if(this.opt.indexOf("2")!=-1){this.optionRect=1}if(this.opt.indexOf("3")!=-1){this.optionEF=1;this.optionLine=0;this.draw_errors=false}if(this.opt.indexOf("4")!=-1){this.optionEF=2;this.optionLine=0;this.draw_errors=false}if(this.opt.indexOf("2")!=-1||this.opt.indexOf("5")!=-1){this.optionE=1}if(this.optionLine+this.optionFill+this.optionMark+this.optionBar+this.optionE+this.optionEF+this.optionRect+this.optionBrackets==0){if(this.opt.length==0){this.optionLine=1}}if(this.graph._typename=="TGraphErrors"){var e=b.max(this.graph.fEX);var d=b.max(this.graph.fEY);if(e<1e-300&&d<1e-300){this.draw_errors=false}}};a.TGraphPainter.prototype.CreateBins=function(){var c=this.graph;if(c==null){return}var e=c.fNpoints;if((c._typename=="TCutG")&&(e>3)){e--}var d=0;if(c._typename=="TGraphErrors"){d=1}else{if(c._typename=="TGraphAsymmErrors"||c._typename=="TGraphBentErrors"||c._typename.match(/^RooHist/)){d=2}}this.bins=b.range(e).map(function(f){if(d==1){return{x:c.fX[f],y:c.fY[f],exlow:c.fEX[f],exhigh:c.fEX[f],eylow:c.fEY[f],eyhigh:c.fEY[f]}}if(d==2){return{x:c.fX[f],y:c.fY[f],exlow:c.fEXlow[f],exhigh:c.fEXhigh[f],eylow:c.fEYlow[f],eyhigh:c.fEYhigh[f]}}return{x:c.fX[f],y:c.fY[f]}})};a.TGraphPainter.prototype.CreateHistogram=function(){var d,j,l,e;if(this.bins==null){d=0;j=1;l=0;e=1}else{for(var f=0;f<this.bins.length;++f){var c=this.bins[f];if((d==null)||(c.x<d)){d=c.x}if((j==null)||(c.x>j)){j=c.x}if((l==null)||(c.y<l)){l=c.y}if((e==null)||(c.y>e)){e=c.y}if("exlow" in c){d=Math.min(d,c.x-c.exlow,c.x+c.exhigh);j=Math.max(j,c.x-c.exlow,c.x+c.exhigh);l=Math.min(l,c.y-c.eylow,c.y+c.eylow);e=Math.max(e,c.y-c.eylow,c.y+c.eylow)}}}if(d==j){j+=1}if(l==e){e+=1}var p=(j-d)*0.1;var o=(e-l)*0.1;var m=d-p,g=j+p;var k=l-o,h=e+o;if((m<0)&&(d>=0)){m=d*0.9}if((g>0)&&(j<=0)){g=0}if(this.graph.fMinimum!=-1111){k=l=this.graph.fMinimum}if(this.graph.fMaximum!=-1111){h=e=this.graph.fMaximum}if((k<0)&&(l>=0)){k=0.9*l}var i=a.CreateTH1(100);i.fName=this.graph.fName+"_h";i.fTitle=this.graph.fTitle;i.fXaxis.fXmin=m;i.fXaxis.fXmax=g;i.fYaxis.fXmin=k;i.fYaxis.fXmax=h;i.fXaxis.fMinimum=k;i.fXaxis.fMaximum=h;i.fBits=i.fBits|a.TH1StatusBits.kNoStats;return i};a.TGraphPainter.prototype.DrawBars=function(){var e=this.bins;if(e.length==1){var f=(this.graph.fHistogram["fXaxis"]["fXmax"]-this.graph.fHistogram["fXaxis"]["fXmin"]);e[0].xl=e[0].x-f/2;e[0].xr=e[0].x+f/2}else{for(var i=0;i<e.length;++i){if(i>0){e[i].xl=(e[i].x+e[i-1].x)/2}if(i<e.length-1){e[i].xr=(e[i].x+e[i+1].x)/2}else{e[i].xr=2*e[i].x-e[i].xl}if(i==0){e[i].xl=2*e[0].x-e[0].xr}}}var d=this.frame_height();var g=(this.optionBar!=1);var c=this.main_painter();return this.draw_g.selectAll("bar_graph").data(e).enter().append("svg:rect").attr("x",function(h){return(c.grx(h.xl)+0.5).toFixed(1)}).attr("y",function(h){if(g||(h.y>=0)){return c.gry(h.y).toFixed(1)}return c.gry(0).toFixed(1)}).attr("width",function(h){return(c.grx(h.xr)-c.grx(h.xl)-1).toFixed(1)}).attr("height",function(j){var h=c.gry(j.y);if(g){return h>d?0:(d-h).toFixed(1)}return(j.y<0)?(h-c.gry(0)).toFixed(1):(c.gry(0)-h).toFixed(1)}).call(this.fillatt.func)};a.TGraphPainter.prototype.DrawBins=function(){var m=this.frame_width(),r=this.frame_height();this.RecreateDrawG(false,".main_layer",false);var f=this;var k=this.main_painter();var x=this.GetItemName();if((x==null)||(x=="")){x=this.graph.fName}if(x.length>0){x+="\n"}function s(i){var h=x+"x = "+k.AxisAsText("x",i.x)+"\ny = "+k.AxisAsText("y",i.y);if(f.draw_errors&&(k.x_kind=="normal")&&("exlow" in i)&&((i.exlow!=0)||(i.exhigh!=0))){h+="\nerror x = -"+k.AxisAsText("x",i.exlow)+"/+"+k.AxisAsText("x",i.exhigh)}if(f.draw_errors&&(k.y_kind=="normal")&&("eylow" in i)&&((i.eylow!=0)||(i.eyhigh!=0))){h+="\nerror y = -"+k.AxisAsText("y",i.eylow)+"/+"+k.AxisAsText("y",i.eyhigh)}return h}this.lineatt=a.Painter.createAttLine(this.graph);this.fillatt=this.createAttFill(this.graph);if(this.optionEF>0){var t=b.svg.area().x(function(h){return k.grx(h.x).toFixed(1)}).y0(function(h){return k.gry(h.y-h.eylow).toFixed(1)}).y1(function(h){return k.gry(h.y+h.eyhigh).toFixed(1)});if(this.optionEF>1){t=t.interpolate(a.gStyle.Interpolate)}this.draw_g.append("svg:path").attr("d",t(this.bins)).style("stroke","none").call(this.fillatt.func)}var l=b.svg.line().x(function(h){return k.grx(h.x).toFixed(1)}).y(function(h){return k.gry(h.y).toFixed(1)});if(this.optionBar){var n=this.DrawBars();if(a.gStyle.Tooltip){n.append("svg:title").text(s)}}if(Math.abs(this.lineatt.width)>99){this.optionMark=0;this.DrawExclusion(l)}else{if(this.optionCurve==1){l=l.interpolate(a.gStyle.Interpolate)}}if(this.optionLine==1||this.optionFill==1){var c="";if(this.graph._typename=="TCutG"){c=" Z"}var v=this.lineatt;if(this.optionLine==0){v=a.Painter.createAttLine("none")}if(this.optionFill!=1){this.fillatt.color="none"}this.draw_g.append("svg:path").attr("d",l(f.bins)+c).attr("class","draw_line").style("pointer-events","none").call(v.func).call(this.fillatt.func);if(a.gStyle.Tooltip&&(this.optionMark==0)){this.draw_g.selectAll("draw_line").data(f.bins).enter().append("svg:circle").attr("cx",function(h){return k.grx(h.x).toFixed(1)}).attr("cy",function(h){return k.gry(h.y).toFixed(1)}).attr("r",3).style("opacity",0).append("svg:title").text(s)}}var n=null;if(this.draw_errors||this.optionMark||this.optionRect||this.optionBrackets){var d=new Array;for(var p=0;p<this.bins.length;++p){var u=this.bins[p];var g=k.grx(u.x);var e=k.gry(u.y);if(!this.out_of_range&&((g<0)||(g>m)||(e<0)||(e>r))){continue}u.grx1=g.toFixed(1);u.gry1=e.toFixed(1);if(this.has_errors){u.grx0=(k.grx(u.x-u.exlow)-g).toFixed(1);u.grx2=(k.grx(u.x+u.exhigh)-g).toFixed(1);u.gry0=(k.gry(u.y-u.eylow)-e).toFixed(1);u.gry2=(k.gry(u.y+u.eyhigh)-e).toFixed(1);if(this.is_bent){u.grdx0=k.gry(u.y+this.graph.fEXlowd[p])-e;u.grdx2=k.gry(u.y+this.graph.fEXhighd[p])-e;u.grdy0=k.grx(u.x+this.graph.fEYlowd[p])-g;u.grdy2=k.grx(u.x+this.graph.fEYhighd[p])-g}else{u.grdx0=0;u.grdx2=0;u.grdy0=0;u.grdy2=0}}d.push(u)}n=this.draw_g.selectAll("g.node").data(d).enter().append("svg:g").attr("transform",function(h){return"translate("+h.grx1+","+h.gry1+")"})}if(a.gStyle.Tooltip&&n){n.append("svg:title").text(s)}if(this.optionRect){n.filter(function(h){return(h.exlow>0)&&(h.exhigh>0)&&(h.eylow>0)&&(h.eyhigh>0)}).append("svg:rect").attr("x",function(h){return h.grx0}).attr("y",function(h){return h.gry2}).attr("width",function(h){return h.grx2-h.grx0}).attr("height",function(h){return h.gry0-h.gry2}).call(this.fillatt.func)}if(this.optionBrackets){var o=n.filter(function(h){return(h.eylow>0)});o.append("svg:line").attr("x1",-5).attr("y1",function(h){return h.gry0}).attr("x2",5).attr("y2",function(h){return h.gry0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",-5).attr("y1",function(h){return h.gry0}).attr("x2",-5).attr("y2",function(h){return Number(h.gry0)-3}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",5).attr("y1",function(h){return h.gry0}).attr("x2",5).attr("y2",function(h){return Number(h.gry0)-3}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o=n.filter(function(h){return(h.eyhigh>0)});o.append("svg:line").attr("x1",-5).attr("y1",function(h){return h.gry2}).attr("x2",5).attr("y2",function(h){return h.gry2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",-5).attr("y1",function(h){return h.gry2}).attr("x2",-5).attr("y2",function(h){return Number(h.gry2)+3}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",5).attr("y1",function(h){return h.gry2}).attr("x2",5).attr("y2",function(h){return Number(h.gry2)+3}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width)}if(this.draw_errors){var o=n.filter(function(h){return(h.exlow>0)});o.append("svg:line").attr("y1",0).attr("x1",0).attr("x2",function(h){return h.grx0}).attr("y2",function(h){return h.grdx0.toFixed(1)}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("y1",function(h){return(h.grdx0-3).toFixed(1)}).attr("x1",function(h){return h.grx0}).attr("y2",function(h){return(h.grdx0+3).toFixed(1)}).attr("x2",function(h){return h.grx0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o=n.filter(function(h){return(h.exhigh>0)});o.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",function(h){return h.grx2}).attr("y2",function(h){return h.grdx2.toFixed(1)}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",function(h){return h.grx2}).attr("y1",function(h){return(h.grdx2-3).toFixed(1)}).attr("x2",function(h){return h.grx2}).attr("y2",function(h){return(h.grdx2+3).toFixed(1)}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o=n.filter(function(h){return(h.eylow>0)});o.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",function(h){return h.grdy0.toFixed(1)}).attr("y2",function(h){return h.gry0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",function(h){return(h.grdy0-3).toFixed(1)}).attr("y1",function(h){return h.gry0}).attr("x2",function(h){return(h.grdy0+3).toFixed(1)}).attr("y2",function(h){return h.gry0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o=n.filter(function(h){return(h.eyhigh>0)});o.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",function(h){return h.grdy2.toFixed(1)}).attr("y2",function(h){return h.gry2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.append("svg:line").attr("x1",function(h){return(h.grdy2-3).toFixed(1)}).attr("y1",function(h){return h.gry2}).attr("x2",function(h){return(h.grdy2+3).toFixed(1)}).attr("y2",function(h){return h.gry2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width)}if(this.optionMark){var q=(this.optionMark==2)?3:null;var j=a.Painter.createAttMarker(this.graph,q);n.append("svg:path").call(j.func)}};a.TGraphPainter.prototype.DrawExclusion=function(r){var z,y;var Q=this.graph.fNpoints;var H=new Array(Q+2),x=new Array(Q+2),F=new Array(Q+2),s=new Array(Q+2),L=new Array(2*Q+2),A=new Array(2*Q+2);var U,S,R,c,d=1;if(this.lineatt.width<0){this.lineatt.width=-this.lineatt.width;d=-1}d*=Math.floor(this.lineatt.width/100)*0.005;this.lineatt.width=this.lineatt.width%100;if(this.lineatt.width>0){this.optionLine=1}var J=this.frame_width(),T=this.frame_height();var K=J/T;var q=this.main_painter().xmin,I=this.main_painter().xmax,G=this.main_painter().ymin,g=this.main_painter().ymax;for(S=0;S<Q;++S){H[S]=(this.graph.fX[S]-q)/(I-q);x[S]=(this.graph.fY[S]-G)/(g-G);if(J>T){x[S]=x[S]/K}else{if(T>J){H[S]=H[S]/K}}}L[0]=H[0];A[0]=x[0];c=0;for(S=1;S<Q;++S){if(H[S]==H[S-1]&&x[S]==x[S-1]){continue}L[++c]=H[S];if(L[S]==L[S-1]){L[S]+=0.000001}A[c]=x[S]}if(L[1]==L[0]){U=Math.PI/2}else{U=Math.atan((A[1]-A[0])/(L[1]-L[0]))}if(L[0]<=L[1]){F[0]=L[0]-d*Math.sin(U);s[0]=A[0]+d*Math.cos(U)}else{F[0]=L[0]+d*Math.sin(U);s[0]=A[0]-d*Math.cos(U)}if(L[c]==L[c-1]){U=Math.PI/2}else{U=Math.atan((A[c]-A[c-1])/(L[c]-L[c-1]))}if(L[c]>=L[c-1]){F[c]=L[c]-d*Math.sin(U);s[c]=A[c]+d*Math.cos(U)}else{F[c]=L[c]+d*Math.sin(U);s[c]=A[c]-d*Math.cos(U)}var P,O,N,v,p,u,o,t,m;for(S=1;S<c;++S){v=L[S];p=A[S];u=L[S+1];o=A[S+1];t=L[S-1];m=A[S-1];if(u==v){P=Math.PI/2}else{P=Math.atan((o-p)/(u-v))}if(u<v){P=P+Math.PI}if(t==v){O=Math.PI/2}else{O=Math.atan((p-m)/(v-t))}if(v<t){O=O+Math.PI}x1=v-d*Math.sin(P);y1=p+d*Math.cos(P);x2=v-d*Math.sin(O);y2=p+d*Math.cos(O);xm=(x1+x2)*0.5;ym=(y1+y2)*0.5;if(xm==v){N=Math.PI/2}else{N=Math.atan((ym-p)/(xm-v))}x3=v-d*Math.sin(N+(Math.PI/2));y3=p+d*Math.cos(N+(Math.PI/2));if((xm-v)*(x3-v)<0&&(ym-p)*(y3-p)<0){x3=2*v-x3;y3=2*p-y3}if((xm==x1)&&(ym==y1)){x3=xm;y3=ym}F[S]=x3;s[S]=y3}if(L[c]==L[0]&&A[c]==A[0]){xm=(F[c]+F[0])*0.5;ym=(s[c]+s[0])*0.5;if(xm==L[0]){N=Math.PI/2}else{N=Math.atan((ym-A[0])/(xm-L[0]))}x3=L[0]+d*Math.sin(N+(Math.PI/2));y3=A[0]-d*Math.cos(N+(Math.PI/2));if((xm-L[0])*(x3-L[0])<0&&(ym-A[0])*(y3-A[0])<0){x3=2*L[0]-x3;y3=2*A[0]-y3}F[c]=x3;F[0]=x3;s[c]=y3;s[0]=y3}var M,C,l,E,k,D;var e=false;var B=c;for(S=B;S>0;S--){for(R=S-1;R>0;R--){if(F[S-1]==F[S]||F[R-1]==F[R]){continue}l=(s[S-1]-s[S])/(F[S-1]-F[S]);E=s[S]-l*F[S];k=(s[R-1]-s[R])/(F[R-1]-F[R]);D=s[R]-k*F[R];if(l!=k){M=(D-E)/(l-k);C=l*M+E;if(M>Math.min(F[S],F[S-1])&&M<Math.max(F[S],F[S-1])&&M>Math.min(F[R],F[R-1])&&M<Math.max(F[R],F[R-1])&&C>Math.min(s[S],s[S-1])&&C<Math.max(s[S],s[S-1])&&C>Math.min(s[R],s[R-1])&&C<Math.max(s[R],s[R-1])){L[++c]=F[S];A[c]=s[S];L[++c]=M;A[c]=C;S=R;e=true;break}else{continue}}else{continue}}if(!e){L[++c]=F[S];A[c]=s[S]}e=false}L[++c]=F[0];A[c]=s[0];++c;for(S=0;S<c;++S){if(J>T){L[S]=q+(L[S]*(I-q));A[S]=G+(A[S]*(g-G))*K}else{if(T>J){L[S]=q+(L[S]*(I-q))*K;A[S]=G+(A[S]*(g-G))}else{L[S]=q+(L[S]*(I-q));A[S]=G+(A[S]*(g-G))}}if((L[S]<=0)&&this.main_painter().options.Logx){L[S]=q}if((A[S]<=0)&&this.main_painter().options.Logy){A[S]=G}}var f=b.range(c).map(function(h){return{x:L[h],y:A[h]}});H.splice(0,H.length);x.splice(0,x.length);H=null;x=null;F.splice(0,F.length);s.splice(0,s.length);F=null;s=null;L.splice(0,L.length);A.splice(0,A.length);L=null;A=null;this.draw_g.append("svg:path").attr("d",r(f)).style("stroke","none").style("stroke-width",1).call(this.fillatt.func).style("opacity",0.75)};a.TGraphPainter.prototype.UpdateObject=function(c){if(c._typename!=this.graph._typename){return false}if(this.ownhisto){this.main_painter().UpdateObject(c.fHistogram)}this.graph.fX=c.fX;this.graph.fY=c.fY;this.graph.fNpoints=c.fNpoints;this.CreateBins();return true};a.TGraphPainter.prototype.CanZoomIn=function(e,d,c){if(e!="x"){return false}for(var f=0;f<this.bins.length;++f){if((d<this.bins[f].x)&&(c>this.bins[f].x)){return true}}return false};a.TGraphPainter.prototype.DrawNextFunction=function(f,g){if((this.graph.fFunctions==null)||(f>=this.graph.fFunctions.arr.length)){return a.CallBack(g)}var e=this.graph.fFunctions.arr[f];var d=this.graph.fFunctions.opt[f];var c=a.draw(this.divid,e,d);if(c){return c.WhenReady(this.DrawNextFunction.bind(this,f+1,g))}this.DrawNextFunction(f+1,g)};a.Painter.drawGraph=function(f,e,d){var c=new a.TGraphPainter(e);c.CreateBins();c.SetDivId(f,-1);if(c.main_painter()==null){if(e.fHistogram==null){e.fHistogram=c.CreateHistogram()}a.Painter.drawHistogram1D(f,e.fHistogram,"AXIS");c.ownhisto=true}c.SetDivId(f);c.DecodeOptions(d);c.DrawBins();c.DrawNextFunction(0,c.DrawingReady.bind(c));return c};a.TPavePainter=function(c){a.TObjectPainter.call(this,c);this.pavetext=c;this.Enabled=true};a.TPavePainter.prototype=Object.create(a.TObjectPainter.prototype);a.TPavePainter.prototype.GetObject=function(){return this.pavetext};a.TPavePainter.prototype.DrawPaveText=function(){var s=this.pavetext;var r=this.pad_width(),G=this.pad_height();if((s.fOption.indexOf("NDC")<0)&&!s.fInit){s.fInit=1;var J=this.root_pad();if(J!=null){if(J.fLogx){if(s.fX1>0){s.fX1=a.log10(s.fX1)}if(s.fX2>0){s.fX2=a.log10(s.fX2)}}if(J.fLogy){if(s.fY1>0){s.fY1=a.log10(s.fY1)}if(s.fY2>0){s.fY2=a.log10(s.fY2)}}s.fX1NDC=(s.fX1-J.fX1)/(J.fX2-J.fX1);s.fY1NDC=(s.fY1-J.fY1)/(J.fY2-J.fY1);s.fX2NDC=(s.fX2-J.fX1)/(J.fX2-J.fX1);s.fY2NDC=(s.fY2-J.fY1)/(J.fY2-J.fY1)}else{s.fX1NDC=0.1;s.fX2NDC=0.9;s.fY1NDC=0.1;s.fY2NDC=0.9}}var f=Math.round(s.fX1NDC*r);var c=Math.round((1-s.fY1NDC)*G);var C=Math.round(Math.abs(s.fX2NDC-s.fX1NDC)*r);var v=Math.round(Math.abs(s.fY2NDC-s.fY1NDC)*G);c-=v;var u=s.fLines.arr.length;var M=a.Painter.root_colors[s.fTextColor];var I=a.Painter.root_colors[s.fShadowColor];var m=this.createAttFill(s);var K=s.fBorderSize?s.fBorderSize:0;var e=a.Painter.createAttLine(s,K>0?1:0);var N=0,H=0;var g=new Array;for(var F=0;F<u;++F){var q=s.fLines.arr[F]["fTitle"];g.push(q);if(!this.IsStats()||(F==0)||(q.indexOf("|")<0)){continue}if(N===0){N=F}var B=q.split("|");if(B.length>H){H=B.length}}var o=this;this.RecreateDrawG(true,".stat_layer");this.draw_g.attr("x",f).attr("y",c).attr("width",C).attr("height",v).attr("transform","translate("+f+","+c+")");var i=this.draw_g.append("rect").attr("x",0).attr("y",0).attr("width",C).attr("height",v).call(m.func).call(e.func);var A=v/u,l=false;var L=s.fMargin*C;this.StartTextDrawing(s.fTextFont,v/(u*1.2));if(u==1){this.DrawText(s.fTextAlign,0,0,C,v,g[0],M)}else{for(var F=0;F<u;++F){var E=a.Painter.root_colors[s.fLines.arr[F]["fTextColor"]];if(s.fLines.arr[F]["fTextColor"]==0){E=M}var z=F*A;if(this.IsStats()){if((N>0)&&(F>=N)){var B=g[F].split("|");for(var y=0;y<B.length;++y){this.DrawText("middle",C*y/H,z,C/H,A,B[y],E)}}else{if(g[F].indexOf("=")<0){if(F==0){l=true}this.DrawText((F==0)?"middle":"start",L,z,C-2*L,A,g[F],E)}else{var B=g[F].split("="),p=0;for(var y=0;y<2;++y){p+=this.DrawText((y==0)?"start":"end",L,z,C-2*L,A,B[y],E)}this.TextScaleFactor(1.05*p/(C-2*L),this.draw_g)}}}else{this.DrawText(s.fTextAlign,L,z,C-2*L,A,g[F],E)}}}var d=this.FinishTextDrawing();if(s.fBorderSize&&l){this.draw_g.append("svg:line").attr("x1",0).attr("y1",A.toFixed(1)).attr("x2",C).attr("y2",A.toFixed(1)).call(e.func)}if((N>0)&&(H>1)){for(var D=N;D<u;++D){this.draw_g.append("svg:line").attr("x1",0).attr("y1",(D*A).toFixed(1)).attr("x2",C).attr("y2",(D*A).toFixed(1)).call(e.func)}for(var x=0;x<H-1;++x){this.draw_g.append("svg:line").attr("x1",(C/H*(x+1)).toFixed(1)).attr("y1",(N*A).toFixed(1)).attr("x2",(C/H*(x+1)).toFixed(1)).attr("y2",v).call(e.func)}}if(K&&K>1){this.draw_g.append("svg:line").attr("x1",C+(K/2)).attr("y1",K+1).attr("x2",C+(K/2)).attr("y2",v+K-1).style("stroke",e.color).style("stroke-width",K);this.draw_g.append("svg:line").attr("x1",K+1).attr("y1",v+(K/2)).attr("x2",C+K-1).attr("y2",v+(K/2)).style("stroke",e.color).style("stroke-width",K)}if((s.fLabel.length>0)&&!this.IsStats()){var k=this.draw_g.append("svg:g").attr("x",C*0.25).attr("y",-G*0.02).attr("width",C*0.5).attr("height",G*0.04).attr("transform","translate("+C*0.25+","+-G*0.02+")");var t=k.append("rect").attr("x",0).attr("y",0).attr("width",C*0.5).attr("height",G*0.04).call(m.func).call(e.func);this.StartTextDrawing(s.fTextFont,G*0.04/1.5,k);this.DrawText(22,0,0,C*0.5,G*0.04,s.fLabel,M,1,k);this.FinishTextDrawing(k)}this.AddDrag({obj:s,redraw:this.DrawPaveText.bind(this),ctxmenu:a.touches&&a.gStyle.ContextMenu});if(this.IsStats()&&a.gStyle.ContextMenu&&!a.touches){this.draw_g.on("contextmenu",this.ShowContextMenu.bind(this))}};a.TPavePainter.prototype.AddLine=function(c){this.pavetext.AddText(c)};a.TPavePainter.prototype.IsStats=function(){if(!this.pavetext){return false}return this.pavetext._typename=="TPaveStats"};a.TPavePainter.prototype.Format=function(e,c){if(!c){c="stat"}if(c=="stat"){c=this.pavetext.fStatFormat;if(!c){c=a.gStyle.StatFormat}}else{if(c=="fit"){c=this.pavetext.fFitFormat;if(!c){c=a.gStyle.FitFormat}}else{if(c=="entries"){if(e<1000000000){return e.toFixed(0)}c="14.7g"}else{if(c=="last"){c=this["lastformat"]}}}}delete this["lastformat"];if(!c){c="6.4g"}var d=a.FFormat(e,c);this["lastformat"]=a.lastFFormat;return d};a.TPavePainter.prototype.ShowContextMenu=function(d,e){if(!e){b.event.stopPropagation();b.event.preventDefault();e=b.event}var c=this;a.Painter.createMenu(function(g){g.painter=c;g.add("header: "+c.pavetext._typename+"::"+c.pavetext.fName);g.add("SetStatFormat",function(){var h=prompt("Enter StatFormat",c.pavetext.fStatFormat);if(h!=null){c.pavetext.fStatFormat=h;c.Redraw()}});g.add("SetFitFormat",function(){var h=prompt("Enter FitFormat",c.pavetext.fFitFormat);if(h!=null){c.pavetext.fFitFormat=h;c.Redraw()}});g.add("separator");g.add("SetOptStat",function(){var h=prompt("Enter OptStat",c.pavetext.fOptStat);if(h!=null){c.pavetext.fOptStat=parseInt(h);c.Redraw()}});g.add("separator");function f(j,h){var i=(j<10)?c.pavetext.fOptStat:c.pavetext.fOptFit;i=parseInt(parseInt(i)/parseInt(Math.pow(10,j%10)))%10;g.addchk(i,h,i*100+j,function(k){var m=(k%100<10)?c.pavetext.fOptStat:c.pavetext.fOptFit;var l=parseInt(k/100);m-=(l>0?l:-1)*parseInt(Math.pow(10,k%10));if(k%100<10){c.pavetext.fOptStat=m}else{c.pavetext.fOptFit=m}c.Redraw()})}f(0,"Histogram name");f(1,"Entries");f(2,"Mean");f(3,"Std Dev");f(4,"Underflow");f(5,"Overflow");f(6,"Integral");f(7,"Skewness");f(8,"Kurtosis");g.add("separator");g.add("SetOptFit",function(){var h=prompt("Enter OptStat",c.pavetext.fOptFit);if(h!=null){c.pavetext.fOptFit=parseInt(h);c.Redraw()}});g.add("separator");f(10,"Fit parameters");f(11,"Par errors");f(12,"Chi square / NDF");f(13,"Probability");g.show(e)})};a.TPavePainter.prototype.FillStatistic=function(){if(!this.IsStats()){return false}if(this.pavetext.fName!="stats"){return false}var c=this.main_painter();if(!("FillStatistic" in c)){return false}if(c.IsDummyHisto()){return true}var d=new Number(this.pavetext.fOptStat);var e=new Number(this.pavetext.fOptFit);if(!d){d=a.gStyle.OptStat}if(!e){e=a.gStyle.OptFit}this.pavetext.Clear();c.FillStatistic(this,d,e);return true};a.TPavePainter.prototype.UpdateObject=function(c){if(c._typename!="TPaveText"){return false}this.pavetext.fLines=a.clone(c.fLines);return true};a.TPavePainter.prototype.Redraw=function(){if(this.Enabled){this.FillStatistic();this.DrawPaveText()}else{this.RemoveDrawG()}};a.Painter.drawPaveText=function(e,d){var c=new a.TPavePainter(d);c.SetDivId(e);c.FillStatistic();c.DrawPaveText();return c.DrawingReady()};a.TPadPainter=function(d,c){a.TObjectPainter.call(this,d);if(this.obj_typename==""){this.obj_typename=c?"TCanvas":"TPad"}this.pad=d;this.iscan=c;this.painters=new Array};a.TPadPainter.prototype=Object.create(a.TObjectPainter.prototype);a.TPadPainter.prototype.CreateCanvasSvg=function(f,d){var e=this.select_main();var l=e.node().getBoundingClientRect();var m=Math.round(l.width-this.GetStyleValue(e,"padding-left")-this.GetStyleValue(e,"padding-right")),g=Math.round(l.height-this.GetStyleValue(e,"padding-top")-this.GetStyleValue(e,"padding-bottom"));if((typeof d=="object")&&("width" in d)&&("height" in d)){m=d.width;g=d.height}var k=null,i=null;if(f>0){i=this.svg_canvas();var j=i.property("draw_width"),c=i.property("draw_height");if((m<=0)&&(g<=0)){i.attr("visibility","hidden");return false}else{i.attr("visibility","visible")}if(f==1){if((j==m)&&(c==g)){return false}}k=i.property("height_factor");if(k!=null){g=Math.round(m*k);e.style("height",g+"px")}if((f==1)&&(j>0)&&(c>0)&&!i.property("redraw_by_resize")){if((m/j>0.5)&&(m/j<2)&&(g/c>0.5)&&(g/c<2)){if(typeof d=="object"){i.attr("width",m).attr("height",g)}return false}}}else{if((g<10)&&(m>0)){k=0.66;if((this.pad!=null)&&("fCw" in this.pad)&&("fCh" in this.pad)&&(this.pad.fCw>0)){k=this.pad.fCh/this.pad.fCw;if((k<0.1)||(k>10)){k=0.66}}g=Math.round(m*k);e.style("height",g+"px")}var n=null;if(this.pad&&"fFillColor" in this.pad){n=this.createAttFill(this.pad)}else{n=this.createAttFill("white")}e.style("background-color",n.color);i=this.select_main().append("svg").attr("class","root_canvas").style("background-color",n.color).property("pad_painter",this).property("mainpainter",null).property("current_pad","");i.append("svg:g").attr("class","frame_layer");i.append("svg:g").attr("class","text_layer");i.append("svg:g").attr("class","stat_layer")}if((m<=0)||(g<=0)){i.attr("visibility","hidden");m=200;g=100}else{i.attr("visibility","visible")}i.attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+m+" "+g).attr("preserveAspectRatio","none").property("height_factor",k).property("draw_width",m).property("draw_height",g).property("redraw_by_resize",false);return true};a.TPadPainter.prototype.CreatePadSvg=function(n){var d=this.svg_canvas().property("draw_width"),l=this.svg_canvas().property("draw_height"),j=Math.round(this.pad.fAbsXlowNDC*d),i=Math.round(l-this.pad.fAbsYlowNDC*l),k=Math.round(this.pad.fAbsWNDC*d),g=Math.round(this.pad.fAbsHNDC*l);i-=g;var m=this.createAttFill(this.pad);var c=a.Painter.createAttLine(this.pad);if(this.pad.fBorderMode==0){c.color="none"}var e=null,f=null;if(n){e=this.svg_pad();f=e.select(".root_pad_border")}else{e=this.svg_canvas().append("g").attr("class","root_pad").attr("pad",this.pad.fName).property("pad_painter",this).property("mainpainter",null);f=e.append("svg:rect").attr("class","root_pad_border");e.append("svg:g").attr("class","frame_layer");e.append("svg:g").attr("class","text_layer");e.append("svg:g").attr("class","stat_layer")}e.attr("width",k).attr("height",g).attr("viewBox",j+" "+i+" "+(j+k)+" "+(i+g)).attr("transform","translate("+j+","+i+")").property("draw_width",k).property("draw_height",g);f.attr("x",0).attr("y",0).attr("width",k).attr("height",g).call(m.func).call(c.func)};a.TPadPainter.prototype.CheckColors=function(d){if(d==null){return}for(var c=0;c<d.fPrimitives.arr.length;++c){var e=d.fPrimitives.arr[c];if(e==null){continue}if((e._typename=="TObjArray")&&(e.name=="ListOfColors")){a.Painter.adoptRootColors(e);d.fPrimitives.arr.splice(c,1);d.fPrimitives.opt.splice(c,1);return}}};a.TPadPainter.prototype.DrawPrimitive=function(d,e){if((this.pad==null)||(d>=this.pad.fPrimitives.arr.length)){return a.CallBack(e)}var c=a.draw(this.divid,this.pad.fPrimitives.arr[d],this.pad.fPrimitives.opt[d]);if(c){c._primitive=true;return c.WhenReady(this.DrawPrimitive.bind(this,d+1,e))}this.DrawPrimitive(d+1,e)};a.TPadPainter.prototype.Redraw=function(){if(this.iscan){this.CreateCanvasSvg(2)}else{this.CreatePadSvg(true)}for(var c=0;c<this.painters.length;++c){this.painters[c].Redraw()}};a.TPadPainter.prototype.CheckCanvasResize=function(d){if(!this.iscan){return}var e=this.CreateCanvasSvg(1,d);if(e){for(var c=0;c<this.painters.length;++c){this.painters[c].Redraw()}}};a.TPadPainter.prototype.UpdateObject=function(g){if((g==null)||!("fPrimitives" in g)){return false}if(this.iscan){this.CheckColors(g)}if(g.fPrimitives.arr.length!=this.pad.fPrimitives.arr.length){return false}var e=false,f=0;for(var h in g.fPrimitives.arr){var d=g.fPrimitives.arr[h];while(f<this.painters.length){var c=this.painters[f++];if(!("_primitive" in c)){continue}if(c.UpdateObject(d)){e=true}break}}return e};a.Painter.drawCanvas=function(e,d){var c=new a.TPadPainter(d,true);c.SetDivId(e,-1);c.CreateCanvasSvg(0);c.SetDivId(e);if(d==null){a.Painter.drawFrame(e,null);return c.DrawingReady()}c.CheckColors(d);c.DrawPrimitive(0,c.DrawingReady.bind(c));return c};a.Painter.drawPad=function(f,e){var c=new a.TPadPainter(e,false);c.SetDivId(f);c.CreatePadSvg();c.pad_name=e.fName;var d=c.svg_canvas().property("current_pad");c.svg_canvas().property("current_pad",e.fName);c.DrawPrimitive(0,function(){c.svg_canvas().property("current_pad",d);c.DrawingReady()});return c};a.THistPainter=function(c){a.TObjectPainter.call(this,c);this.histo=c;this.shrink_frame_left=0;this.draw_content=true;this.nbinsx=0;this.nbinsy=0;this.x_kind="normal";this.y_kind="normal"};a.THistPainter.prototype=Object.create(a.TObjectPainter.prototype);a.THistPainter.prototype.GetObject=function(){return this.histo};a.THistPainter.prototype.IsDummyHisto=function(){return(this.histo==null)||!this.draw_content||(this.options.Axis>0)};a.THistPainter.prototype.IsTProfile=function(){return this.histo&&this.histo._typename=="TProfile"};a.THistPainter.prototype.IsTH2Poly=function(){return this.histo&&this.histo._typename.match(/^TH2Poly/)};a.THistPainter.prototype.Dimension=function(){if(!this.histo){return 0}if(this.histo._typename.indexOf("TH2")==0){return 2}if(this.histo._typename.indexOf("TH3")==0){return 3}return 1};a.THistPainter.prototype.DecodeOptions=function(d){if((d==null)||(d=="")){d=this.histo.fOption}var h=this.Dimension();var m={Axis:0,Bar:0,Curve:0,Error:0,Hist:0,Line:0,Mark:0,Fill:0,Same:0,Scat:0,Func:0,Star:0,Arrow:0,Box:0,Text:0,Char:0,Color:0,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:0,Pie:0,List:0,Zscale:0,FrontBox:1,BackBox:1,System:a.Painter.Coord.kCARTESIAN,AutoColor:0,NoStat:0,AutoZoom:false,HighRes:0,Zero:0,Logx:0,Logy:0,Logz:0,Gridx:0,Gridy:0,Palette:0,Optimize:a.gStyle.OptimizeDraw};var j=d.toUpperCase();j=a.Painter.clearCuts(j);if(h>1){m.Scat=1}if((h==1)&&(this.histo.fSumw2.length>0)){m.Error=2}if("fFunctions" in this.histo){m.Func=1}var k=j.indexOf("PAL");if(k>=0){var f=k+3;while((f<j.length)&&(j.charCodeAt(f)>=48)&&(j.charCodeAt(f)<58)){++f}if(f>k+3){m.Palette=parseInt(j.substring(k+3,f));j=j.replace(j.substring(k,f),"")}}if(j.indexOf("NOOPTIMIZE")!=-1){m.Optimize=0;j=j.replace("NOOPTIMIZE","")}if(j.indexOf("OPTIMIZE")!=-1){m.Optimize=2;j=j.replace("OPTIMIZE","")}if(j.indexOf("AUTOCOL")!=-1){m.AutoColor=1;m.Hist=1;j=j.replace("AUTOCOL","")}if(j.indexOf("AUTOZOOM")!=-1){m.AutoZoom=1;m.Hist=1;j=j.replace("AUTOZOOM","")}if(j.indexOf("NOSTAT")!=-1){m.NoStat=1;j=j.replace("NOSTAT","")}if(j.indexOf("LOGX")!=-1){m.Logx=1;j=j.replace("LOGX","")}if(j.indexOf("LOGY")!=-1){m.Logy=1;j=j.replace("LOGY","")}if(j.indexOf("LOGZ")!=-1){m.Logz=1;j=j.replace("LOGZ","")}j=j.trim();while((j.length>0)&&(j[0]==","||j[0]==";")){j=j.substr(1)}var o=j.length;if(!o){m.Hist=1}var g=j.indexOf("SPEC");if(g!=-1){m.Scat=0;j=j.replace("SPEC","    ");var n=0;g=j.indexOf("BF(");if(g!=-1){n=parseInt(j)}m.Spec=Math.max(1600,n);return m}if(j.indexOf("GL")!=-1){j=j.replace("GL","  ")}if(j.indexOf("X+")!=-1){m.AxisPos=10;j=j.replace("X+","  ")}if(j.indexOf("Y+")!=-1){m.AxisPos+=1;j=j.replace("Y+","  ")}if((m.AxisPos==10||m.AxisPos==1)&&(o==2)){m.Hist=1}if(m.AxisPos==11&&o==4){m.Hist=1}if(j.indexOf("SAMES")!=-1){if(o==5){m.Hist=1}m.Same=2;j=j.replace("SAMES","     ")}if(j.indexOf("SAME")!=-1){if(o==4){m.Hist=1}m.Same=1;j=j.replace("SAME","    ")}if(j.indexOf("PIE")!=-1){m.Pie=1;j=j.replace("PIE","   ")}g=j.indexOf("LEGO");if(g!=-1){m.Scat=0;m.Lego=1;j=j.replace("LEGO","    ");if(j[g+4]=="1"){m.Lego=11;j[g+4]=" "}if(j[g+4]=="2"){m.Lego=12;j[g+4]=" "}if(j[g+4]=="3"){m.Lego=13;j[g+4]=" "}g=j.indexOf("FB");if(g!=-1){m.FrontBox=0;j=j.replace("FB","  ")}g=j.indexOf("BB");if(g!=-1){m.BackBox=0;j=j.replace("BB","  ")}g=j.indexOf("0");if(g!=-1){m.Zero=1;j=j.replace("0"," ")}}g=j.indexOf("SURF");if(g!=-1){m.Scat=0;m.Surf=1;j=j.replace("SURF","    ");if(j[g+4]=="1"){m.Surf=11;j[g+4]=" "}if(j[g+4]=="2"){m.Surf=12;j[g+4]=" "}if(j[g+4]=="3"){m.Surf=13;j[g+4]=" "}if(j[g+4]=="4"){m.Surf=14;j[g+4]=" "}if(j[g+4]=="5"){m.Surf=15;j[g+4]=" "}if(j[g+4]=="6"){m.Surf=16;j[g+4]=" "}if(j[g+4]=="7"){m.Surf=17;j[g+4]=" "}g=j.indexOf("FB");if(g!=-1){m.FrontBox=0;j=j.replace("FB","  ")}g=j.indexOf("BB");if(g!=-1){m.BackBox=0;j=j.replace("BB","  ")}}g=j.indexOf("TF3");if(g!=-1){g=j.indexOf("FB");if(g!=-1){m.FrontBox=0;j=j.replace("FB","  ")}g=j.indexOf("BB");if(g!=-1){m.BackBox=0;j=j.replace("BB","  ")}}g=j.indexOf("ISO");if(g!=-1){g=j.indexOf("FB");if(g!=-1){m.FrontBox=0;j=j.replace("FB","  ")}g=j.indexOf("BB");if(g!=-1){m.BackBox=0;j=j.replace("BB","  ")}}g=j.indexOf("LIST");if(g!=-1){m.List=1;j=j.replace("LIST","  ")}g=j.indexOf("CONT");if(g!=-1){j=j.replace("CONT","    ");if(h>1){m.Scat=0;m.Contour=1;if(j[g+4]=="1"){m.Contour=11;j[g+4]=" "}if(j[g+4]=="2"){m.Contour=12;j[g+4]=" "}if(j[g+4]=="3"){m.Contour=13;j[g+4]=" "}if(j[g+4]=="4"){m.Contour=14;j[g+4]=" "}if(j[g+4]=="5"){m.Contour=15;j[g+4]=" "}}else{m.Hist=1}}g=j.indexOf("HBAR");if(g!=-1){m.Hist=0;m.Bar=20;j=j.replace("HBAR","    ");if(j[g+4]=="1"){m.Bar=21;j[g+4]=" "}if(j[g+4]=="2"){m.Bar=22;j[g+4]=" "}if(j[g+4]=="3"){m.Bar=23;j[g+4]=" "}if(j[g+4]=="4"){m.Bar=24;j[g+4]=" "}}g=j.indexOf("BAR");if(g!=-1){m.Hist=0;m.Bar=10;j=j.replace("BAR","   ");if(j[g+3]=="1"){m.Bar=11;j[g+3]=" "}if(j[g+3]=="2"){m.Bar=12;j[g+3]=" "}if(j[g+3]=="3"){m.Bar=13;j[g+3]=" "}if(j[g+3]=="4"){m.Bar=14;j[g+3]=" "}}g=j.indexOf("ARR");if(g!=-1){j=j.replace("ARR","   ");if(h>1){m.Arrow=1;m.Scat=0}else{m.Hist=1}}g=j.indexOf("BOX");if(g!=-1){j=j.replace("BOX","   ");if(h>1){Hoption.Scat=0;Hoption.Box=1;if(j[g+3]=="1"){m.Box=11;j[g+3]=" "}}else{m.Hist=1}}g=j.indexOf("COL");if(g!=-1){var c="COL";if(j.charAt(g+3)=="0"){m.Color=111;c+="0";++g}else{if(j.charAt(g+3)=="1"){m.Color=1;c+="1";++g}else{if(j.charAt(g+3)=="2"){m.Color=2;c+="2";++g}else{if(j.charAt(g+3)=="3"){m.Color=3;c+="3";++g}else{m.Color=a.gStyle.DefaultCol}}}}if(j.charAt(g+4)=="Z"){m.Zscale=1;c+="Z"}j=j.replace(c,"");if(h==1){m.Hist=1}else{m.Scat=0}}if(j.indexOf("CHAR")!=-1){m.Char=1;j=j.replace("CHAR","    ");m.Scat=0}g=j.indexOf("FUNC");if(g!=-1){m.Func=2;j=j.replace("FUNC","    ");m.Hist=0}g=j.indexOf("HIST");if(g!=-1){m.Hist=2;j=j.replace("HIST","    ");m.Func=0;m.Error=0}if(j.indexOf("AXIS")!=-1){m.Axis=1;j=j.replace("AXIS","    ")}if(j.indexOf("AXIG")!=-1){m.Axis=2;j=j.replace("AXIG","    ")}if(j.indexOf("SCAT")!=-1){m.Scat=1;j=j.replace("SCAT","    ")}g=j.indexOf("TEXT");if(g!=-1){var e=parseInt(j);if(!isNaN(e)){if(e<0){e=0}if(e>90){e=90}m.Text=1000+e}else{m.Text=1}j=j.replace("TEXT","    ");g=j.indexOf("N");if(g!=-1&&this.IsTH2Poly()){m.Text+=3000}m.Scat=0}if(j.indexOf("POL")!=-1){m.System=a.Painter.Coord.kPOLAR;j=j.replace("POL","   ")}if(j.indexOf("CYL")!=-1){m.System=a.Painter.Coord.kCYLINDRICAL;j=j.replace("CYL","   ")}if(j.indexOf("SPH")!=-1){m.System=a.Painter.Coord.kSPHERICAL;j=j.replace("SPH","   ")}g=j.indexOf("PSR");if(g!=-1){m.System=a.Painter.Coord.kRAPIDITY;j=j.replace("PSR","   ")}g=j.indexOf("TRI");if(g!=-1){m.Scat=0;m.Color=0;m.Tri=1;j=j.replace("TRI","   ");g=j.indexOf("FB");if(g!=-1){m.FrontBox=0;j=j.replace("FB","  ")}g=j.indexOf("BB");if(g!=-1){m.BackBox=0;j=j.replace("BB","  ")}g=j.indexOf("ERR");if(g!=-1){j=j.replace("ERR","   ")}}g=j.indexOf("AITOFF");if(g!=-1){Hoption.Proj=1;j=j.replace("AITOFF","      ")}g=j.indexOf("MERCATOR");if(g!=-1){m.Proj=2;j=j.replace("MERCATOR","        ")}g=j.indexOf("SINUSOIDAL");if(g!=-1){m.Proj=3;j=j.replace("SINUSOIDAL","         ")}g=j.indexOf("PARABOLIC");if(g!=-1){m.Proj=4;j=j.replace("PARABOLIC","         ")}if(m.Proj>0){m.Scat=0;m.Contour=14}if(j.indexOf("A")!=-1){m.Axis=-1}if(j.indexOf("B")!=-1){m.Bar=1}if(j.indexOf("C")!=-1){m.Curve=1;m.Hist=-1}if(j.indexOf("F")!=-1){m.Fill=1}if(j.indexOf("][")!=-1){m.Off=1;m.Hist=1}if(j.indexOf("F2")!=-1){m.Fill=2}if(j.indexOf("L")!=-1){m.Line=1;m.Hist=-1}if(j.indexOf("P")!=-1){m.Mark=1;m.Hist=-1;if(j.indexOf("P0")!=-1){m.Mark=10}}if(j.indexOf("Z")!=-1){m.Zscale=1}if(j.indexOf("*")!=-1){m.Star=1}if(j.indexOf("H")!=-1){m.Hist=2}if(this.IsTH2Poly()){if(m.Fill+m.Line+m.Mark!=0){m.Scat=0}}if(j.indexOf("E")!=-1){if(h==1){m.Error=1;if(j.indexOf("E0")!=-1){m.Error=10}if(j.indexOf("E1")!=-1){m.Error=11}if(j.indexOf("E2")!=-1){m.Error=12}if(j.indexOf("E3")!=-1){m.Error=13}if(j.indexOf("E4")!=-1){m.Error=14}if(j.indexOf("E5")!=-1){m.Error=15}if(j.indexOf("E6")!=-1){m.Error=16}if(j.indexOf("X0")!=-1){if(m.Error==1){m.Error+=20}m.Error+=10}if(m.Text&&this.IsTProfile()){m.Text+=2000;m.Error=0}}else{if(m.Error==0){m.Error=100;m.Scat=0}if(m.Text){m.Text+=2000;m.Error=0}}}if(j.indexOf("9")!=-1){m.HighRes=1}if(m.Surf==15){if(m.System==a.Painter.Coord.kPOLAR||m.System==a.Painter.Coord.kCARTESIAN){m.Surf=13}}if(m.Bar==1){m.Hist=-1}return m};a.THistPainter.prototype.GetAutoColor=function(c){if(this.options.AutoColor<=0){return c}var d=this.options.AutoColor;this.options.AutoColor=d%8+1;return a.Painter.root_colors[d]};a.THistPainter.prototype.ScanContent=function(){alert("HistPainter.prototype.ScanContent not implemented")};a.THistPainter.prototype.CheckPadOptions=function(){var c=this.root_pad();if(c!=null){this.options.Logx=c.fLogx;this.options.Logy=c.fLogy;this.options.Logz=c.fLogz;this.options.Gridx=c.fGridx;this.options.Gridy=c.fGridy}if(this.main_painter()!==this){return}this["zoom_xmin"]=0;this["zoom_xmax"]=0;this["zoom_ymin"]=0;this["zoom_ymax"]=0;this["zoom_zmin"]=0;this["zoom_zmax"]=0;if((c!=null)&&("fUxmin" in c)&&!this.create_canvas){if(c.fUxmin!==this["histo"]["fXaxis"]["fXmin"]||c.fUxmax!==this["histo"]["fXaxis"]["fXmax"]){this["zoom_xmin"]=c.fUxmin;this["zoom_xmax"]=c.fUxmax}if(c.fUymin!==this["histo"]["fYaxis"]["fXmin"]||c.fUymax!==this["histo"]["fYaxis"]["fXmax"]){this["zoom_ymin"]=c.fUymin;this["zoom_ymax"]=c.fUymax}if(c.fLogx>0){this["zoom_xmin"]=Math.exp(this["zoom_xmin"]*Math.log(10));this["zoom_xmax"]=Math.exp(this["zoom_xmax"]*Math.log(10))}if(c.fLogy>0){this["zoom_ymin"]=Math.exp(this["zoom_ymin"]*Math.log(10));this["zoom_ymax"]=Math.exp(this["zoom_ymax"]*Math.log(10))}}};a.THistPainter.prototype.UpdateObject=function(c){if(c._typename!=this.histo._typename){alert("JSROOT.THistPainter.UpdateObject - wrong class "+c._typename+" expected "+this.histo._typename);return false}this.histo.fEntries=c.fEntries;this.histo.fTsumw=c.fTsumw;this.histo.fTsumwx=c.fTsumwx;this.histo.fTsumwx2=c.fTsumwx2;if(this.Dimension()==2){this.histo.fTsumwy=c.fTsumwy;this.histo.fTsumwy2=c.fTsumwy2;this.histo.fTsumwxy=c.fTsumwxy}this.histo.fArray=c.fArray;this.histo.fNcells=c.fNcells;this.histo.fTitle=c.fTitle;this.histo.fMinimum=c.fMinimum;this.histo.fMaximum=c.fMaximum;this.histo.fXaxis["fNbins"]=c.fXaxis["fNbins"];this.histo.fXaxis["fXmin"]=c.fXaxis["fXmin"];this.histo.fXaxis["fXmax"]=c.fXaxis["fXmax"];this.histo.fYaxis["fXmin"]=c.fYaxis["fXmin"];this.histo.fYaxis["fXmax"]=c.fYaxis["fXmax"];if(this.IsTProfile()){this.histo.fBinEntries=c.fBinEntries;this.histo.fSumw2=c.fSumw2}this.ScanContent();return true};a.THistPainter.prototype.CreateAxisFuncs=function(c){this.xmin=this.histo.fXaxis["fXmin"];this.xmax=this.histo.fXaxis["fXmax"];if(this.histo.fXaxis.fXbins.length==this.nbinsx+1){this.regularx=false;this["GetBinX"]=function(e){var f=Math.round(e);if(f<=0){return this.xmin}if(f>this.nbinsx){this.xmax}if(f==e){return this.histo.fXaxis.fXbins[f]}var d=(e<f)?f-1:f+1;return this.histo.fXaxis.fXbins[f]*Math.abs(e-d)+this.histo.fXaxis.fXbins[d]*Math.abs(e-f)};this["GetIndexX"]=function(d,f){for(var e=1;e<this.histo.fXaxis.fXbins.length;++e){if(d<this.histo.fXaxis.fXbins[e]){return Math.floor(e-1+f)}}return this.nbinsx}}else{this.regularx=true;this.binwidthx=(this.xmax-this.xmin);if(this.nbinsx>0){this.binwidthx=this.binwidthx/this.nbinsx}this["GetBinX"]=function(d){return this.xmin+d*this.binwidthx};this["GetIndexX"]=function(d,e){return Math.floor((d-this.xmin)/this.binwidthx+e)}}this.ymin=this.histo.fYaxis["fXmin"];this.ymax=this.histo.fYaxis["fXmax"];if(!c||(this.nbinsy==0)){return}if(this.histo.fYaxis.fXbins.length==this.nbinsy+1){this.regulary=false;this["GetBinY"]=function(e){var f=Math.round(e);if(f<=0){return this.ymin}if(f>this.nbinsx){this.ymax}if(f==e){return this.histo.fYaxis.fXbins[f]}var d=(e<f)?f-1:f+1;return this.histo.fYaxis.fXbins[f]*Math.abs(e-d)+this.histo.fXaxis.fYbins[d]*Math.abs(e-f)};this["GetIndexY"]=function(f,e){for(var d=1;d<this.histo.fYaxis.fXbins.length;++d){if(f<this.histo.fYaxis.fXbins[d]){return Math.floor(d-1+e)}}return this.nbinsy}}else{this.regulary=true;this.binwidthy=(this.ymax-this.ymin);if(this.nbinsy>0){this.binwidthy=this.binwidthy/this.nbinsy}this["GetBinY"]=function(d){return this.ymin+d*this.binwidthy};this["GetIndexY"]=function(e,d){return Math.floor((e-this.ymin)/this.binwidthy+d)}}};a.THistPainter.prototype.CreateXY=function(){if(!this.is_main_painter()){this["x"]=this.main_painter()["x"];this["y"]=this.main_painter()["y"];return}var c=this.frame_width(),e=this.frame_height();if(this.histo.fXaxis["fTimeDisplay"]){this.x_kind="time";this["timeoffsetx"]=a.Painter.getTimeOffset(this.histo.fXaxis);this["ConvertX"]=function(h){return new Date(this.timeoffsetx+h*1000)};this["RevertX"]=function(h){return(this.x.invert(h)-this.timeoffsetx)/1000}}else{this.x_kind=(this.histo.fXaxis.fLabels==null)?"normal":"labels";this["ConvertX"]=function(h){return h};this["RevertX"]=function(h){return this.x.invert(h)}}this["scale_xmin"]=this.xmin;this["scale_xmax"]=this.xmax;if(this.zoom_xmin!=this.zoom_xmax){this["scale_xmin"]=this.zoom_xmin;this["scale_xmax"]=this.zoom_xmax}if(this.x_kind=="time"){this["x"]=b.time.scale()}else{if(this.options.Logx){if(this.scale_xmax<=0){this.scale_xmax=0}if((this.scale_xmin<=0)&&(this.nbinsx>0)){for(var d=0;d<this.nbinsx;++d){var f=this.GetBinX(d);if(f>0){this.scale_xmin=f;break}}}if((this.scale_xmin<=0)||(this.scale_xmin>=this.scale_xmax)){this.scale_xmin=this.scale_xmax*0.0001}this["x"]=b.scale.log()}else{this["x"]=b.scale.linear()}}this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range([0,c]);if(this.x_kind=="time"){this["grx"]=function(h){return this.x(this.ConvertX(h))}}else{if(this.options.Logx){this["grx"]=function(h){return(h<this.scale_xmin)?-5:this.x(h)}}else{this["grx"]=this.x}}this["scale_ymin"]=this.ymin;this["scale_ymax"]=this.ymax;if(this.zoom_ymin!=this.zoom_ymax){this["scale_ymin"]=this.zoom_ymin;this["scale_ymax"]=this.zoom_ymax}if(this.histo.fYaxis["fTimeDisplay"]){this.y_kind="time";this["timeoffsety"]=a.Painter.getTimeOffset(this.histo.fYaxis);this["ConvertY"]=function(h){return new Date(this.timeoffsety+h*1000)};this["RevertY"]=function(h){return(this.y.invert(h)-this.timeoffsety)/1000}}else{this.y_kind=((this.Dimension()==2)&&(this.histo.fYaxis.fLabels!=null))?"labels":"normal";this["ConvertY"]=function(h){return h};this["RevertY"]=function(h){return this.y.invert(h)}}if(this.options.Logy){if(this.scale_ymax<=0){this.scale_ymax=1}if((this.scale_ymin<=0)&&(this.nbinsy>0)){for(var d=0;d<this.nbinsy;++d){var g=this.GetBinY(d);if(g>0){this.scale_ymin=g;break}}}if((this.scale_ymin<=0)&&("ymin_nz" in this)&&(this.ymin_nz>0)){this.scale_ymin=0.3*this.ymin_nz}if((this.scale_ymin<=0)||(this.scale_ymin>=this.scale_ymax)){this.scale_ymin=0.000001*this.scale_ymax}this["y"]=b.scale.log()}else{if(this.y_kind=="time"){this["y"]=b.time.scale()}else{this["y"]=b.scale.linear()}}this["y"].domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range([e,0]);if(this.y_kind=="time"){this["gry"]=function(h){return this.y(this.ConvertY(h))}}else{if(this.options.Logy){this["gry"]=function(h){return(h<this.scale_ymin)?e+5:this.y(h)}}else{this["gry"]=this.y}}};a.THistPainter.prototype.DrawGrids=function(){if(!this.is_main_painter()){return}var d=this.svg_frame().select(".grid_layer");d.selectAll(".xgrid").remove();d.selectAll(".ygrid").remove();if(this.options.Gridx){var e=this.frame_height();var g=this.x.ticks(this.x_nticks);d.selectAll(".xgrid").data(g).enter().append("svg:line").attr("class","xgrid").attr("x1",this.x).attr("y1",e).attr("x2",this.x).attr("y2",0).style("stroke","black").style("stroke-width",1).style("stroke-dasharray",a.Painter.root_line_styles[11])}if(this.options.Gridy){var c=this.frame_width();var f=this.y.ticks(this.y_nticks);d.selectAll(".ygrid").data(f).enter().append("svg:line").attr("class","ygrid").attr("x1",0).attr("y1",this.y).attr("x2",c).attr("y2",this.y).style("stroke","black").style("stroke-width",1).style("stroke-dasharray",a.Painter.root_line_styles[11])}};a.THistPainter.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};a.THistPainter.prototype.AxisAsText=function(e,g){if(e=="x"){if(this.x_kind=="time"){g=this.ConvertX(g);if("formatx" in this){return this.formatx(g)}return g.toString()}if(this.x_kind=="labels"){var f=parseInt(g)+1;if((f<1)||(f>this.histo.fXaxis.fNbins)){return null}for(var d=0;d<this.histo.fXaxis.fLabels.arr.length;++d){var c=this.histo.fXaxis.fLabels.arr[d];if(c.fUniqueID==f){return c.fString}}}if(Math.abs(g)<1e-14){if(Math.abs(this.xmax-this.xmin)>0.00001){g=0}}return g.toPrecision(4)}if(e=="y"){if(this.y_kind=="labels"){var f=parseInt(g)+1;if((f<1)||(f>this.histo.fYaxis.fNbins)){return null}for(var d=0;d<this.histo.fYaxis.fLabels.arr.length;++d){var c=this.histo.fYaxis.fLabels.arr[d];if(c.fUniqueID==f){return c.fString}}return null}if("dfy" in this){return this.dfy(new Date(this.timeoffsety+g*1000))}if(Math.abs(g)<1e-14){if(Math.abs(this.ymax-this.ymin)>0.00001){g=0}}return g.toPrecision(4)}return g.toPrecision(4)};a.THistPainter.prototype.DrawAxes=function(k){if(!this.is_main_painter()){return}var Q=this.frame_width(),S=this.frame_height();var V=this.svg_frame().selectAll(".xaxis_container");if(V.empty()){V=this.svg_frame().select(".axis_layer").append("svg:g").attr("class","xaxis_container")}V.selectAll("*").remove();V.attr("transform","translate(0,"+S+")");var N=this.svg_frame().selectAll(".yaxis_container");if(N.empty()){N=this.svg_frame().select(".axis_layer").append("svg:g").attr("class","yaxis_container")}N.selectAll("*").remove();var e=this.histo.fXaxis["fNdivisions"];this["x_nticks"]=e%100;var x=(e%10000-this.x_nticks)/100;var p=e/10000;var c=this.histo.fYaxis["fNdivisions"];this["y_nticks"]=c%100;var u=(c%10000-this.y_nticks)/100;var o=c/10000;var l=a.Painter.getFontDetails(this.histo.fXaxis["fLabelFont"],this.histo.fXaxis["fLabelSize"]*S);var K=3+(this.histo.fXaxis["fLabelOffset"]*S);if(this.histo.fXaxis["fTitle"].length>0){this.StartTextDrawing(this.histo.fXaxis["fTitleFont"],this.histo.fXaxis["fTitleSize"]*S,V);var d=this.histo.fXaxis.TestBit(a.EAxisBits.kCenterTitle);var U=this.histo.fXaxis.TestBit(a.EAxisBits.kRotateTitle)?-1:1;var I=this.DrawText(d?"middle":(U<0?"begin":"end"),(d?Q/2:Q)*U,U*(K+l.size*(1+this.histo.fXaxis["fTitleOffset"])),0,(U<0)?-180:0,this.histo.fXaxis["fTitle"],null,1,V);if(I<=0){k=true}this.FinishTextDrawing(V)}var G=3+(this.histo.fYaxis["fLabelOffset"]*Q);var v=a.Painter.getFontDetails(this.histo.fYaxis["fLabelFont"],this.histo.fYaxis["fLabelSize"]*S);if(this.histo.fYaxis["fTitle"].length>0){this.StartTextDrawing(this.histo.fYaxis["fTitleFont"],this.histo.fYaxis["fTitleSize"]*S,N);var d=this.histo.fYaxis.TestBit(a.EAxisBits.kCenterTitle);var U=this.histo.fYaxis.TestBit(a.EAxisBits.kRotateTitle)?1:-1;var I=this.DrawText(d?"middle":((U<0)?"end":"begin"),(d?S/2:0)*U,U*(G+(1+this.histo.fYaxis["fTitleOffset"])*v.size+N.property("text_font").size),0,(U<0?-270:-90),this.histo.fYaxis["fTitle"],null,1,N);if(I<=0){k=true}this.FinishTextDrawing(N)}var T=this.histo.fXaxis["fAxisColor"];var m=this.histo.fXaxis["fTickLength"]*S;var i=this.histo.fYaxis["fAxisColor"];var A=this.histo.fYaxis["fTickLength"]*Q;var y=this;delete this["formatx"];if(this.x_kind=="time"){if(this.x_nticks>8){this.x_nticks=8}var J=this.scale_xmax-this.scale_xmin;var E=a.Painter.getTimeFormat(this.histo.fXaxis);if((E.length==0)||(J<0.1*(this.xmax-this.xmin))){E=a.Painter.chooseTimeFormat(J,this.x_nticks)}if(E.length>0){this["formatx"]=b.time.format(E)}}else{if(this.options.Logx){this["noexpx"]=this.histo.fXaxis.TestBit(a.EAxisBits.kNoExponent);if((this.scale_xmax<300)&&(this.scale_xmin>0.3)){this["noexpx"]=true}this["moreloglabelsx"]=this.histo.fXaxis.TestBit(a.EAxisBits.kMoreLogLabels);this["formatx"]=function(W){var w=parseFloat(W);var h=a.log10(w);if(this["moreloglabelsx"]||(Math.abs(h-Math.round(h))<0.001)){if(!this["noexpx"]){return a.Painter.formatExp(w.toExponential(0))}else{if(h<0){return w.toFixed(Math.round(-h+0.5))}else{return w.toFixed(0)}}}return null}}else{if(this.x_kind=="labels"){this.x_nticks=50;var J=this.scale_xmax-this.scale_xmin;if(this.x_nticks>J){this.x_nticks=parseInt(J)}}this["formatx"]=function(h){if(this.x_kind=="labels"){return this.AxisAsText("x",h)}if((Math.abs(h)<1e-14)&&(Math.abs(this.xmax-this.xmin)>0.00001)){h=0}return parseFloat(h.toPrecision(12))}}}var q=b.svg.axis().scale(this.x).orient("bottom").tickPadding(K).tickSize(-m,-m/2,-m/4).ticks(this.x_nticks);if("formatx" in this){q.tickFormat(this.formatx.bind(this))}delete this["formaty"];if(this.y_kind=="time"){if(this.y_nticks>8){this.y_nticks=8}var C=a.Painter.getTimeFormat(this.histo.fYaxis);if((C.length==0)||(j<0.1*(this.ymax-this.ymin))){C=a.Painter.chooseTimeFormat(j,this.y_nticks)}if(C.length>0){this["formaty"]=b.time.format(C)}}else{if(this.options.Logy){this["noexpy"]=this.histo.fYaxis.TestBit(a.EAxisBits.kNoExponent);if((this.scale_ymax<300)&&(this.scale_ymin>0.3)){this["noexpy"]=true}this["moreloglabelsy"]=this.histo.fYaxis.TestBit(a.EAxisBits.kMoreLogLabels);this["formaty"]=function(W){var w=parseFloat(W);var h=a.log10(w);if(this["moreloglabelsy"]||(Math.abs(h-Math.round(h))<0.001)){if(!this["noexpy"]){return a.Painter.formatExp(w.toExponential(0))}else{if(h<0){return w.toFixed(Math.round(-h+0.5))}else{return w.toFixed(0)}}}return null}}else{if(this.y_kind=="labels"){this.y_nticks=50;var j=this.scale_ymax-this.scale_ymin;if(this.y_nticks>j){this.y_nticks=parseInt(j)}}else{if(this.y_nticks>=10){this.y_nticks-=2}}this["formaty"]=function(h){if(this.y_kind=="labels"){return this.AxisAsText("y",h)}if((Math.abs(h)<1e-14)&&(Math.abs(y.ymax-y.ymin)>0.00001)){h=0}return parseFloat(h.toPrecision(12))}}}var R=b.svg.axis().scale(this.y).orient("left").tickPadding(G).tickSize(-A,-A/2,-A/4).ticks(this.y_nticks);if("formaty" in this){R.tickFormat(this.formaty.bind(this))}var g=V.append("svg:g").attr("class","xaxis").call(q).call(l.func);if((this.x_kind=="labels")||(!this.options.Logx&&this.histo.fXaxis.TestBit(a.EAxisBits.kCenterLabels))){var O=0,s=0,D=10;var H=g.selectAll(".tick text");H.each(function(){var h=y.GetBoundarySizes(b.select(this).node());if(h.width>O){O=h.width}++s});if((s>0)&&(O>0)){if(O<Q/s){D=parseInt((Q/s-O)/2)}else{D=1;l.size=parseInt(l.size*(Q/s-2)/O);if(l.size<2){l.size=2}g.call(l.func)}}H.style("text-anchor","start").attr("x",D).attr("y",6);if(this.x_kind!="labels"){var M=this.svg_frame().node().getBoundingClientRect();H.each(function(){var h=b.select(this).node().getBoundingClientRect();if(h.left-M.left>Q){b.select(this).attr("opacity",0)}})}}if((x>0)&&!this.options.Logx&&(this.x_kind!="labels")){var z=b.svg.axis().scale(this.x).orient("bottom").tickPadding(K).innerTickSize(-m/2).tickFormat(function(h){return}).ticks(this.x.ticks(this.x_nticks).length*x);V.append("svg:g").attr("class","xaxis").call(z)}var f=N.append("svg:g").attr("class","yaxis").call(R).call(v.func);if((this.y_kind=="labels")||(!this.options.Logy&&this.histo.fYaxis.TestBit(a.EAxisBits.kCenterLabels))){var n=0,s=0,D=3,F=f.selectAll(".tick text");F.each(function(){var h=y.GetBoundarySizes(b.select(this).node());if(h.height>n){n=h.height}++s});if((s>0)&&(n>0)){if(n<S/s){D=parseInt((S/s-n)/2);F.attr("y",-D).attr("dy","0")}else{D=1;v.size=parseInt(v.size*(S/s-2)/n);if(v.size<2){v.size=2}f.call(v.func);F.attr("dy",D)}}if(this.y_kind!="labels"){var M=this.svg_frame().node().getBoundingClientRect();F.each(function(){var h=b.select(this).node().getBoundingClientRect();if(h.top-M.top<-10){b.select(this).attr("opacity",0)}})}}if((u>0)&&!this.options.Logy&&(this.y_kind!="labels")){var L=b.svg.axis().scale(this.y).orient("left").tickPadding(G).innerTickSize(-A/2).tickFormat(function(h){return}).ticks(this.y.ticks(this.y_nticks).length*u);N.append("svg:g").attr("class","yaxis").call(L)}if(a.gStyle.Zooming){V.append("svg:rect").attr("x",0).attr("y",0).attr("width",Q).attr("height",l.size+3).style("opacity","0").style("cursor","crosshair");N.append("svg:rect").attr("x",-2*v.size-3).attr("y",0).attr("width",2*v.size+3).attr("height",S).style("opacity","0").style("cursor","crosshair")}if((k==null)&&typeof N.node()["getBoundingClientRect"]=="function"){var t=N.node().getBoundingClientRect();var r=this.svg_pad().node().getBoundingClientRect();var P=t.left-r.left;var B=0;if(P<0){B=-P/Q+0.001;this.shrink_frame_left+=B}else{if((this.shrink_frame_left>0)&&(P/Q>this.shrink_frame_left)){B=-this.shrink_frame_left;this.shrink_frame_left=0}}if(B!=0){this.svg_frame().property("frame_painter").Shrink(B,0);this.svg_frame().property("frame_painter").Redraw();this.CreateXY();this.DrawAxes(true)}}};a.THistPainter.prototype.DrawTitle=function(){var c=this.FindPainterFor(null,"title");if(c!=null){c.pavetext.Clear();c.pavetext.AddText(this.histo.fTitle)}else{var d=a.Create("TPaveText");a.extend(d,{fName:"title",fX1NDC:0.2809483,fY1NDC:0.9339831,fX2NDC:0.7190517,fY2NDC:0.995});d.AddText(this.histo.fTitle);c=a.Painter.drawPaveText(this.divid,d)}};a.THistPainter.prototype.ToggleStat=function(c){var d=this.FindStat();if(d==null){if(c=="only-check"){return false}this.CreateStat();this.Redraw();return true}var e=this.FindPainterFor(d);if(e==null){return false}if(c=="only-check"){return e.Enabled}e.Enabled=!e.Enabled;e.Redraw();return e.Enabled};a.THistPainter.prototype.IsAxisZoomed=function(c){var d=this.main_painter();if(d==null){d=this}if(c=="x"){return d.zoom_xmin!=d.zoom_xmax}if(c=="y"){return d.zoom_ymin!=d.zoom_ymax}return false};a.THistPainter.prototype.GetSelectIndex=function(e,d,h){var f=0;var g=this.main_painter();if(g==null){g=this}var c=0;if(!h){h=0}if(e=="x"){c=this.nbinsx;if(g.zoom_xmin!=g.zoom_xmax){if(d=="left"){f=this.GetIndexX(g.zoom_xmin,h)}else{f=this.GetIndexX(g.zoom_xmax,h+0.5)}}else{f=(d=="left")?0:c}}else{if(e=="y"){c=this.nbinsy;if((g.zoom_ymin!=g.zoom_ymax)&&("GetIndexY" in this)){if(d=="left"){f=this.GetIndexY(g.zoom_ymin,h)}else{f=this.GetIndexY(g.zoom_ymax,h+0.5)}}else{f=(d=="left")?0:c}}}if(d=="left"){if(f<0){f=0}}else{if(f>c){f=c}}return f};a.THistPainter.prototype.FindStat=function(){if("fFunctions" in this.histo){for(var c=0;c<this.histo.fFunctions.arr.length;++c){var d=this.histo.fFunctions.arr[c];if((d._typename=="TPaveStats")&&(d.fName=="stats")){return d}}}return null};a.THistPainter.prototype.CreateStat=function(){if(!this.draw_content){return null}if(this.FindStat()!=null){return null}var c=a.Create("TPaveStats");a.extend(c,{_AutoCreated:true,fName:"stats",fOptStat:a.gStyle.OptStat,fOptFit:a.gStyle.OptFit,fBorderSize:1});a.extend(c,a.gStyle.StatNDC);a.extend(c,a.gStyle.StatText);a.extend(c,a.gStyle.StatFill);if(this.histo._typename&&(this.histo._typename.match(/^TProfile/)||this.histo._typename.match(/^TH2/))){c.fY1NDC=0.67}c.AddText(this.histo.fName);if(!"fFunctions" in this.histo){this.histo.fFunctions=a.Create("TList")}this.histo.fFunctions.arr.push(c);return c};a.THistPainter.prototype.FindF1=function(){if(!("fFunctions" in this.histo)){return null}for(var c=0;c<this.histo.fFunctions.arr.length;++c){var d=this.histo.fFunctions.arr[c];if(d._typename=="TF1"){return d}}return null};a.THistPainter.prototype.DrawNextFunction=function(g,h){if(this.options.Same||!("fFunctions" in this.histo)||(g>=this.histo.fFunctions.arr.length)){return a.CallBack(h)}var f=this.histo.fFunctions.arr[g];var d=this.histo.fFunctions.opt[g];var e=false;if(this.FindPainterFor(f)==null){if(f._typename=="TPaveText"||f._typename=="TPaveStats"){e=!this.histo.TestBit(a.TH1StatusBits.kNoStats)&&(this.options.NoStat!=1)}else{if(f._typename=="TF1"){e=!f.TestBit(a.BIT(9))}else{e=true}}}if(e){var c=a.draw(this.divid,f,d);if(c){return c.WhenReady(this.DrawNextFunction.bind(this,g+1,h))}}this.DrawNextFunction(g+1,h)};a.THistPainter.prototype.Redraw=function(){this.CreateXY();this.DrawAxes();this.DrawGrids();this.DrawBins();if(this.create_canvas){this.DrawTitle()}};a.THistPainter.prototype.Unzoom=function(g,e,c){var d=this.main_painter();if(!d){d=this}var f=false;if(g){if(d.zoom_xmin!=d.zoom_xmax){f=true}d.zoom_xmin=d.zoom_xmax=0}if(e){if(d.zoom_ymin!=d.zoom_ymax){f=true}d.zoom_ymin=d.zoom_ymax=0}if(c){if(d.zoom_zmin!=d.zoom_zmax){f=true}d.zoom_zmin=d.zoom_zmax=0}if(f){this.RedrawPad()}};a.THistPainter.prototype.ToggleLog=function(c){var d=this.main_painter();if(!d){d=this}d.options["Log"+c]=d.options["Log"+c]?0:1;d.RedrawPad()};a.THistPainter.prototype.Zoom=function(c,g,l,d,h,m){var f=false,k=(c!=g),j=(l!=d);var i=(h!=m)&&(h!=null)&&(m!=null);var e=this.main_painter();e.ForEachPainter(function(n){if(k&&n.CanZoomIn("x",c,g)){e.zoom_xmin=c;e.zoom_xmax=g;f=true;k=false}if(j&&n.CanZoomIn("y",l,d)){e.zoom_ymin=l;e.zoom_ymax=d;f=true;j=false}if(i&&n.CanZoomIn("z",h,m)){e.zoom_zmin=h;e.zoom_zmax=m;f=true;i=false}});if(f){this.RedrawPad()}};a.THistPainter.prototype.clearInteractiveElements=function(){a.Painter.closeMenu();if(this.zoom_rect!=null){this.zoom_rect.remove();this.zoom_rect=null}this.zoom_kind=0;if(this.disable_tooltip){a.gStyle.Tooltip=true;this.disable_tooltip=false}};a.THistPainter.prototype.mouseDoubleClick=function(){b.event.preventDefault();var c=b.mouse(this.last_mouse_tgt);this.clearInteractiveElements();if(c[0]<0){this.Unzoom(false,true,false)}else{if(c[1]>this.frame_height()){this.Unzoom(true,false,false)}else{this.Unzoom(true,true,true)}}};a.THistPainter.prototype.startRectSel=function(c){if(this.zoom_kind>100){return}b.event.preventDefault();this.clearInteractiveElements();this.last_mouse_tgt=c;this.zoom_origin=b.mouse(this.last_mouse_tgt);this.zoom_curr=[Math.max(0,Math.min(this.frame_width(),this.zoom_origin[0])),Math.max(0,Math.min(this.frame_height(),this.zoom_origin[1]))];if(this.zoom_origin[0]<0){this.zoom_kind=3;this.zoom_origin[0]=0;this.zoom_origin[1]=this.zoom_curr[1];this.zoom_curr[0]=this.frame_width();this.zoom_curr[1]+=1}else{if(this.zoom_origin[1]>this.frame_height()){this.zoom_kind=2;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=0;this.zoom_curr[0]+=1;this.zoom_curr[1]=this.frame_height()}else{this.zoom_kind=1;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=this.zoom_curr[1]}}this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect");b.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),true);b.event.stopPropagation()};a.THistPainter.prototype.moveRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}b.event.preventDefault();var c=b.mouse(this.last_mouse_tgt);c[0]=Math.max(0,Math.min(this.frame_width(),c[0]));c[1]=Math.max(0,Math.min(this.frame_height(),c[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=c[0];this.zoom_curr[1]=c[1];break;case 2:this.zoom_curr[0]=c[0];break;case 3:this.zoom_curr[1]=c[1];break}this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]));if(a.gStyle.Tooltip&&((Math.abs(this.zoom_curr[0]-this.zoom_origin[0])>10)||(Math.abs(this.zoom_curr[1]-this.zoom_origin[1])>10))){a.gStyle.Tooltip=false;this.disable_tooltip=true}};a.THistPainter.prototype.endRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}b.event.preventDefault();b.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);var d=b.mouse(this.last_mouse_tgt);d[0]=Math.max(0,Math.min(this.frame_width(),d[0]));d[1]=Math.max(0,Math.min(this.frame_height(),d[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=d[0];this.zoom_curr[1]=d[1];break;case 2:this.zoom_curr[0]=d[0];break;case 3:this.zoom_curr[1]=d[1];break}var h=0,e=0,f=0,c=0;var g=false;if((this.zoom_kind!=3)&&(Math.abs(this.zoom_curr[0]-this.zoom_origin[0])>10)){h=Math.min(this.RevertX(this.zoom_origin[0]),this.RevertX(this.zoom_curr[0]));e=Math.max(this.RevertX(this.zoom_origin[0]),this.RevertX(this.zoom_curr[0]));g=true}if((this.zoom_kind!=2)&&(Math.abs(this.zoom_curr[1]-this.zoom_origin[1])>10)){f=Math.min(this.y.invert(this.zoom_origin[1]),this.y.invert(this.zoom_curr[1]));c=Math.max(this.y.invert(this.zoom_origin[1]),this.y.invert(this.zoom_curr[1]));g=true}b.select("body").style("-webkit-user-select","auto");this.clearInteractiveElements();if(g){this.Zoom(h,e,f,c)}};a.THistPainter.prototype.startTouchZoom=function(h){if(this.zoom_kind!=0){b.event.preventDefault();b.event.stopPropagation();return}this.last_touch_tgt=h;var d=b.touches(this.last_touch_tgt);this.touch_cnt+=1;if(d.length==1){var e=new Date();var f=e.getTime()-this.last_touch.getTime();this.last_touch=e;if((f<300)&&(this.zoom_curr!=null)&&(Math.abs(this.zoom_curr[0]-d[0][0])<30)&&(Math.abs(this.zoom_curr[1]-d[0][1])<30)){b.event.preventDefault();b.event.stopPropagation();this.clearInteractiveElements();this.Unzoom(true,true,true);this.last_touch=new Date(0);this.svg_frame().on("touchcancel",null).on("touchend",null,true)}else{if(a.gStyle.ContextMenu){this.zoom_curr=d[0];this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this),true);b.event.preventDefault();b.event.stopPropagation()}}}if(d.length!=2){return}b.event.preventDefault();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null,true);var c=d[0],g=d[1];this.zoom_curr=[Math.min(c[0],g[0]),Math.min(c[1],g[1])];this.zoom_origin=[Math.max(c[0],g[0]),Math.max(c[1],g[1])];if(this.zoom_curr[0]<0){this.zoom_kind=103;this.zoom_curr[0]=0;this.zoom_origin[0]=this.frame_width()}else{if(this.zoom_origin[1]>this.frame_height()){this.zoom_kind=102;this.zoom_curr[1]=0;this.zoom_origin[1]=this.frame_height()}else{this.zoom_kind=101}}this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);b.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",this.endTouchSel.bind(this),true);b.event.stopPropagation()};a.THistPainter.prototype.moveTouchSel=function(){if(this.zoom_kind<100){return}b.event.preventDefault();var d=b.touches(this.last_touch_tgt);if(d.length!=2){return this.clearInteractiveElements()}var c=d[0],e=d[1];if(this.zoom_kind!=103){this.zoom_curr[0]=Math.min(c[0],e[0]);this.zoom_origin[0]=Math.max(c[0],e[0])}if(this.zoom_kind!=102){this.zoom_curr[1]=Math.min(c[1],e[1]);this.zoom_origin[1]=Math.max(c[1],e[1])}this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);if(a.gStyle.Tooltip&&((this.zoom_origin[0]-this.zoom_curr[0]>10)||(this.zoom_origin[1]-this.zoom_curr[1]>10))){a.gStyle.Tooltip=false;this.disable_tooltip=true}b.event.stopPropagation()};a.THistPainter.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null,true);if(this.zoom_kind==0){b.event.preventDefault();var e=new Date();var i=e.getTime()-this.last_touch.getTime();if((i>500)&&(i<2000)){this.ShowContextMenu("main",{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]});this.last_touch=new Date(0)}else{this.clearInteractiveElements()}}if(this.zoom_kind<100){return}b.event.preventDefault();b.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);var h=0,d=0,f=0,c=0;var g=false;if((this.zoom_kind!=103)&&(Math.abs(this.zoom_curr[0]-this.zoom_origin[0])>10)){h=Math.min(this.RevertX(this.zoom_origin[0]),this.RevertX(this.zoom_curr[0]));d=Math.max(this.RevertX(this.zoom_origin[0]),this.RevertX(this.zoom_curr[0]));g=true}if((this.zoom_kind!=102)&&(Math.abs(this.zoom_curr[1]-this.zoom_origin[1])>10)){f=Math.min(this.y.invert(this.zoom_origin[1]),this.y.invert(this.zoom_curr[1]));c=Math.max(this.y.invert(this.zoom_origin[1]),this.y.invert(this.zoom_curr[1]));g=true}b.select("body").style("-webkit-user-select","auto");this.clearInteractiveElements();this.last_touch=new Date(0);if(g){this.Zoom(h,d,f,c)}b.event.stopPropagation()};a.THistPainter.prototype.AddInteractive=function(){if((!a.gStyle.Zooming&&!a.gStyle.ContextMenu)||!this.is_main_painter()){return}this.last_touch=new Date(0);this.zoom_kind=0;this.zoom_rect=null;this.disable_tooltip=false;this.last_mouse_tgt=null;this.last_touch_tgt=null;this.zoom_origin=null;this.zoom_curr=null;this.touch_cnt=0;var c=this;if(a.gStyle.Zooming&&!a.touches){this.svg_frame().on("mousedown",function(){c.startRectSel(this)});this.svg_frame().on("dblclick",function(){c.mouseDoubleClick()})}if(a.touches&&(a.gStyle.Zooming||a.gStyle.ContextMenu)){this.svg_frame().on("touchstart",function(){c.startTouchZoom(this)})}if(a.gStyle.ContextMenu){if(a.touches){this.svg_frame().selectAll(".xaxis_container").on("touchstart",function(){c.startTouchMenu(this,"x")});this.svg_frame().selectAll(".yaxis_container").on("touchstart",function(){c.startTouchMenu(this,"y")})}else{this.svg_frame().on("contextmenu",this.ShowContextMenu.bind(this));this.svg_frame().selectAll(".xaxis_container").on("contextmenu",this.ShowContextMenu.bind(this,"x"));this.svg_frame().selectAll(".yaxis_container").on("contextmenu",this.ShowContextMenu.bind(this,"y"))}}};a.THistPainter.prototype.ShowContextMenu=function(c,d){if(("zoom_kind" in this)&&(this.zoom_kind>100)){return}if(!d){b.event.preventDefault();b.event.stopPropagation();d=b.event}this.ctx_menu_evnt=d;this.clearInteractiveElements();a.Painter.createMenu(function(f){f.painter=this;if((c=="x")||(c=="y")||(c=="z")){var e=null;if(c=="x"){e=this.histo.fXaxis}else{if(c=="y"){e=this.histo.fYaxis}}f.add("header: "+c.toUpperCase()+" axis");f.add("Unzoom",function(){this.Unzoom(c=="x",c=="y",c=="z")});f.addchk(this.options["Log"+c],"SetLog"+c,this.ToggleLog.bind(this,c));if(e!=null){f.addchk(e.TestBit(a.EAxisBits.kCenterLabels),"CenterLabels",function(){e.InvertBit(a.EAxisBits.kCenterLabels);this.RedrawPad()});f.addchk(e.TestBit(a.EAxisBits.kCenterTitle),"CenterTitle",function(){e.InvertBit(a.EAxisBits.kCenterTitle);this.RedrawPad()});f.addchk(e.TestBit(a.EAxisBits.kRotateTitle),"RotateTitle",function(){e.InvertBit(a.EAxisBits.kRotateTitle);this.RedrawPad()});f.addchk(e.TestBit(a.EAxisBits.kMoreLogLabels),"MoreLogLabels",function(){e.InvertBit(a.EAxisBits.kMoreLogLabels);this.RedrawPad()});f.addchk(e.TestBit(a.EAxisBits.kNoExponent),"NoExponent",function(){e.InvertBit(a.EAxisBits.kNoExponent);this.RedrawPad()})}}else{f.add("header:"+this.histo.fName);this.FillContextMenu(f)}f.show(this.ctx_menu_evnt);delete this.ctx_menu_evnt}.bind(this))};a.THistPainter.prototype.FillContextMenu=function(c){if(this.zoom_xmin!=this.zoom_xmax){c.add("Unzoom X",function(){this.Unzoom(true,false,false)})}if(this.zoom_ymin!=this.zoom_ymax){c.add("Unzoom Y",function(){this.Unzoom(false,true,false)})}if(this.zoom_zmin!=this.zoom_zmax){c.add("Unzoom Z",function(){this.Unzoom(false,false,true)})}c.add("Unzoom",function(){this.Unzoom(true,true,true)});c.addchk(a.gStyle.Tooltip,"Show tooltips",function(){a.gStyle.Tooltip=!a.gStyle.Tooltip;this.RedrawPad()});if(this.options){c.addchk(this.options.Logx,"SetLogx",function(){this.ToggleLog("x")});c.addchk(this.options.Logy,"SetLogy",function(){this.ToggleLog("y")});if(this.Dimension()==2){c.addchk(this.options.Logz,"SetLogz",function(){this.ToggleLog("z")})}}if(this.draw_content){c.addchk((this.options.Optimize>0),"Optimize drawing",function(){this.options.Optimize=(this.options.Optimize>0)?0:2;this.RedrawPad()});c.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()})}};a.TH1Painter=function(c){a.THistPainter.call(this,c)};a.TH1Painter.prototype=Object.create(a.THistPainter.prototype);a.TH1Painter.prototype.ScanContent=function(){this.fill=this.createAttFill(this.histo);if(this.fill.color=="white"){this.fill.color="none"}this.attline=a.Painter.createAttLine(this.histo);var f=this.main_painter();if(f!=null){this.attline.color=f.GetAutoColor(this.attline.color)}var e=0,c=0,k=0,j=0;var d=this.IsTProfile();this.nbinsx=this.histo.fXaxis["fNbins"];this.nbinsy=0;for(var h=0;h<this.nbinsx;++h){var l=this.histo.getBinContent(h+1);j+=d?this.histo.fBinEntries[h+1]:l;if(l>0){if((c==0)||(l<c)){c=l}}if(this.options.Error>0){l+=this.histo.getBinError(h+1)}if(h==0){e=k=l}if(l<e){e=l}else{if(l>k){k=l}}}if(d){j+=this.histo.fBinEntries[0]+this.histo.fBinEntries[this.nbinsx+1]}else{j+=this.histo.getBinContent(0)+this.histo.getBinContent(this.nbinsx+1)}this.stat_entries=j;if(this.histo.fEntries>1){this.stat_entries=this.histo.fEntries}this.CreateAxisFuncs(false);this.ymin_nz=c;if((this.nbinsx==0)||((Math.abs(e)<1e-300&&Math.abs(k)<1e-300))){this.draw_content=false;e=this.ymin;k=this.ymax}else{this.draw_content=true}if(e>=k){if(e==0){this.ymin=0;this.ymax=1}else{if(e<0){this.ymin=2*e;this.ymax=0}else{this.ymin=0;this.ymax=e*2}}}else{var m=(k-e)*0.05;this.ymin=e-m;if((this.ymin<0)&&(e>=0)){this.ymin=0}this.ymax=k+m}e=k=null;var g=false;if(this.histo.fMinimum!=-1111){e=this.histo.fMinimum;if(e<this.ymin){this.ymin=e}else{g=true}}if(this.histo.fMaximum!=-1111){k=this.histo.fMaximum;if(k>this.ymax){this.ymax=k}else{g=true}}if(g){this.zoom_ymin=(e==null)?this.ymin:e;this.zoom_ymax=(k==null)?this.ymax:k}if(this.options.Bar==0&&this.options.Hist==0&&this.options.Error==0&&this.options.Same==0){this.draw_content=false}if(this.options.Axis>0){this.draw_content=false}};a.TH1Painter.prototype.CountStat=function(o){var e=this.IsTProfile();var f=0,l=0,r=0,k=0,j=0;var d=this.GetSelectIndex("x","left");var q=this.GetSelectIndex("x","right");var c=0,p=0,h=null,n=null;for(var g=d;g<q;++g){c=this.GetBinX(g+0.5);if((o!=null)&&!o(c)){continue}if(e){p=this.histo.fBinEntries[g+1];k+=this.histo.fArray[g+1];j+=this.histo.fSumw2[g+1]}else{p=this.histo.getBinContent(g+1)}if((h==null)||(p>n)){h=c;n=p}f+=p;l+=p*c;r+=p*c*c}if(!this.IsAxisZoomed("x")&&(this.histo.fTsumw>0)){f=this.histo.fTsumw;l=this.histo.fTsumwx;r=this.histo.fTsumwx2}var m={meanx:0,meany:0,rmsx:0,rmsy:0,integral:f,entries:this.stat_entries,xmax:0,wmax:0};if(f>0){m.meanx=l/f;m.meany=k/f;m.rmsx=Math.sqrt(r/f-m.meanx*m.meanx);m.rmsy=Math.sqrt(j/f-m.meany*m.meany)}if(h!=null){m.xmax=h;m.wmax=n}return m};a.TH1Painter.prototype.FillStatistic=function(v,j,w){if(!this.histo){return false}var z=this.CountStat();var s=j%10;var f=Math.floor(j/10)%10;var l=Math.floor(j/100)%10;var x=Math.floor(j/1000)%10;var g=Math.floor(j/10000)%10;var k=Math.floor(j/100000)%10;var q=Math.floor(j/1000000)%10;var B=Math.floor(j/10000000)%10;var t=Math.floor(j/100000000)%10;if(s>0){v.AddLine(this.histo.fName)}if(this.IsTProfile()){if(f>0){v.AddLine("Entries = "+v.Format(z.entries,"entries"))}if(l>0){v.AddLine("Mean = "+v.Format(z.meanx));v.AddLine("Mean y = "+v.Format(z.meany))}if(x>0){v.AddLine("Std Dev = "+v.Format(z.rmsx));v.AddLine("Std Dev y = "+v.Format(z.rmsy))}}else{if(f>0){v.AddLine("Entries = "+v.Format(z.entries,"entries"))}if(l>0){v.AddLine("Mean = "+v.Format(z.meanx))}if(x>0){v.AddLine("Std Dev = "+v.Format(z.rmsx))}if(g>0){var A=0;if(this.histo.fArray.length>0){A=this.histo.fArray[0]}v.AddLine("Underflow = "+v.Format(A))}if(k>0){var A=0;if(this.histo.fArray.length>0){A=this.histo.fArray[this.histo.fArray.length-1]}v.AddLine("Overflow = "+v.Format(A))}if(q>0){v.AddLine("Integral = "+v.Format(z.integral,"entries"))}if(B>0){v.AddLine("Skew = <not avail>")}if(t>0){v.AddLine("Kurt = <not avail>")}}if(w!=0){var o=this.FindF1();if(o!=null){var c=w%10;var p=Math.floor(w/10)%10;var d=Math.floor(w/100)%10;var i=Math.floor(w/1000)%10;if(d>0){v.AddLine("#chi^2 / ndf = "+v.Format(o.fChisquare,"fit")+" / "+o.fNDF)}if(i>0){v.AddLine("Prob = "+(("Math" in a)?v.Format(a.Math.Prob(o.fChisquare,o.fNDF)):"<not avail>"))}if(c>0){for(var m=0;m<o.fNpar;++m){var y=o.GetParName(m);var u=o.GetParValue(m);if(u!=null){u=v.Format(Number(u),"fit")}else{u="<not avail>"}var r="";if(o.fParErrors!=null){r=v.Format(o.fParErrors[m],"last");if((Number(r)==0)&&(o.fParErrors[m]!=0)){r=v.Format(o.fParErrors[m],"4.2g")}}if((p>0)&&(r.length>0)){v.AddLine(y+" = "+u+" #pm "+r)}else{v.AddLine(y+" = "+u)}}}}}var h=v.pavetext.fLines.arr.length;var e=h*a.gStyle.StatFontSize;if(e<=0||3==(a.gStyle.StatFont%10)){e=0.25*h*a.gStyle.StatH;v.pavetext.fY1NDC=0.93-e;v.pavetext.fY2NDC=0.93}return true};a.TH1Painter.prototype.CreateDrawBins=function(p,n,r){var g=this.GetSelectIndex("x","left",-1);var v=this.GetSelectIndex("x","right",2);var d=new Array;var w=((this.options.Optimize>0)&&(v-g>5000))||((this.options.Optimize>1)&&(v-g>2*p));var u,t=this.GetBinX(g);var h=-1111,e=-1111,f;var q=null;var j=false;var l=this.main_painter();var x=this.GetItemName();if((x==null)||(x=="")){x=this.histo.fName}if(x.length>0){x+="\n"}for(var s=g;s<v;++s){u=t;t=this.GetBinX(s+1);if(this.options.Logx&&(u<=0)){continue}h=e;e=l.grx(t);if(h<0){h=l.grx(u)}var m=s,c=this.histo.getBinContent(s+1);if(w){j=!j;while((s+1<v)&&(l.grx(this.GetBinX(s+2))<e+0.5)){++s;t=this.GetBinX(s+1);var k=this.histo.getBinContent(s+1);if(j?k>c:k<c){c=k;m=s}}e=l.grx(t)}if(r&&(c==0)){continue}if(this.options.Logy&&(c<this.scale_ymin)){f=n+10}else{f=l.gry(c)}q={x:h,y:f};if(this.options.Error>0){q.xerr=(e-h)/2;q.yerr=f-l.gry(c+this.histo.getBinError(m+1))}if(this.options.Error>0){q.x=(h+e)/2;q.tip=x+"x = "+this.AxisAsText("x",(u+t)/2)+"\ny = "+this.AxisAsText("y",c)+"\nerror x = "+((t-u)/2).toPrecision(4)+"\nerror y = "+this.histo.getBinError(m+1).toPrecision(4)}else{q.width=e-h;q.tip=x+"bin = "+(m+1)+"\n";if(l.x_kind=="labels"){q.tip+=("x = "+this.AxisAsText("x",u)+"\n")}else{q.tip+=("x = ["+this.AxisAsText("x",u)+", "+this.AxisAsText("x",t)+"]\n")}q.tip+=("entries = "+a.FFormat(c,a.gStyle.StatFormat))}d.push(q)}if((v==this.nbinsx)&&(this.options.Error==0)&&(q!=null)){var o=a.extend({},q);o.x=e;d.push(o)}return d};a.TH1Painter.prototype.DrawAsMarkers=function(g,d,f){if((this.options.Mark==0)&&(this.histo.fMarkerStyle>1)&&(this.histo.fMarkerSize>0)){this.options.Mark=1}var g=this.CreateDrawBins(d,f,(this.options.Error!=10)&&(this.options.Mark!=10));var e=this.draw_g.selectAll("g").data(g).enter().append("svg:g").attr("transform",function(h){return"translate("+h.x.toFixed(1)+","+h.y.toFixed(1)+")"});if(a.gStyle.Tooltip){e.append("svg:title").text(function(h){return h.tip})}if(this.options.Error==12){e.append("svg:rect").attr("x",function(h){return(-h.xerr).toFixed(1)}).attr("y",function(h){return(-h.yerr).toFixed(1)}).attr("width",function(h){return(2*h.xerr).toFixed(1)}).attr("height",function(h){return(2*h.yerr).toFixed(1)}).call(this.fill.func).style("pointer-events","visibleFill").property("fill0",this.fill.color).on("mouseover",function(){if(a.gStyle.Tooltip){b.select(this).transition().duration(100).style("fill","grey")}}).on("mouseout",function(){b.select(this).transition().duration(100).style("fill",this["fill0"])})}else{if(this.options.Error>0){e.append("svg:line").attr("x1",function(h){return(-h.xerr).toFixed(1)}).attr("y1",0).attr("x2",function(h){return h.xerr.toFixed(1)}).attr("y2",0).call(this.attline.func);e.append("svg:line").attr("x1",0).attr("y1",function(h){return(-h.yerr).toFixed(1)}).attr("x2",0).attr("y2",function(h){return h.yerr.toFixed(1)}).call(this.attline.func)}}if(this.options.Error==11){e.append("svg:line").attr("y1",-3).attr("x1",function(h){return(-h.xerr).toFixed(1)}).attr("y2",3).attr("x2",function(h){return(-h.xerr).toFixed(1)}).call(this.attline.func);e.append("svg:line").attr("y1",-3).attr("x1",function(h){return h.xerr.toFixed(1)}).attr("y2",3).attr("x2",function(h){return h.xerr.toFixed(1)}).call(this.attline.func);e.append("svg:line").attr("x1",-3).attr("y1",function(h){return(-h.yerr).toFixed(1)}).attr("x2",3).attr("y2",function(h){return(-h.yerr).toFixed(1)}).call(this.attline.func);e.append("svg:line").attr("x1",-3).attr("y1",function(h){return h.yerr.toFixed(1)}).attr("x2",3).attr("y2",function(h){return h.yerr.toFixed(1)}).call(this.attline.func)}if(this.options.Mark>0){var c=a.Painter.createAttMarker(this.histo);e.append("svg:path").call(c.func)}};a.TH1Painter.prototype.DrawBins=function(){var e=this.frame_width(),c=this.frame_height();if(!this.draw_content||(e<=0)||(c<=0)){this.RemoveDrawG();return}this.RecreateDrawG(false,".main_layer",false);if((this.options.Error>0)||(this.options.Mark>0)){return this.DrawAsMarkers(e,c)}var g=this.CreateDrawBins(e,c);if(this.fill.color!="none"){var f=b.svg.area().x(function(h){return h.x.toFixed(1)}).y0(function(h){return h.y.toFixed(1)}).y1(function(h){return c}).interpolate("step-after");this.draw_g.append("svg:path").attr("d",f(g)).style("pointer-events","none").call(this.attline.func).call(this.fill.func)}else{var d=b.svg.line().x(function(h){return h.x.toFixed(1)}).y(function(h){return h.y.toFixed(1)}).interpolate("step-after");this.draw_g.append("svg:path").attr("d",d(g)).call(this.attline.func).style("fill","none")}if(a.gStyle.Tooltip){this.draw_g.selectAll("selections").data(g).enter().append("svg:line").attr("x1",function(h){return h.x+h.width/2}).attr("y1",function(h){return Math.max(0,h.y)}).attr("x2",function(h){return h.x+h.width/2}).attr("y2",function(h){return c}).style("opacity",0).style("stroke","#4572A7").style("stroke-width",function(h){return h.width}).on("mouseover",function(){if(a.gStyle.Tooltip&&(b.select(this).style("opacity")=="0")){b.select(this).transition().duration(100).style("opacity","0.3")}}).on("mouseout",function(){b.select(this).transition().duration(100).style("opacity","0")}).append("svg:title").text(function(h){return h.tip})}};a.TH1Painter.prototype.FillContextMenu=function(c){a.THistPainter.prototype.FillContextMenu.call(this,c);if(this.draw_content){c.add("Auto zoom-in",this.AutoZoom.bind(this))}};a.TH1Painter.prototype.AutoZoom=function(){var f=this.GetSelectIndex("x","left",-1);var d=this.GetSelectIndex("x","right",1);var g=(d-f);if(g==0){return}var c=this.histo.getBinContent(f+1);for(var e=f;e<d;++e){if(this.histo.getBinContent(e+1)<c){c=this.histo.getBinContent(e+1)}}if(c>0){return}while((f<d)&&(this.histo.getBinContent(f+1)<=c)){++f}while((f<d)&&(this.histo.getBinContent(d)<=c)){--d}if((d-f<g)&&(f<d)){this.Zoom(this.GetBinX(f),this.GetBinX(d),0,0)}};a.TH1Painter.prototype.CanZoomIn=function(e,d,c){if((e=="x")&&(this.GetIndexX(c,0.5)-this.GetIndexX(d,0)>1)){return true}if((e=="y")&&(Math.abs(c-d)>Math.abs(this.ymax-this.ymin)*0.000001)){return true}return false};a.Painter.drawHistogram1D=function(f,d,e){var c=new a.TH1Painter(d);c.SetDivId(f,1);c.options=c.DecodeOptions(e);c.CheckPadOptions();c.ScanContent();c.CreateXY();c.DrawAxes();c.DrawGrids();c.DrawBins();if(c.create_canvas){c.DrawTitle()}if(a.gStyle.AutoStat&&c.create_canvas){c.CreateStat()}c.DrawNextFunction(0,function(){c.AddInteractive();if(c.options.AutoZoom){c.AutoZoom()}c.DrawingReady()});return c};a.TTextPainter=function(c){a.TObjectPainter.call(this,c);this.text=c};a.TTextPainter.prototype=Object.create(a.TObjectPainter.prototype);a.TTextPainter.prototype.GetObject=function(){return this.text};a.TTextPainter.prototype.drawPaveLabel=function(){this.RecreateDrawG(true,".text_layer");var i=this.text;var j=this.pad_width(),r=this.pad_height();if(i.fInit==0){i.fInit=1;var p=(i.fOption.indexOf("NDC")>=0);i.fX1NDC=this.ConvertToNDC("x",i.fX1,p);i.fX2NDC=this.ConvertToNDC("x",i.fX2,p);i.fY1NDC=this.ConvertToNDC("y",i.fY1,p);i.fY2NDC=this.ConvertToNDC("y",i.fY2,p)}var d=i.fX1NDC*j;var c=(1-i.fY1NDC)*r;var o=Math.abs(i.fX2NDC-i.fX1NDC)*j;var m=Math.abs(i.fY2NDC-i.fY1NDC)*r;c-=m;var e=this.createAttFill(i);var v=a.Painter.root_colors[i.fTextColor];var s=a.Painter.root_colors[i.fShadowColor];var q="start",k=Math.round(i.fTextAlign/10);var l="bottom",f=i.fTextAlign%10;if(k==1){q="start"}else{if(k==2){q="middle"}else{if(k==3){q="end"}}}if(f==1){l="bottom"}else{if(f==2){l="middle"}else{if(f==3){l="top"}}}var t=i.fBorderSize?i.fBorderSize:0;var u=a.Painter.createAttLine(i,t);var g=this.draw_g.attr("x",d.toFixed(1)).attr("y",c.toFixed(1)).attr("width",o.toFixed(1)).attr("height",m.toFixed(1)).attr("transform","translate("+d.toFixed(1)+","+c.toFixed(1)+")");g.append("svg:rect").attr("x",0).attr("y",0).attr("width",o.toFixed(1)).attr("height",m.toFixed(1)).call(e.func).style("stroke-width",t?1:0).style("stroke",u.color);this.StartTextDrawing(i.fTextFont,m/1.7);this.DrawText(q,0.02*o,0,0.96*o,m,i.fLabel,v);if(t&&t>1){g.append("svg:line").attr("x1",o+(t/2)).attr("y1",t+1).attr("x2",o+(t/2)).attr("y2",m+t-1).call(u.func);g.append("svg:line").attr("x1",t+1).attr("y1",m+(t/2)).attr("x2",o+t-1).attr("y2",m+(t/2)).call(u.func)}var n=this;this.AddDrag({obj:i,redraw:this.drawPaveLabel.bind(this)});this.FinishTextDrawing()};a.TTextPainter.prototype.drawText=function(){var j=a.BIT(14);var g=this.pad_width(),f=this.pad_height(),e=true;var d=this.text.fX,l=this.text.fY;if(this.text.TestBit(j)){d=d*g;l=(1-l)*f}else{if(this.main_painter()!=null){g=this.frame_width();f=this.frame_height();e=false;d=this.main_painter().grx(d);l=this.main_painter().gry(l)}else{if(this.root_pad()!=null){d=this.ConvertToNDC("x",d)*g;l=(1-this.ConvertToNDC("y",l))*f}else{a.console("Cannot draw text at x/y coordinates without real TPad object");d=g/2;l=f/2}}}this.RecreateDrawG(e,e?".text_layer":".upper_layer",true);var i=a.Painter.root_colors[this.text.fTextColor];var c=0,k=1;if(this.text._typename=="TLatex"){c=1;k=0.9}else{if(this.text._typename=="TMathText"){c=2;k=0.8}}this.StartTextDrawing(this.text.fTextFont,this.text.fTextSize*Math.min(g,f)*k);this.DrawText(this.text.fTextAlign,d,l,0,0,this.text.fTitle,i,c);this.FinishTextDrawing()};a.TTextPainter.prototype.UpdateObject=function(c){if(this.text._typename!=c._typename){return false}if(this.text._typename=="TPaveLabel"){this.text.fLabel=c.fLabel}else{this.text.fTitle=c.fTitle}return true};a.TTextPainter.prototype.Redraw=function(){if(this.text._typename=="TPaveLabel"){this.drawPaveLabel()}else{this.drawText()}};a.Painter.drawText=function(e,d){var c=new a.TTextPainter(d);c.SetDivId(e);c.Redraw();return c.DrawingReady()};a.RawTextPainter=function(c){a.TBasePainter.call(this);this.txt=c;return this};a.RawTextPainter.prototype=Object.create(a.TBasePainter.prototype);a.RawTextPainter.prototype.RedrawObject=function(c){this.txt=c;this.Draw();return true};a.RawTextPainter.prototype.Draw=function(){var e=this.txt.value;if(e==null){e="<undefined>"}var h="mathjax" in this.txt;if(!h&&!("as_is" in this.txt)){var d=e.split("\n");e="";for(var g=0;g<d.length;++g){e+="<pre>"+d[g]+"</pre>"}}var j=this.select_main();var c=j.select("div");if(c.empty()){c=j.append("div").style("max-width","100%").style("max-height","100%").style("overflow","auto")}c.html(e);this.SetDivId(this.divid);if(h){if(this["loading_mathjax"]){return}this["loading_mathjax"]=true;var f=this;a.AssertPrerequisites("mathjax",function(){f.loading_mathjax=false;if(typeof MathJax=="object"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,j.node()])}})}};a.Painter.drawRawText=function(f,c,e){var d=new a.RawTextPainter(c);d.SetDivId(f);d.Draw();return d.DrawingReady()};a.hpainter=null;a.HierarchyPainter=function(c,d){a.TBasePainter.call(this);this.name=c;this.frameid=d;this.h=null;this.files_monitoring=(d==null);if(a.hpainter==null){a.hpainter=this}};a.HierarchyPainter.prototype=Object.create(a.TBasePainter.prototype);a.HierarchyPainter.prototype.Cleanup=function(){this.clear(true)};a.HierarchyPainter.prototype.ListHierarchy=function(f,c){f._childs=[];for(var d=0;d<c.arr.length;++d){var g=c.arr[d];var e={_name:g.fName,_kind:"ROOT."+g._typename,_readobj:g};f._childs.push(e)}};a.HierarchyPainter.prototype.StreamerInfoHierarchy=function(j,c){j._childs=[];for(var e=0;e<c.arr.length;++e){var h=c.arr[e];if(h._typename=="TList"){continue}if(typeof(h.fName)=="undefined"){a.console("strange element in StreamerInfo with type "+h._typename);continue}var g={_name:h.fName,_kind:"",_childs:[]};j._childs.push(g);g._childs.push({_name:"Checksum: "+h.fCheckSum});g._childs.push({_name:"Class version: "+h.fClassVersion});if(h.fTitle!=""){g._childs.push({_name:"Title: "+h.fTitle})}if(typeof h.fElements=="undefined"){continue}for(var d=0;d<h.fElements["arr"].length;++d){var f=h.fElements["arr"][d];if((f==null)||(typeof(f.fName)=="undefined")){continue}var k=f.fTypeName+" "+f.fName+";";if(f.fTitle!=""){k+=" // "+f.fTitle}g._childs.push({_name:k})}}};a.HierarchyPainter.prototype.TreeHierarchy=function(h,l){h._childs=[];for(var f=0;f<l.fBranches.arr.length;++f){var g=l.fBranches.arr[f];var c=g.fLeaves.arr.length;if(c==1&&g.fLeaves.arr[0]["fName"]==g.fName){c=0}var d={_name:g.fName,_kind:c>0?"ROOT.TBranch":"ROOT.TLeafF"};h._childs.push(d);if(c>0){d._childs=[];for(var e=0;e<c;++e){var k={_name:g.fLeaves.arr[e]["fName"],_kind:"ROOT.TLeafF"};d._childs.push(k)}}}};a.HierarchyPainter.prototype.KeysHierarchy=function(c,k,e,g){c._childs=[];var h=this;for(var f=0;f<k.length;++f){var j=k[f];var l={_name:j.fName+";"+j.fCycle,_kind:"ROOT."+j.fClassName,_title:j.fTitle,_keyname:j.fName,_readobj:null,_parent:c};if("fRealName" in j){l._realname=j.fRealName+";"+j.fCycle}if((j.fClassName=="TTree"||j.fClassName=="TNtuple")){l._more=true;l._expand=function(i,m){h.TreeHierarchy(i,m);return true}}else{if(j.fClassName=="TDirectory"||j.fClassName=="TDirectoryFile"){var d=null;if((g!=null)&&(e!=null)){d=e.GetDir(g+j.fName)}l._isdir=true;if(d==null){l._more=true;l._expand=function(i,m){h.KeysHierarchy(i,m.fKeys);return true}}else{l._name=j.fName;h.KeysHierarchy(l,d.fKeys,e,g+j.fName+"/")}}else{if((j.fClassName=="TList")&&(j.fName=="StreamerInfo")){l._name="StreamerInfo";l._kind="ROOT.TStreamerInfoList";l._title="List of streamer infos for binary I/O";l._readobj=e.fStreamerInfos}else{if(j.fClassName=="TList"||j.fClassName=="TObjArray"||j.fClassName=="TClonesArray"){l._more=true;l._expand=function(i,m){h.ListHierarchy(i,m);return true}}}}}c._childs.push(l)}};a.HierarchyPainter.prototype.FileHierarchy=function(d){var c=this;var e={_name:d.fFileName,_kind:"ROOT.TFile",_file:d,_fullurl:d.fFullURL,_had_direct_read:false,_get:function(g,j,i){var f=this;if((g!=null)&&(g._readobj!=null)){return a.CallBack(i,g,g._readobj)}if(g!=null){j=c.itemFullName(g,f)}function h(k){if(f._file==null){f._file=k}if(k==null){return a.CallBack(i,g,null)}k.ReadObject(j,function(n){if((g==null)&&(n!=null)){var o=c.Find({name:j,top:f,last_exists:true,check_keys:true});if((o!=null)&&("last" in o)&&(o.last!=f)){var l=k.GetDir(c.itemFullName(o.last,f));if(l){o.last._name=o.last._keyname;var m=c.itemFullName(o.last,f);c.KeysHierarchy(o.last,l.fKeys,k,m+"/")}}else{c.KeysHierarchy(f,k.fKeys,k,"")}g=c.Find({name:j,top:f})}if(g!=null){g._readobj=n;if("_expand" in g){g._name=g._keyname}}a.CallBack(i,g,n)})}if(f._file!=null){h(f._file)}else{new a.TFile(f._fullurl,h)}}};this.KeysHierarchy(e,d.fKeys,d,"");return e};a.HierarchyPainter.prototype.ForEach=function(e,d){if(d==null){d=this.h}if((d==null)||(typeof e!="function")){return}function c(f){e(f);if("_childs" in f){for(var g=0;g<f._childs.length;++g){f._childs[g]._parent=f;c(f._childs[g])}}}c(d)};a.HierarchyPainter.prototype.Find=function(c){function d(k,g){if(!g||(g.length==0)||(k==null)){return k}var n=-1;function l(i){i._parent=k;if((n+1==g.length)||(n<0)){return i}return d(i,g.substr(n+1))}do{n=g.indexOf("/",n+1);var j=(n<0)?g:g.substr(0,n);if(typeof k._childs!="undefined"){for(var h=0;h<k._childs.length;++h){if(k._childs[h]._name==j){return l(k._childs[h])}}}if(("check_keys" in c)&&(typeof k._childs!="undefined")){for(var h=0;h<k._childs.length;++h){if(k._childs[h]._name.indexOf(j+";")==0){return l(k._childs[h])}}}if("force" in c){if(!("_childs" in k)){k._childs=[]}var m={_name:j};k._childs.push(m);return l(m)}}while(n>0);return("last_exists" in c)&&(k!=null)?{last:k,rest:g}:null}var e=this.h;var f="";if(typeof c=="string"){f=c;c={}}else{if(typeof c=="object"){f=c.name;if("top" in c){e=c.top}}else{return null}}return d(e,f)};a.HierarchyPainter.prototype.itemFullName=function(d,e){var c="";while("_parent" in d){if(c.length>0){c="/"+c}c=d._name+c;d=d._parent;if((e!=null)&&(d==e)){break}}return c};a.HierarchyPainter.prototype.ExecuteCommand=function(f,i){var k=this.Find(f);var c=f+"/cmd.json";var d=this;if("_numargs" in k){for(var e=0;e<k._numargs;++e){var g="arg"+(e+1);var j=null;if(e+2<arguments.length){j=arguments[e+2]}if((j==null)&&(typeof i=="object")){j=prompt("Input argument "+g+" for command "+k._name,"")}if(j==null){return}c+=((e==0)?"?":"&")+g+"="+j}}if((i!=null)&&(typeof i=="object")){i.css("background","yellow");if(k&&k._title){i.attr("title","Executing "+k._title)}}var h=a.NewHttpRequest(c,"text",function(m){if(typeof i=="function"){return i(m)}if((i!=null)&&(typeof i=="object")){var l=((m!=null)&&(m!="false"))?"green":"red";if(k&&k._title){i.attr("title",k._title+" lastres="+m)}i.animate({backgroundColor:l},2000,function(){i.css("background","")});if((l=="green")&&("_hreload" in k)){d.reload()}if((l=="green")&&("_update_item" in k)){d.updateItems(k._update_item.split(";"))}}});h.send()};a.HierarchyPainter.prototype.RefreshHtml=function(d){if(this.frameid==null){return a.CallBack(d)}var c=this;a.AssertPrerequisites("jq2d",function(){c.RefreshHtml(d)})};a.HierarchyPainter.prototype.toggle=function(d){var c=this;var e=function(f){if(f!=c.h){if(d){f._isopen=true}else{delete f._isopen}}if("_childs" in f){for(var g=0;g<f._childs.length;++g){e(f._childs[g])}}};e(this.h);this.RefreshHtml()};a.HierarchyPainter.prototype.get=function(i,e,l){var f=(typeof i=="object")?i.arg:i;var h=this.Find(f);var g=(h!=null)?null:this.Find({name:f,last_exists:true,check_keys:true});if((g!=null)&&("last" in g)&&(g.last!=null)){var c=this;var j=this.itemFullName(g.last);if((typeof i=="object")&&("rest" in i)){if((i.rest==g.rest)||(i.rest.length<=g.rest.length)){return a.CallBack(e)}}return this.expand(j,function(m){if(!m){a.CallBack(e)}var d=c.itemFullName(g.last);c.get({arg:d+"/"+g.rest,rest:g.rest},e,l)})}var k=h;while(k!=null){if(("_get" in k)&&(typeof(k._get)=="function")){return k._get(h,null,e,l)}k=("_parent" in k)?k._parent:null}a.CallBack(e,h,null)};a.HierarchyPainter.prototype.draw=function(e,d,c){return a.draw(e,d,c)};a.HierarchyPainter.prototype.redraw=function(e,d,c){return a.redraw(e,d,c)};a.HierarchyPainter.prototype.player=function(h,d,g){var e=this.Find(h);if(!e||!("_player" in e)){return a.CallBack(g,null)}var f=this;var c=("_prereq" in e)?e._prereq:"";a.AssertPrerequisites(c,function(){var i=a.findFunction(e._player);if(i==null){return a.CallBack(g,null)}f.CreateDisplay(function(k){var j=null;if(k){j=i(f,h,d)}a.CallBack(g,j)})})};a.HierarchyPainter.prototype.canDisplay=function(d,c){if(d==null){return false}if("_player" in d){return true}var e=a.getDrawHandle(d._kind,c);return(e!=null)&&("func" in e)};a.HierarchyPainter.prototype.display=function(i,d,g){var e=this;var c=null;function f(){a.CallBack(g,c,i)}e.CreateDisplay(function(m){if(!m){return f()}var j=e.Find(i);if((j!=null)&&("_player" in j)){return e.player(i,d,f)}var h=(typeof(d)=="string")&&(d.indexOf("update:")==0);if(h){d=d.substr(7);if((j==null)||("_doing_update" in j)){return f()}j._doing_update=true}if(j!=null){if(!e.canDisplay(j,d)){return f()}}var l="";if((typeof(d)=="string")&&(d.indexOf("divid:")>=0)){var k=d.indexOf("divid:");l=d.slice(k+6);d=d.slice(0,k)}a.progress("Loading "+i);e.get(i,function(n,o){a.progress();if(h&&n){delete n._doing_update}if(o==null){return f()}a.progress("Drawing "+i);if(l.length>0){c=h?e.redraw(l,o,d):e.draw(l,o,d)}else{m.ForEachPainter(function(q,r){if(q.GetItemName()!=i){return}if(!h&&(d!=null)&&(q.GetItemDrawOpt()!=d)){return}c=q;m.ActivateFrame(r);c.RedrawObject(o)})}if(c==null){if(h){a.console("something went wrong - did not found painter when doing update of "+i)}else{var p=m.FindFrame(i,true);b.select(p).html("");m.ActivateFrame(p);c=e.draw(b.select(p).attr("id"),o,d);e.enable_dropping(p,i)}}if(c){c.SetItemName(i,h?null:d)}a.progress();f()},d)})};a.HierarchyPainter.prototype.enable_dropping=function(c,d){};a.HierarchyPainter.prototype.dropitem=function(g,f,d){var c=this;var e=c.disp;c.get(g,function(i,j){if(j!=null){var h=c.draw(f,j,"same");if(h){h.SetItemName(g)}}a.CallBack(d)});return true};a.HierarchyPainter.prototype.updateItems=function(c){var f=this["disp"];if((f==null)||(c==null)){return}var d=[],e=[];f.ForEachPainter(function(g){var h=g.GetItemName();if((h==null)||(d.indexOf(h)>=0)){return}if(typeof c=="array"){if(c.indexOf(h)<0){return}}else{if(c!=h){return}}d.push(h);e.push("update:"+g.GetItemDrawOpt())},true);if(d.length>0){this.displayAll(d,e)}};a.HierarchyPainter.prototype.updateAll=function(e,f){var i=this["disp"];if(i==null){return}var h=[],d=[],g=this;i.ForEachPainter(function(n){var o=n.GetItemName();var j=n.GetItemDrawOpt();if((o==null)||(h.indexOf(o)>=0)){return}var l=g.Find(o);if((l==null)||("_not_monitor" in l)||("_player" in l)){return}var k=false;if("_always_monitor" in l){k=true}else{var m=a.getDrawHandle(l._kind);if(m&&("monitor" in m)){if((m.monitor===false)||(m.monitor=="never")){return}if(m.monitor==="always"){k=true}}}if(k||!e){h.push(o);d.push("update:"+j)}},true);var c=this;if(this.files_monitoring){this.ForEachRootFile(function(j){c.ForEach(function(k){delete k._readobj},j);delete j._file})}this.displayAll(h,d)};a.HierarchyPainter.prototype.displayAll=function(l,q,e){if((l==null)||(l.length==0)){return a.CallBack(e)}var k=this;if(q==null){q=[]}while(q.length<l.length){q.push("")}if((q.length==1)&&(q[0]=="iotest")){k.clear();b.select("#"+k.disp_frameid).html("<h2>Start I/O test "+("IO" in a?"Mode="+a.IO.Mode:"")+"</h2>");var d=new Date();return k.get(l[0],function(i,j){var h=new Date();b.select("#"+k.disp_frameid).append("h2").html("Item "+l[0]+" reading time = "+(h.getTime()-d.getTime())+"ms");return a.CallBack(e)})}var p=new Array(l.length);for(var g=0;g<l.length;++g){p[g]=null;if(k.Find(l[g])){continue}if(k.Find(l[g]+";1")){l[g]+=";1";continue}var m=l[g].indexOf("+");if(m>0){p[g]=l[g].split("+");l[g]=p[g].shift();for(var f=0;f<p[g].length;++f){var m=p[g][f].indexOf("_same_");if((m>0)&&(k.Find(p[g][f])==null)){p[g][f]=p[g][f].substr(0,m)+l[g].substr(m)}}}var m=l[g].indexOf("_same_");if((m>0)&&!k.Find(l[g])&&(g>0)){l[g]=l[g].substr(0,m)+l[0].substr(m)}}for(var c=l.length-1;c>=0;c--){var o=k.Find(l[c]);if((o==null)||k.canDisplay(o,q[c])){continue}k.expand(l[c]);l.splice(c,1);q.splice(c,1);p.splice(c,1)}if(l.length==0){return a.CallBack(e)}k.CreateDisplay(function(j){if(!j){return a.CallBack(e)}for(var h=0;h<l.length;++h){if(q[h].indexOf("update:")!=0){j.CreateFrame(l[h])}}for(var h=0;h<l.length;++h){k.display(l[h],q[h],function(i,s){var r=l.indexOf(s);if(r<0){return a.console("did not found item "+s)}l[r]="---";function n(){if((i!=null)&&(p[r]!=null)&&(p[r].length>0)){return k.dropitem(p[r].shift(),i.divid,n)}var u=false;for(var t=0;t<l.length;++t){if(l[t]!="---"){u=true}}if(!u){a.CallBack(e)}}n()})}})};a.HierarchyPainter.prototype.reload=function(){var c=this;if("_online" in this.h){this.OpenOnline(this.h._online,function(){c.RefreshHtml()})}};a.HierarchyPainter.prototype.expand=function(h,g,d){var f=this;var c=this.Find(h);if(c==null){return a.CallBack(g)}if(("_more" in c)&&!c._more){return a.CallBack(g)}if(!("_more" in c)){var e=a.getDrawHandle(c._kind);if((e!=null)&&("expand" in e)){return a.AssertPrerequisites(e.prereq,function(){c._expand=a.findFunction(e.expand);if(typeof c._expand=="function"){c._more=true;f.expand(h,g,d);delete c._more}})}}a.progress("Loading "+h);c._doing_expand=true;this.get(h,function(i,l){delete c._doing_expand;a.progress();var k=i,j=false;while((k!=null)&&(l!=null)){if(("_expand" in k)&&(typeof(k._expand)=="function")){if(k._expand(i,l)){i._isopen=true;j=true;if(typeof f.UpdateTreeNode=="function"){f.UpdateTreeNode(i,d,true)}break}}k=("_parent" in k)?k._parent:null}a.CallBack(g,j)})};a.HierarchyPainter.prototype.GetTopOnlineItem=function(c){if(c!=null){while((c!=null)&&(!("_online" in c))){c=c._parent}return c}if(this.h==null){return null}if("_online" in this.h){return this.h}if((this.h._childs!=null)&&("_online" in this.h._childs[0])){return this.h._childs[0]}return null};a.HierarchyPainter.prototype.ForEachJsonFile=function(d){if(this.h==null){return}if("_jsonfile" in this.h){return a.CallBack(d,this.h)}if(this.h._childs!=null){for(var e=0;e<this.h._childs.length;++e){var c=this.h._childs[e];if("_jsonfile" in c){a.CallBack(d,c)}}}};a.HierarchyPainter.prototype.OpenJsonFile=function(f,e){var d=false;this.ForEachJsonFile(function(g){if(g._jsonfile==f){d=true}});if(d){return a.CallBack(e)}var c=this;a.NewHttpRequest(f,"object",function(i){if(i==null){return a.CallBack(e)}var h={_jsonfile:f,_kind:"ROOT."+i._typename,_jsontmp:i,_name:f.split("/").pop()};if("fTitle" in i){h._title=i.fTitle}h._get=function(l,n,m){if("_jsontmp" in l){var k=l._jsontmp;delete l._jsontmp;return a.CallBack(m,l,k)}a.NewHttpRequest(l._jsonfile,"object",function(o){return a.CallBack(m,l,o)}).send(null)};if(c.h==null){c.h=h}else{if(c.h._kind=="TopFolder"){c.h._childs.push(h)}else{var j=c.h;var g=("_jsonfile" in j)?"Files":"Items";c.h={_name:g,_kind:"TopFolder",_childs:[j,h]}}}c.RefreshHtml(e)}).send(null)};a.HierarchyPainter.prototype.ForEachRootFile=function(d){if(this.h==null){return}if((this.h._kind=="ROOT.TFile")&&(this.h._file!=null)){return a.CallBack(d,this.h)}if(this.h._childs!=null){for(var e=0;e<this.h._childs.length;++e){var c=this.h._childs[e];if((c._kind=="ROOT.TFile")&&("_fullurl" in c)){a.CallBack(d,c)}}}};a.HierarchyPainter.prototype.OpenRootFile=function(f,e){var d=false;this.ForEachRootFile(function(g){if(g._fullurl==f){d=true}});if(d){return a.CallBack(e)}var c=this;a.OpenFile(f,function(i){if(i==null){return a.CallBack(e)}var h=c.FileHierarchy(i);h._isopen=true;if(c.h==null){c.h=h}else{if(c.h._kind=="TopFolder"){c.h._childs.push(h)}else{var j=c.h;var g=(j._kind=="ROOT.TFile")?"Files":"Items";c.h={_name:g,_kind:"TopFolder",_childs:[j,h]}}}c.RefreshHtml(e)})};a.HierarchyPainter.prototype.GetFileProp=function(e){var c=this.Find(e);if(c==null){return null}var d=c._name;while(c._parent!=null){c=c._parent;if("_file" in c){return{fileurl:c._file.fURL,itemname:d}}d=c._name+"/"+d}return null};a.MarkAsStreamerInfo=function(c,d,e){if((e!=null)&&(e._typename=="TList")){e._typename="TStreamerInfoList"}};a.HierarchyPainter.prototype.GetOnlineItemUrl=function(d){if((d!=null)&&(typeof d=="string")){d=this.Find(d)}var e=this.GetTopOnlineItem(d);if(d==null){return null}var c=this.itemFullName(d,e);if(e&&("_online" in e)&&(e._online!="")){c=e._online+c}return c};a.HierarchyPainter.prototype.GetOnlineItem=function(o,k,m,i){var d=k,g=false,l="",p="object",c=this,f=null;if(o!=null){d=this.GetOnlineItemUrl(o);var e=null;if("_kind" in o){f=a.getDrawHandle(o._kind)}if("_doing_expand" in o){g=true;l="h.json?compact=3"}else{if("_make_request" in o){e=a.findFunction(o._make_request)}else{if((f!=null)&&("make_request" in f)){e=f.make_request}}}if(typeof e=="function"){var j=e(c,o,d,i);if(j!=null){if(typeof j=="string"){l=j}else{if("req" in j){l=j.req}if("kind" in j){p=j.kind}}}}if((l.length==0)&&(o._kind.indexOf("ROOT.")!=0)){l="item.json.gz?compact=3"}}if((k==null)&&(o!=null)&&("_cached_draw_object" in this)&&(l.length==0)){var h=this["_cached_draw_object"];delete this["_cached_draw_object"];return a.CallBack(m,o,h)}if(l.length==0){l="root.json.gz?compact=3"}if(d.length>0){d+="/"}d+=l;var n=a.NewHttpRequest(d,p,function(s){var r=null;if(!g&&(o!=null)&&("_after_request" in o)){r=a.findFunction(o._after_request)}else{if((f!=null)&&("after_request" in f)){r=f.after_request}}if(typeof r=="function"){var q=r(c,o,s,i,n);if((q!=null)&&(typeof q=="object")){s=q}}a.CallBack(m,o,s)});n.send(null)};a.HierarchyPainter.prototype.OpenOnline=function(e,f){var c=this;function g(i){c.h=i;if(c.h==null){return}if(("_title" in c.h)&&(c.h._title!="")){document.title=c.h._title}i._isopen=true;c.h._online=e;c.h._get=function(l,n,m,k){c.GetOnlineItem(l,n,m,k)};c.h._expand=function(k,l){if((l!=null)&&(k!=null)&&("_childs" in l)){k._childs=l._childs;l._childs=null;return true}return false};var h="",j="";c.ForEach(function(l){if("_autoload" in l){var k=l._autoload.split(";");for(var m=0;m<k.length;++m){if((k[m].length>3)&&((k[m].lastIndexOf(".js")==k[m].length-3)||(k[m].lastIndexOf(".css")==k[m].length-4))){if(h.indexOf(k[m])<0){h+=k[m]+";"}}else{if(j.indexOf(k[m])<0){j+=k[m]+";"}}}}});if(h.length>0){h="user:"+h}a.AssertPrerequisites(j+h,function(){c.ForEach(function(m){if(!("_drawfunc" in m)||!("_kind" in m)){return}var l="kind:"+m._kind;if(m._kind.indexOf("ROOT.")==0){l=m._kind.slice(5)}var k=m._drawopt;if(!a.canDraw(l)||(k!=null)){a.addDrawFunc({name:l,func:m._drawfunc,script:m._drawscript,opt:k})}});a.CallBack(f,c)})}if(!e){e=""}if(typeof e=="object"){var d=e;e="";return g(d)}a.NewHttpRequest(e+"h.json?compact=3","object",g).send(null)};a.HierarchyPainter.prototype.GetOnlineProp=function(e){var c=this.Find(e);if(c==null){return null}var d=c._name;while(c._parent!=null){c=c._parent;if("_online" in c){return{server:c._online,itemname:d}}d=c._name+"/"+d}return null};a.HierarchyPainter.prototype.FillOnlineMenu=function(d,k,i){var l=this;var e=this.Find(i);var c=a.getDrawOptions(e._kind,"nosame");var g=a.getDrawHandle(e._kind);var h=("_kind" in e)?e._kind.indexOf("ROOT.")==0:false;if(c!=null){d.addDrawMenu("Draw",c,function(m){l.display(i,m)})}if((e._childs==null)&&(e._more||h)){d.add("Expand",function(){l.expand(i)})}if(g&&("execute" in g)){d.add("Execute",function(){l.ExecuteCommand(i,d.tree_node)})}var j=k.server+k.itemname+"/draw.htm";var f="?";if(this.IsMonitoring()){j+=f+"monitoring="+this.MonitoringInterval();f="&"}if(c!=null){d.addDrawMenu("Draw in new window",c,function(m){window.open(j+f+"opt="+m)})}if((c!=null)&&(c.length>0)&&h){d.addDrawMenu("Draw as png",c,function(m){window.open(k.server+k.itemname+"/root.png?w=400&h=300&opt="+m)})}if("_player" in e){d.add("Player",function(){l.player(i)})}};a.HierarchyPainter.prototype.ShowStreamerInfo=function(c){};a.HierarchyPainter.prototype.Adopt=function(c){this.h=c;this.RefreshHtml()};a.HierarchyPainter.prototype.SetMonitoring=function(c){this["_monitoring_on"]=false;this["_monitoring_interval"]=3000;if((c!=null)&&(c!="0")){this["_monitoring_on"]=true;this["_monitoring_interval"]=parseInt(c);if(isNaN(this["_monitoring_interval"])||(this["_monitoring_interval"]<100)){this["_monitoring_interval"]=3000}}};a.HierarchyPainter.prototype.MonitoringInterval=function(c){return("_monitoring_interval" in this)?this["_monitoring_interval"]:3000};a.HierarchyPainter.prototype.EnableMonitoring=function(c){this["_monitoring_on"]=c};a.HierarchyPainter.prototype.IsMonitoring=function(){return this["_monitoring_on"]};a.HierarchyPainter.prototype.SetDisplay=function(d,c){if((c==null)&&(typeof d=="object")){this["disp"]=d;this["disp_kind"]="custom";this["disp_frameid"]=null}else{this["disp_kind"]=d;this["disp_frameid"]=c}};a.HierarchyPainter.prototype.GetLayout=function(){return this["disp_kind"]};a.HierarchyPainter.prototype.clear=function(c){if("disp" in this){this["disp"].Reset();delete this["disp"]}if(c){b.select("#"+this.frameid).html("");delete this.h}else{this.ForEach(function(d){if(("clear" in d)&&(typeof d.clear=="function")){d.clear()}})}};a.HierarchyPainter.prototype.GetDisplay=function(){return("disp" in this)?this["disp"]:null};a.HierarchyPainter.prototype.CreateDisplay=function(d){var c=this;if("disp" in this){if((c.disp.NumDraw()>0)||(c.disp_kind=="custom")){return a.CallBack(d,c.disp)}c.disp.Reset();delete c.disp}if(document.getElementById(this["disp_frameid"])==null){return a.CallBack(d,null)}if(c.disp_kind=="simple"){c.disp=new a.SimpleDisplay(c.disp_frameid)}else{if(c.disp_kind.search("grid")==0){c.disp=new a.GridDisplay(c.disp_frameid,c.disp_kind)}}if(c.disp!=null){a.CallBack(d,c.disp)}else{a.AssertPrerequisites("jq2d",function(){c.CreateDisplay(d)})}};a.HierarchyPainter.prototype.updateOnOtherFrames=function(c,e){var f=this["disp"];if(f==null){return false}var d=false;f.ForEachPainter(function(g,h){if((g===c)||(g.GetItemName()!=c.GetItemName())){return}f.ActivateFrame(h);g.RedrawObject(e);d=true});return d};a.HierarchyPainter.prototype.CheckResize=function(c){if("disp" in this){this["disp"].CheckMDIResize(null,c)}else{if((typeof c=="object")&&("width" in c)&&("height" in c)){b.select("#"+this.frameid).style("width",c.width+"px").style("height",c.height+"px").style("display","block")}}};a.HierarchyPainter.prototype.StartGUI=function(n,h){var g=this;var j=a.GetUrlOptionAsArray("file;files");var q=a.GetUrlOptionAsArray("json");var f=a.GetUrlOption("path");var o=a.GetUrlOptionAsArray("expand");if(o.length==0&&(a.GetUrlOption("expand")=="")){o.push("")}if(f!=null){for(var k=0;k<j.length;++k){j[k]=f+j[k]}for(var k=0;k<q.length;++k){q[k]=f+q[k]}}var c=a.GetUrlOptionAsArray("item;items");if((c.length==0)&&a.GetUrlOption("item")==""){c.push("")}var e=a.GetUrlOptionAsArray("opt;opts");var p=a.GetUrlOption("monitoring");if((q.length==1)&&(c.length==0)&&(o.length==0)){c.push("")}if(!this["disp_kind"]){var l=a.GetUrlOption("layout");if((typeof l=="string")&&(l.length>0)){this["disp_kind"]=l}else{switch(c.length){case 0:case 1:this["disp_kind"]="simple";break;case 2:this["disp_kind"]="grid 1x2";break;default:this["disp_kind"]="flex"}}}if(a.GetUrlOption("files_monitoring")!=null){this.files_monitoring=true}a.RegisterForResize(this);this.SetMonitoring(p);function m(){if(q.length>0){g.OpenJsonFile(q.shift(),m)}else{if(j.length>0){g.OpenRootFile(j.shift(),m)}else{if(o.length>0){g.expand(o.shift(),m)}else{g.displayAll(c,e,function(){g.RefreshHtml();a.RegisterForResize(g);setInterval(function(){g.updateAll(!g.IsMonitoring())},g.MonitoringInterval());a.CallBack(h)})}}}}function d(){if(("_monitoring" in g.h)&&(p==null)){g.SetMonitoring(g.h._monitoring)}if(("_layout" in g.h)&&(l==null)){g.disp_kind=g.h._layout}if(("_loadfile" in g.h)&&(j.length==0)){j=a.ParseAsArray(g.h._loadfile)}if(("_drawitem" in g.h)&&(c.length==0)){c=a.ParseAsArray(g.h._drawitem);e=a.ParseAsArray(g.h._drawopt)}m()}if(n!=null){g.OpenOnline(n,d)}else{m()}};a.BuildNobrowserGUI=function(){var c=b.select("#simpleGUI");var d=false,e=false;if(c.empty()){d=true;c=b.select("#onlineGUI");if(c.empty()){c=b.select("#drawGUI");e=true}if(c.empty()){return alert("no div for simple nobrowser gui found")}}a.Painter.readStyleFromURL();b.select("html").style("height","100%");b.select("body").style({"min-height":"100%",margin:"0px",overflow:"hidden"});c.style({position:"absolute",left:"1px",top:"1px",bottom:"1px",right:"1px"});var h=new a.HierarchyPainter("root",null);h.SetDisplay(a.GetUrlOption("layout",null,"simple"),c.attr("id"));var f=null;if(d){var g=a.findFunction("GetCachedHierarchy");if(typeof g=="function"){f=g()}if(typeof f!="object"){f=""}}h.StartGUI(f,function(){if(!e){return}var j=a.findFunction("GetCachedObject");var k=(typeof j=="function")?a.JSONR_unref(j()):null;if(k!=null){h._cached_draw_object=k}var i=a.GetUrlOption("opt");h.display("",i)})};a.Painter.drawStreamerInfo=function(e,d){b.select("#"+e).style("overflow","auto");var c=new a.HierarchyPainter("sinfo",e);c.h={_name:"StreamerInfo"};c.StreamerInfoHierarchy(c.h,d);c.RefreshHtml(function(){c.SetDivId(e);c.DrawingReady()});return c};a.MDIDisplay=function(c){this.frameid=c;b.select("#"+this.frameid).property("mdi",this)};a.MDIDisplay.prototype.ForEachFrame=function(c,d){alert("ForEachFrame not implemented")};a.MDIDisplay.prototype.ForEachPainter=function(c,d){this.ForEachFrame(function(f){var e=new a.TObjectPainter();e.SetDivId(b.select(f).attr("id"),-1);e.ForEachPainter(function(g){c(g,f)})},d)};a.MDIDisplay.prototype.NumDraw=function(){var c=0;this.ForEachFrame(function(){++c});return c};a.MDIDisplay.prototype.FindFrame=function(d,e){var c=null;this.ForEachFrame(function(f){if(b.select(f).attr("title")==d){c=f}});if((c==null)&&e){c=this.CreateFrame(d)}return c};a.MDIDisplay.prototype.ActivateFrame=function(c){};a.MDIDisplay.prototype.CheckMDIResize=function(d,e){var c=null;this.ForEachPainter(function(f,g){if((d!=null)&&(b.select(g).attr("id")!=d)){return}if((f.GetItemName()!=null)&&(typeof f.CheckResize=="function")){if(c===g){return}f.CheckResize(e);c=g}})};a.MDIDisplay.prototype.Reset=function(){this.ForEachPainter(function(c){if((c.GetItemName()!=null)&&(typeof c.Cleanup=="function")){c.Cleanup()}});b.select("#"+this.frameid).html("").property("mdi",null)};a.MDIDisplay.prototype.Draw=function(f,d,c){if(!d){return}if(!a.canDraw(d._typename,c)){return}var e=this.FindFrame(f,true);this.ActivateFrame(e);return a.redraw(b.select(e).attr("id"),d,c)};a.CustomDisplay=function(){a.MDIDisplay.call(this,"dummy");this.frames={}};a.CustomDisplay.prototype=Object.create(a.MDIDisplay.prototype);a.CustomDisplay.prototype.AddFrame=function(d,c){if(!(d in this.frames)){this.frames[d]=""}this.frames[d]+=(c+";")};a.CustomDisplay.prototype.ForEachFrame=function(d,g){var f=Object.keys(this.frames);for(var c=0;c<f.length;++c){var e=b.select("#"+f[c]);if(!e.empty()){a.CallBack(d,e.node())}}};a.CustomDisplay.prototype.CreateFrame=function(e){var f=Object.keys(this.frames);for(var d=0;d<f.length;++d){var c=this.frames[f[d]];if(c.indexOf(e+";")>=0){return b.select("#"+f[d]).node()}}return null};a.CustomDisplay.prototype.Reset=function(){a.MDIDisplay.prototype.Reset.call(this);this.ForEachFrame(function(c){b.select(c).html("")})};a.SimpleDisplay=function(c){a.MDIDisplay.call(this,c)};a.SimpleDisplay.prototype=Object.create(a.MDIDisplay.prototype);a.SimpleDisplay.prototype.ForEachFrame=function(c,e){var d=b.select("#"+this.frameid+"_simple_display");if(!d.empty()){a.CallBack(c,d.node())}};a.SimpleDisplay.prototype.CreateFrame=function(c){return b.select("#"+this.frameid).html("").append("div").attr("id",this.frameid+"_simple_display").style("width","100%").style("height","100%").style("overflow","hidden").property("title",c).node()};a.SimpleDisplay.prototype.Reset=function(){a.MDIDisplay.prototype.Reset.call(this);b.select("#"+this.frameid).html("")};a.GridDisplay=function(e,d,c){a.MDIDisplay.call(this,e);this.cnt=0;if(typeof d=="string"){if(d.search("grid")==0){d=d.slice(4).trim()}var f=d.search("x");if(f>0){c=parseInt(d.slice(f+1));d=parseInt(d.slice(0,f))}else{d=parseInt(d);c=d}if(isNaN(d)){d=3}if(isNaN(c)){c=3}}if(!d){d=3}if(!c){c=d}this.sizex=d;this.sizey=c};a.GridDisplay.prototype=Object.create(a.MDIDisplay.prototype);a.GridDisplay.prototype.IsSingle=function(){return(this.sizex==1)&&(this.sizey==1)};a.GridDisplay.prototype.ForEachFrame=function(c,f){for(var d=0;d<this.sizex*this.sizey;++d){var e=this.IsSingle()?b.select("#"+this.frameid):b.select("#"+this.frameid+"_grid_"+d);if(!e.empty()&&e.property("title")!=""){a.CallBack(c,e.node())}}};a.GridDisplay.prototype.CreateFrame=function(n){var d=b.select("#"+this.frameid);if(d.empty()){return null}if(!this.IsSingle()){var g=this.frameid+"_grid";if(b.select("#"+g).empty()){var m=d.node().getBoundingClientRect();var k=Math.floor(m.height/this.sizey)-1;var o=Math.floor(m.width/this.sizex)-1;var l="<div style='width:100%; height:100%; margin:0; padding:0; border:0; overflow:hidden'>";l+="<table id='"+g+"' style='width:100%; height:100%; table-layout:fixed; border-collapse: collapse;'>";var c=0;for(var f=0;f<this.sizey;++f){l+="<tr>";for(var e=0;e<this.sizex;++e){l+="<td><div id='"+g+"_"+c+++"' class='grid_cell'></div></td>"}l+="</tr>"}l+="</table></div>";d.html(l);d.selectAll(".grid_cell").style({width:o+"px",height:k+"px",overflow:"hidden"})}d=b.select("#"+g+"_"+this.cnt);if(++this.cnt>=this.sizex*this.sizey){this.cnt=0}}return d.html("").property("title",n).node()};a.GridDisplay.prototype.Reset=function(){a.MDIDisplay.prototype.Reset.call(this);if(this.IsSingle()){b.select("#"+this.frameid).property("title",null)}this.cnt=0};a.GridDisplay.prototype.CheckMDIResize=function(g,e){if(!this.IsSingle()){var c=b.select("#"+this.frameid);var i=c.node().getBoundingClientRect();var f=Math.floor(i.height/this.sizey)-1;var d=Math.floor(i.width/this.sizex)-1;c.selectAll(".grid_cell").style({width:d+"px",height:f+"px"})}a.MDIDisplay.prototype.CheckMDIResize.call(this,g,e)};a.CheckElementResize=function(f,d){if(f==null){return}var e=new a.TObjectPainter(),c=false;e.SetDivId(f,-1);e.ForEachPainter(function(g){if(!c&&typeof g.CheckResize=="function"){c=g.CheckResize(d)}})};a.RegisterForResize=function(f,d){var g=null;var i=-1;var c=d?d/2.5:100;if(c<20){c=20}function e(){if(i<0){return}i+=1;if(i<3){return}if(g!=null){clearInterval(g);g=null}i=-1;if(f==null){return}document.body.style.cursor="wait";if(typeof f=="function"){f()}else{if((typeof f=="object")&&(typeof f.CheckResize=="function")){f.CheckResize()}else{if(typeof f=="string"){var j=b.select("#"+f);if(!j.empty()){var k=j.property("mdi");if(k){k.CheckMDIResize()}else{a.CheckElementResize(j.node())}}}}}document.body.style.cursor="auto"}function h(){if(g==null){g=setInterval(e,c)}i=0}window.addEventListener("resize",h)};a.addDrawFunc({name:"TCanvas",icon:"img_canvas",func:a.Painter.drawCanvas});a.addDrawFunc({name:"TPad",func:a.Painter.drawPad});a.addDrawFunc({name:"TFrame",func:a.Painter.drawFrame});a.addDrawFunc({name:"TPaveText",func:a.Painter.drawPaveText});a.addDrawFunc({name:"TPaveStats",func:a.Painter.drawPaveText});a.addDrawFunc({name:"TLatex",func:a.Painter.drawText});a.addDrawFunc({name:"TMathText",func:a.Painter.drawText});a.addDrawFunc({name:"TText",func:a.Painter.drawText});a.addDrawFunc({name:"TPaveLabel",func:a.Painter.drawText});a.addDrawFunc({name:/^TH1/,icon:"img_histo1d",func:a.Painter.drawHistogram1D,opt:";P;P0;E;E1;E2;same"});a.addDrawFunc({name:"TProfile",icon:"img_profile",func:a.Painter.drawHistogram1D,opt:";E0;E1;E2;p;hist"});a.addDrawFunc({name:/^TH2/,icon:"img_histo2d",prereq:"more2d",func:"JSROOT.Painter.drawHistogram2D",opt:";COL;COLZ;COL0Z;COL3;LEGO;same"});a.addDrawFunc({name:/^TH3/,icon:"img_histo3d",prereq:"3d",func:"JSROOT.Painter.drawHistogram3D"});a.addDrawFunc({name:/^TGraph/,icon:"img_graph",func:a.Painter.drawGraph,opt:";L;P"});a.addDrawFunc({name:"TCutG",icon:"img_graph",func:a.Painter.drawGraph,opt:";L;P"});a.addDrawFunc({name:/^RooHist/,icon:"img_graph",func:a.Painter.drawGraph,opt:";L;P"});a.addDrawFunc({name:/^RooCurve/,icon:"img_graph",func:a.Painter.drawGraph,opt:";L;P"});a.addDrawFunc({name:"THStack",prereq:"more2d",func:"JSROOT.Painter.drawHStack"});a.addDrawFunc({name:"TMultiGraph",prereq:"more2d",func:"JSROOT.Painter.drawMultiGraph"});a.addDrawFunc({name:"TStreamerInfoList",icon:"img_question",func:a.Painter.drawStreamerInfo});a.addDrawFunc({name:"TPaletteAxis",prereq:"more2d",func:"JSROOT.Painter.drawPaletteAxis"});a.addDrawFunc({name:"kind:Text",icon:"img_text",func:a.Painter.drawRawText});a.addDrawFunc({name:"TF1",icon:"img_graph",prereq:"math;more2d",func:"JSROOT.Painter.drawFunction"});a.addDrawFunc({name:"TEllipse",icon:"img_graph",prereq:"more2d",func:"JSROOT.Painter.drawEllipse"});a.addDrawFunc({name:"TLine",icon:"img_graph",prereq:"more2d",func:"JSROOT.Painter.drawLine"});a.addDrawFunc({name:"TArrow",icon:"img_graph",prereq:"more2d",func:"JSROOT.Painter.drawArrow"});a.addDrawFunc({name:"TLegend",prereq:"more2d",func:"JSROOT.Painter.drawLegend"});a.addDrawFunc({name:"TGeoVolume",icon:"img_histo3d",prereq:"geom",func:"JSROOT.Painter.drawGeometry",expand:"JSROOT.expandGeoVolume",painter_kind:"base",opt:"all;"});a.addDrawFunc({name:"TEveGeoShapeExtract",icon:"img_histo3d",prereq:"geom",func:"JSROOT.Painter.drawGeometry",painter_kind:"base"});a.addDrawFunc({name:"TGeoManager",icon:"img_histo3d",prereq:"geom",expand:"JSROOT.expandGeoManagerHierarchy"});a.addDrawFunc({name:"kind:Command",icon:"img_execute",execute:true});a.addDrawFunc({name:"TFolder",icon:"img_folder",icon2:"img_folderopen"});a.addDrawFunc({name:"TTree",icon:"img_tree"});a.addDrawFunc({name:"TNtuple",icon:"img_tree"});a.addDrawFunc({name:"TBranch",icon:"img_branch"});a.addDrawFunc({name:/^TLeaf/,icon:"img_leaf"});a.addDrawFunc({name:"TFile",icon:"img_file"});a.addDrawFunc({name:"TMemFile",icon:"img_file"});a.addDrawFunc({name:"Session",icon:"img_globe"});a.addDrawFunc({name:"kind:TopFolder",icon:"img_base"});a.addDrawFunc({name:"kind:Folder",icon:"img_folder",icon2:"img_folderopen"});a.getDrawHandle=function(e,f){if(typeof e!="string"){return null}if(f===""){f=null}var l=null;if((f==null)&&(e in a.DrawFuncs.cache)){return a.DrawFuncs.cache[e]}var n=(e.indexOf("ROOT.")==0)?e.substr(5):"kind:"+e;var d=0;for(var k=0;k<a.DrawFuncs.lst.length;++k){var m=a.DrawFuncs.lst[k];if(typeof m.name=="string"){if(m.name!=n){continue}}else{if(!n.match(m.name)){continue}}if(f==null){if(!(e in a.DrawFuncs.cache)){a.DrawFuncs.cache[e]=m}return m}else{if(typeof f=="string"){if(l==null){l=m}if("opt" in m){var c=m.opt.split(";");for(var g=0;g<c.length;++g){c[g]=c[g].toLowerCase()}if(c.indexOf(f.toLowerCase())>=0){return m}}}else{if(f===d){return m}}}++d}return l};a.getDrawOptions=function(g,c){if(typeof g!="string"){return null}var l=null,k=false;for(var e=0;e<1000;++e){var f=a.getDrawHandle(g,e);if((f==null)||!("func" in f)){break}k=true;if(!("opt" in f)){continue}var j=f.opt.split(";");for(var d=0;d<j.length;++d){j[d]=j[d].toLowerCase();if((c=="nosame")&&(j[d].indexOf("same")==0)){continue}if(l==null){l=[]}if(l.indexOf(j[d])<0){l.push(j[d])}}}if(k&&(l==null)){l=new Array;l.push("")}return l};a.canDraw=function(c){return a.getDrawOptions("ROOT."+c)!=null};a.draw=function(i,g,d){if((g==null)||(typeof g!="object")){return null}var h=null,j=null;if("_typename" in g){h=a.getDrawHandle("ROOT."+g._typename,d)}else{if("_kind" in g){h=a.getDrawHandle(g._kind,d)}}if((h==null)||!("func" in h)){return null}function c(){if((j==null)&&("painter_kind" in h)){j=(h.painter_kind=="base")?new a.TBasePainter():new a.TObjectPainter(g)}if(j==null){return h.func(i,g,d)}return h.func.bind(j)(i,g,d,j)}if(typeof h.func=="function"){return c()}var f="",k="";if(typeof h.func=="object"){if("func" in h.func){f=h.func.func}if("script" in h.func){k="user:"+h.func.script}}else{if(typeof h.func=="string"){f=h.func;if(("prereq" in h)&&(typeof h.prereq=="string")){k=h.prereq}if(("script" in h)&&(typeof h.script=="string")){k+=";user:"+h.script}}}if(f.length==0){return null}if(k.length>0){if(!("painter_kind" in h)){h.painter_kind=(f.indexOf("JSROOT.Painter")==0)?"object":"base"}j=(h.painter_kind=="base")?new a.TBasePainter():new a.TObjectPainter();a.AssertPrerequisites(k,function(){var m=a.findFunction(f);if(m==null){alert("Fail to find function "+f+" after loading "+k);return null}h.func=m;var l=c();if(l!==j){alert("Painter function "+f+" do not follow rules of dynamicaly loaded painters")}});return j}var e=a.findFunction(f);if(e==null){return null}h.func=e;return c()};a.redraw=function(j,g,e){if(g==null){return}var f=new a.TObjectPainter();f.SetDivId(j,-1);var c=f.pad_painter();if(c!=null){if(g._typename=="TCanvas"){c.RedrawObject(g);return c}for(var d=0;d<c.painters.length;++d){var h=c.painters[d].GetObject();if((h!=null)&&(h._typename==g._typename)){if(c.painters[d].UpdateObject(g)){c.RedrawPad();return c.painters[d]}}}}if(c){a.console("Cannot find painter to update object of type "+g._typename)}f.select_main().html("");return a.draw(j,g,e)};a.progress=function(f){var g="jsroot_progressbox";var d=b.select("#"+g);if(!a.gStyle.ProgressBox){return d.remove()}var e=true;if((typeof f=="undefined")||(f==null)){if(d.empty()){return}d.property("stack").pop();if(d.property("stack").length==0){return d.remove()}f=d.property("stack")[d.property("stack").length-1];e=false}else{if(typeof f!="string"){if(d.empty()){return}e=false;var c=new Date;if(c.getTime()-d.property("showtm").getTime<200){return}f=d.property("stack")[d.property("stack").length-1]+" "+(f*100).toFixed(1)+"%";d.property("showtm",c)}}if(d.empty()){d=b.select(document.body).append("div").attr("id",g).attr("class","progressbox").property("stack",new Array);d.append("p")}d.select("p").html(f);if(e){d.property("stack").push(f);d.property("showtm",new Date)}};return a}));